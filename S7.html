<!DOCTYPE html>
<html lang="en">
 <head>
  <meta charset="utf-8"/>
  <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
  <meta content="Robotics codes from scratch (RCFS) is a collection of source codes to study and test learning and optimization problems in robotics through simple 2D examples." name="description"/>
  <meta content="robotics codes, robotics tutorial, rcfs, robotics from scratch" name="keywords"/>
  <meta content="Sylvain Calinon" name="author"/>
  <title>
   RCFS
  </title>
  <link href="static_images/favicon.ico" rel="icon" sizes="any"/>
  <link href="static_images/favicon.svg" rel="icon" type="image/svg+xml"/>
  <link href="css/bootstrap.min.css" rel="stylesheet"/>
  <link href="css/bootstrap-icons-1.10.4/font/bootstrap-icons.css" rel="stylesheet"/>
  <link href="css/permanent_marker.css" rel="stylesheet"/>
  <link href="css/main-template.css" rel="stylesheet"/>
  <link href="css/sidebars.css" rel="stylesheet"/>
  <link href="css/katex.min.css" rel="stylesheet"/>
  <script src="js/jquery-3.6.4.min.js">
  </script>
  <script src="js/bootstrap.bundle.min.js">
  </script>
  <script src="js/katex.min.js">
  </script>
  <script>
   function initialize(){
                convertMath();
                alignImages();
            }

            function convertMath(){
                const elements = document.getElementsByClassName("ltx_Math");
                const macros = {
				'\\tp': '\\text{\\tiny{#1}}',
				'\\trsp' : '\\top',
				'\\psin' : '\\dagger',
				'\\eqref': '\\href{###1}{(\\text{#1})}',
				'\\ref': '\\href{###1}{\\text{#1}}',
				'\\label': '\\htmlId{#1}{}'
			};
                for(let element of elements){
                    katex.render(element.textContent, element, {
                        throwOnError: false,
                        macros
                    });
                }
            }

            function alignImages(){

                document.getElementsByTagName('style').innerHTML = '';

                let txt_height = document.querySelector('#txt-col').offsetHeight;
                let img_height = document.querySelector('#img-col').offsetHeight;

                let margin = 50;

                if(txt_height > img_height && screen.width >= 576){
                    let nb_figures = document.querySelectorAll('.figure_main').length;
                    let computed_margin = (txt_height - img_height) / nb_figures;

                    if(computed_margin > margin){
                        margin = computed_margin;
                    }
                }

                const style = document.createElement('style');
                style.innerHTML = '.figure_main{ padding-top:'+Math.round(margin/2)+'px; padding-bottom:'+Math.round(margin/2)+'px; }';
                document.head.appendChild(style);
            }

            window.onload = initialize;
            window.onorientationchange = alignImages;
  </script>
 </head>
 <body>
  <nav aria-label="Light offcanvas navbar" class="navbar fixed-top" style="width: 50px;">
   <div class="container-fluid">
    <button aria-controls="offcanvasNavbarLight" class="navbar-toggler" data-bs-target="#offcanvasNavbarLight" data-bs-toggle="offcanvas" type="button">
     <span class="navbar-toggler-icon" style="cursor: pointer;">
     </span>
    </button>
    <div aria-labelledby="offcanvasNavbarLightLabel" class="offcanvas offcanvas-start" id="offcanvasNavbarLight" style="width: 500px;" tabindex="-1">
     <div class="offcanvas-header">
      <!--style='height: 50px;'-->
      <a class="navbar-brand" href="index.html">
       <h4 class="offcanvas-title" id="offcanvasNavbarLightLabel">
        <i class="bi bi-code-slash">
        </i>
        RCFS
       </h4>
      </a>
      <button aria-label="Close" class="btn-close" data-bs-dismiss="offcanvas" type="button">
      </button>
     </div>
     <div class="offcanvas-body">
      <!--Menu goes here-->
      <ul class="list-unstyled ps-0">
       <li class="border-top my-1">
       </li>
       <li class="mb-1">
        <button aria-expanded="true" class="btn btn-toggle d-inline-flex align-items-center rounded border-0 collapsed" data-bs-target="#general-collapse" data-bs-toggle="collapse">
         General information
        </button>
        <div class="collapse show" id="general-collapse">
         <!--<li><a href='index.html' class='link-dark d-inline-flex text-decoration-none rounded'>Home</a></li>-->
         <ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small">
          <li>
           <a class="link-dark d-inline-flex text-decoration-none rounded" href="about.html">
            <div class="p-1 mb-0">
             About
            </div>
           </a>
          </li>
         </ul>
        </div>
       </li>
       <li class="border-top my-1">
       </li>
       <li class="mb-1">
        <button aria-expanded="false" class="btn btn-toggle d-inline-flex align-items-center rounded border-0 collapsed" data-bs-target="#sandboxes2d-collapse" data-bs-toggle="collapse">
         2D sandboxes
        </button>
        <div class="collapse" id="sandboxes2d-collapse">
         <ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small">
          <li>
           <a class="link-dark d-inline-flex text-decoration-none rounded" href="sandbox_FK.html">
            <div class="p-1 mb-0">
             Forward kinematics (FK)
            </div>
           </a>
          </li>
          <li>
           <a class="link-dark d-inline-flex text-decoration-none rounded" href="sandbox_IK.html">
            <div class="p-1 mb-0">
             Inverse kinematics (IK)
            </div>
           </a>
          </li>
          <li>
           <a class="link-dark d-inline-flex text-decoration-none rounded" href="sandbox_bimanual.html">
            <div class="p-1 mb-0">
             Bimanual robot
            </div>
           </a>
          </li>
          <li>
           <a class="link-dark d-inline-flex text-decoration-none rounded" href="sandbox_humanoid.html">
            <div class="p-1 mb-0">
             Humanoid robot (CoM and coordination matrix)
            </div>
           </a>
          </li>
          <li>
           <a class="link-dark d-inline-flex text-decoration-none rounded" href="sandbox_iLQR.html">
            <div class="p-1 mb-0">
             Iterative linear quadratic regulator (iLQR)
            </div>
           </a>
          </li>
          <li>
           <a class="link-dark d-inline-flex text-decoration-none rounded" href="sandbox_iLQR_car.html">
            <div class="p-1 mb-0">
             iLQR for car
            </div>
           </a>
          </li>
          <li>
           <a class="link-dark d-inline-flex text-decoration-none rounded" href="sandbox_iLQR_bicopter.html">
            <div class="p-1 mb-0">
             iLQR for bicopter
            </div>
           </a>
          </li>
          <li>
           <a class="link-dark d-inline-flex text-decoration-none rounded" href="sandbox_impedance.html">
            <div class="p-1 mb-0">
             Impedance control
            </div>
           </a>
          </li>
         </ul>
        </div>
       </li>
       <li class="border-top my-1">
       </li>
       <li class="mb-1">
        <button aria-expanded="false" class="btn btn-toggle d-inline-flex align-items-center rounded border-0 collapsed" data-bs-target="#sandboxes3d-collapse" data-bs-toggle="collapse">
         3D sandboxes
        </button>
        <div class="collapse" id="sandboxes3d-collapse">
         <ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small">
          <li>
           <a class="link-dark d-inline-flex text-decoration-none rounded" href="sandbox3d_IK.html">
            <div class="p-1 mb-0">
             Inverse kinematics (IK)
            </div>
           </a>
          </li>
         </ul>
        </div>
       </li>
       <li class="border-top my-1">
       </li>
       <li class="mb-1">
        <button aria-expanded="false" class="btn btn-toggle d-inline-flex align-items-center rounded border-0 collapsed" data-bs-target="#exercises-collapse" data-bs-toggle="collapse">
         Coding exercises
        </button>
        <div class="collapse" id="exercises-collapse">
         <ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small">
          <li>
           <a class="link-dark d-inline-flex text-decoration-none rounded" href="exercise01.html">
            <div class="p-1 mb-0 bg-dark text-white font-monospace">
             01
            </div>
            <div class="p-1 mb-0">
             Linear algebra in Python
            </div>
           </a>
          </li>
          <li>
           <a class="link-dark d-inline-flex text-decoration-none rounded" href="exercise02.html">
            <div class="p-1 mb-0 bg-dark text-white font-monospace">
             02
            </div>
            <div class="p-1 mb-0">
             Movement primitives and Newton's method
            </div>
           </a>
          </li>
          <li>
           <a class="link-dark d-inline-flex text-decoration-none rounded" href="exercise03.html">
            <div class="p-1 mb-0 bg-dark text-white font-monospace">
             03
            </div>
            <div class="p-1 mb-0">
             Gaussian Distributions
            </div>
           </a>
          </li>
          <li>
           <a class="link-dark d-inline-flex text-decoration-none rounded" href="exercise04a.html">
            <div class="p-1 mb-0 bg-dark text-white font-monospace">
             4a
            </div>
            <div class="p-1 mb-0">
             Forward kinematics
            </div>
           </a>
          </li>
          <li>
           <a class="link-dark d-inline-flex text-decoration-none rounded" href="exercise04b.html">
            <div class="p-1 mb-0 bg-dark text-white font-monospace">
             4b
            </div>
            <div class="p-1 mb-0">
             Inverse kinematics and nullspace control
            </div>
           </a>
          </li>
          <li>
           <a class="link-dark d-inline-flex text-decoration-none rounded" href="exercise05a.html">
            <div class="p-1 mb-0 bg-dark text-white font-monospace">
             5a
            </div>
            <div class="p-1 mb-0">
             Forward dynamics
            </div>
           </a>
          </li>
          <li>
           <a class="link-dark d-inline-flex text-decoration-none rounded" href="exercise05b.html">
            <div class="p-1 mb-0 bg-dark text-white font-monospace">
             5b
            </div>
            <div class="p-1 mb-0">
             Inverse dynamics and impedance control
            </div>
           </a>
          </li>
          <li>
           <a class="link-dark d-inline-flex text-decoration-none rounded" href="exercise06a.html">
            <div class="p-1 mb-0 bg-dark text-white font-monospace">
             6a
            </div>
            <div class="p-1 mb-0">
             Planning with linear quadratic regulator
            </div>
           </a>
          </li>
          <li>
           <a class="link-dark d-inline-flex text-decoration-none rounded" href="exercise06b.html">
            <div class="p-1 mb-0 bg-dark text-white font-monospace">
             6b
            </div>
            <div class="p-1 mb-0">
             Planning in joint space with LQR
            </div>
           </a>
          </li>
          <li>
           <a class="link-dark d-inline-flex text-decoration-none rounded" href="exercise07.html">
            <div class="p-1 mb-0 bg-dark text-white font-monospace">
             07
            </div>
            <div class="p-1 mb-0">
             Iterative linear quadratic regulator (iLQR)
            </div>
           </a>
          </li>
          <li>
           <a class="link-dark d-inline-flex text-decoration-none rounded" href="exercise08.html">
            <div class="p-1 mb-0 bg-dark text-white font-monospace">
             08
            </div>
            <div class="p-1 mb-0">
             Exploration with ergodic control
            </div>
           </a>
          </li>
          <li>
           <a class="link-dark d-inline-flex text-decoration-none rounded" href="exercise09.html">
            <div class="p-1 mb-0 bg-dark text-white font-monospace">
             09
            </div>
            <div class="p-1 mb-0">
             Orientation with Riemannian manifold
            </div>
           </a>
          </li>
         </ul>
        </div>
       </li>
       <li class="border-top my-1">
       </li>
       <li class="mb-1">
        <button aria-expanded="false" class="btn btn-toggle d-inline-flex align-items-center rounded border-0 collapsed" data-bs-target="#doc-collapse" data-bs-toggle="collapse">
         Online course
        </button>
        <div class="collapse" id="doc-collapse">
         <ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small" id="menu_container">
          <li class="mb-1 generated-menu-item">
           <a class="link-dark d-inline-flex text-decoration-none rounded" href="toc.html" style="font-weight:bold;">
            Table of contents
           </a>
          </li>
          <li class="mb-1 generated-menu-item">
           <a class="link-dark d-inline-flex text-decoration-none rounded" href="S1.html" style="font-weight:bold;">
            1 Introduction
           </a>
          </li>
          <li class="mb-1 generated-menu-item">
           <a class="link-dark d-inline-flex text-decoration-none rounded" href="S2.html" style="font-weight:bold;">
            2 Newton’s method for minimization
           </a>
           <div>
            <ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small">
             <li>
              <a class="link-dark d-inline-flex text-decoration-none rounded" href="S2.html#sec:GaussNewton">
               <span class="p-1 mb-0">
                2.1 Gauss–Newton algorithm
               </span>
              </a>
             </li>
             <li>
              <a class="link-dark d-inline-flex text-decoration-none rounded" href="S2.html#sec:LS">
               <span class="p-1 mb-0">
                2.2 Least squares
               </span>
              </a>
             </li>
             <li>
              <a class="link-dark d-inline-flex text-decoration-none rounded" href="S2.html#sec:LSconstraints">
               <span class="p-1 mb-0">
                2.3 Least squares with constraints
               </span>
              </a>
             </li>
            </ul>
           </div>
          </li>
          <li class="mb-1 generated-menu-item">
           <a class="link-dark d-inline-flex text-decoration-none rounded" href="S3.html" style="font-weight:bold;">
            3 Forward kinematics (FK) for a planar robot manipulator
           </a>
          </li>
          <li class="mb-1 generated-menu-item">
           <a class="link-dark d-inline-flex text-decoration-none rounded" href="S4.html" style="font-weight:bold;">
            4 Inverse kinematics (IK) for a planar robot manipulator
           </a>
           <div>
            <ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small">
             <li>
              <a class="link-dark d-inline-flex text-decoration-none rounded" href="S4.html#sec:IKnum">
               <span class="p-1 mb-0">
                4.1 Numerical estimation of the Jacobian
               </span>
              </a>
             </li>
             <li>
              <a class="link-dark d-inline-flex text-decoration-none rounded" href="S4.html#sec:IK_nullspace">
               <span class="p-1 mb-0">
                4.2 Inverse kinematics (IK) with task prioritization
               </span>
              </a>
             </li>
            </ul>
           </div>
          </li>
          <li class="mb-1 generated-menu-item">
           <a class="link-dark d-inline-flex text-decoration-none rounded" href="S5.html" style="font-weight:bold;">
            5 Encoding with basis functions
           </a>
           <div>
            <ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small">
             <li>
              <a class="link-dark d-inline-flex text-decoration-none rounded" href="S5.html#SS1">
               <span class="p-1 mb-0">
                5.1 Univariate trajectories
               </span>
              </a>
             </li>
             <li>
              <a class="link-dark d-inline-flex text-decoration-none rounded" href="S5.html#SS2">
               <span class="p-1 mb-0">
                5.2 Multivariate trajectories
               </span>
              </a>
             </li>
             <li>
              <a class="link-dark d-inline-flex text-decoration-none rounded" href="S5.html#SS3">
               <span class="p-1 mb-0">
                5.3 Multidimensional inputs
               </span>
              </a>
             </li>
             <li>
              <a class="link-dark d-inline-flex text-decoration-none rounded" href="S5.html#SS4">
               <span class="p-1 mb-0">
                5.4 Derivatives
               </span>
              </a>
             </li>
             <li>
              <a class="link-dark d-inline-flex text-decoration-none rounded" href="S5.html#SS5">
               <span class="p-1 mb-0">
                5.5 Concatenated basis functions
               </span>
              </a>
             </li>
             <li>
              <a class="link-dark d-inline-flex text-decoration-none rounded" href="S5.html#SS6">
               <span class="p-1 mb-0">
                5.6 Batch computation of basis functions coefficients
               </span>
              </a>
             </li>
             <li>
              <a class="link-dark d-inline-flex text-decoration-none rounded" href="S5.html#SS7">
               <span class="p-1 mb-0">
                5.7 Recursive computation of basis functions coefficients
               </span>
              </a>
             </li>
            </ul>
           </div>
          </li>
          <li class="mb-1 generated-menu-item">
           <a class="link-dark d-inline-flex text-decoration-none rounded" href="S6.html" style="font-weight:bold;">
            6 Linear quadratic tracking (LQT)
           </a>
           <div>
            <ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small">
             <li>
              <a class="link-dark d-inline-flex text-decoration-none rounded" href="S6.html#SS1">
               <span class="p-1 mb-0">
                6.1 LQT with smoothness cost
               </span>
              </a>
             </li>
             <li>
              <a class="link-dark d-inline-flex text-decoration-none rounded" href="S6.html#SS2">
               <span class="p-1 mb-0">
                6.2 LQT with control primitives
               </span>
              </a>
             </li>
             <li>
              <a class="link-dark d-inline-flex text-decoration-none rounded" href="S6.html#sec:LQRrecursive">
               <span class="p-1 mb-0">
                6.3 LQR with a recursive formulation
               </span>
              </a>
             </li>
             <li>
              <a class="link-dark d-inline-flex text-decoration-none rounded" href="S6.html#sec:augmState">
               <span class="p-1 mb-0">
                6.4 LQT with a recursive formulation and an augmented state space
               </span>
              </a>
             </li>
             <li>
              <a class="link-dark d-inline-flex text-decoration-none rounded" href="S6.html#sec:LQRLS">
               <span class="p-1 mb-0">
                6.5 Least squares formulation of recursive LQR
               </span>
              </a>
             </li>
             <li>
              <a class="link-dark d-inline-flex text-decoration-none rounded" href="S6.html#sec:DMPLQT">
               <span class="p-1 mb-0">
                6.6 Dynamical movement primitives (DMP) reformulated as LQT with control primitives
               </span>
              </a>
             </li>
            </ul>
           </div>
          </li>
          <li class="mb-1 generated-menu-item">
           <a class="link-dark d-inline-flex text-decoration-none rounded" href="S7.html" style="font-weight:bold;">
            7 iLQR optimization
           </a>
           <div>
            <ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small">
             <li>
              <a class="link-dark d-inline-flex text-decoration-none rounded" href="S7.html#sec:iLQRbatch">
               <span class="p-1 mb-0">
                7.1 Batch formulation of iLQR
               </span>
              </a>
             </li>
             <li>
              <a class="link-dark d-inline-flex text-decoration-none rounded" href="S7.html#sec:iLQRrecursive">
               <span class="p-1 mb-0">
                7.2 Recursive formulation of iLQR
               </span>
              </a>
             </li>
             <li>
              <a class="link-dark d-inline-flex text-decoration-none rounded" href="S7.html#sec:iLQRLS">
               <span class="p-1 mb-0">
                7.3 Least squares formulation of recursive iLQR
               </span>
              </a>
             </li>
             <li>
              <a class="link-dark d-inline-flex text-decoration-none rounded" href="S7.html#SS4">
               <span class="p-1 mb-0">
                7.4 Updates by considering step sizes
               </span>
              </a>
             </li>
             <li>
              <a class="link-dark d-inline-flex text-decoration-none rounded" href="S7.html#SS5">
               <span class="p-1 mb-0">
                7.5 iLQR with quadratic cost on f(x_{t})
               </span>
              </a>
             </li>
             <li>
              <a class="link-dark d-inline-flex text-decoration-none rounded" href="S7.html#SS6">
               <span class="p-1 mb-0">
                7.6 iLQR with control primitives
               </span>
              </a>
             </li>
             <li>
              <a class="link-dark d-inline-flex text-decoration-none rounded" href="S7.html#SS7">
               <span class="p-1 mb-0">
                7.7 iLQR for spacetime optimization
               </span>
              </a>
             </li>
             <li>
              <a class="link-dark d-inline-flex text-decoration-none rounded" href="S7.html#SS8">
               <span class="p-1 mb-0">
                7.8 iLQR with offdiagonal elements in the precision matrix
               </span>
              </a>
             </li>
             <li>
              <a class="link-dark d-inline-flex text-decoration-none rounded" href="S7.html#SS9">
               <span class="p-1 mb-0">
                7.9 Car steering
               </span>
              </a>
             </li>
             <li>
              <a class="link-dark d-inline-flex text-decoration-none rounded" href="S7.html#SS10">
               <span class="p-1 mb-0">
                7.10 Bicopter
               </span>
              </a>
             </li>
            </ul>
           </div>
          </li>
          <li class="mb-1 generated-menu-item">
           <a class="link-dark d-inline-flex text-decoration-none rounded" href="S8.html" style="font-weight:bold;">
            8 Forward dynamics (FD) for a planar robot manipulator
           </a>
           <div>
            <ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small">
             <li>
              <a class="link-dark d-inline-flex text-decoration-none rounded" href="S8.html#SS1">
               <span class="p-1 mb-0">
                8.1 Robot manipulator with dynamics equation
               </span>
              </a>
             </li>
            </ul>
           </div>
          </li>
          <li class="mb-1 generated-menu-item">
           <a class="link-dark d-inline-flex text-decoration-none rounded" href="bib.html" style="font-weight:bold;">
            References
           </a>
          </li>
          <li class="mb-1 generated-menu-item">
           <a class="link-dark d-inline-flex text-decoration-none rounded" href="A1.html" style="font-weight:bold;">
            A System dynamics at trajectory level
           </a>
          </li>
          <li class="mb-1 generated-menu-item">
           <a class="link-dark d-inline-flex text-decoration-none rounded" href="A2.html" style="font-weight:bold;">
            B Derivation of motion equation for a planar robot
           </a>
          </li>
          <li class="mb-1 generated-menu-item">
           <a class="link-dark d-inline-flex text-decoration-none rounded" href="A3.html" style="font-weight:bold;">
            C Linear systems used in the bimanual tennis serve example
           </a>
          </li>
          <li class="mb-1 generated-menu-item">
           <a class="link-dark d-inline-flex text-decoration-none rounded" href="A4.html" style="font-weight:bold;">
            D Equivalence between LQT and LQR with augmented state space
           </a>
          </li>
         </ul>
        </div>
       </li>
      </ul>
     </div>
    </div>
   </div>
  </nav>
  <div class="container-fluid">
   <!--<center><h1 class="title">My Title</h1></center>-->
   <div id="data_container">
    <div class="row">
     <div class="col-sm-7 offset-1">
      <div id="txt-col">
       <h1 class="ltx_title ltx_title_section">
        <span class="ltx_tag ltx_tag_section">
         <span class="ltx_text">
          7
         </span>
        </span>
        <span class="ltx_text">
         iLQR optimization
        </span>
       </h1>
       <div class="ltx_para" id="p1">
        <p class="ltx_p">
         Optimal control problems are defined by a cost function
         <span class="ltx_Math" id="p1.m1">
          \sum_{t=1}^{T}c(\bm{x}_{t},\bm{u}_{t})
         </span>
         to minimize and a dynamical system
         <span class="ltx_Math" id="p1.m2">
          \bm{x}_{t+1}=\bm{d}(\bm{x}_{t},\bm{u}_{t})
         </span>
         describing the evolution of a state
         <span class="ltx_Math" id="p1.m3">
          \bm{x}_{t}
         </span>
         driven by control commands
         <span class="ltx_Math" id="p1.m4">
          \bm{u}_{t}
         </span>
         during a time window of length
         <span class="ltx_Math" id="p1.m5">
          T
         </span>
         .
        </p>
       </div>
       <div class="ltx_para" id="p2">
        <p class="ltx_p">
         Iterative LQR (iLQR)
         <cite class="ltx_cite ltx_citemacro_cite">
          [
          <a class="ltx_ref" href="bib.html#bib7" title="Iterative linear quadratic regulator design for nonlinear biological movement systems">
           6
          </a>
          ]
         </cite>
         solves such constrained nonlinear models by carrying out Taylor expansions on the cost and on the dynamical system so that a solution can be found iteratively by solving a LQR problem at each iteration, similarly to differential dynamic programming approaches
         <cite class="ltx_cite ltx_citemacro_cite">
          [
          <a class="ltx_ref" href="bib.html#bib8" title="A second-order gradient method for determining optimal trajectories of non-linear discrete-time systems">
           8
          </a>
          ,
          <a class="ltx_ref" href="bib.html#bib9" title="Differential dynamic programming">
           14
          </a>
          ]
         </cite>
         .
        </p>
       </div>
       <div class="ltx_para" id="p3">
        <p class="ltx_p">
         iLQR employs a first order Taylor expansion of the dynamical system
         <span class="ltx_Math" id="p3.m1">
          \bm{x}_{t+1}=\bm{d}(\bm{x}_{t},\bm{u}_{t})
         </span>
         around the point
         <span class="ltx_Math" id="p3.m2">
          (\bm{\hat{x}}_{t},\bm{\hat{u}}_{t})
         </span>
         , namely
        </p>
        <div class="equation" style="display:flex;align-items:center;">
         <table class="ltx_equationgroup ltx_eqn_align ltx_eqn_table" id="A4.EGx13">
          <tbody id="Ex56">
           <tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
            <td class="ltx_eqn_cell ltx_eqn_center_padleft">
            </td>
            <td class="ltx_td ltx_align_right ltx_eqn_cell">
             <span class="ltx_Math" id="Ex56.m1">
              \displaystyle\bm{x}_{t+1}
             </span>
            </td>
            <td class="ltx_td ltx_align_left ltx_eqn_cell">
             <span class="ltx_Math" id="Ex56.m2">
              \displaystyle\approx\bm{d}(\bm{\hat{x}}_{t},\bm{\hat{u}}_{t})+\frac{\partial\bm{d}}{\partial\bm{x}_{t}}(\bm{x}_{t}-\bm{\hat{x}}_{t})+\frac{\partial\bm{d}}{\partial\bm{u}_{t}}(\bm{u}_{t}-\bm{\hat{u}}_{t})
             </span>
            </td>
            <td class="ltx_eqn_cell ltx_eqn_center_padright">
            </td>
           </tr>
          </tbody>
          <tbody id="eq:DS">
           <tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
            <td class="ltx_eqn_cell ltx_eqn_center_padleft">
            </td>
            <td class="ltx_td ltx_align_right ltx_eqn_cell">
             <span class="ltx_Math" id="E73.m1">
              \displaystyle\iff\Delta\bm{x}_{t+1}
             </span>
            </td>
            <td class="ltx_td ltx_align_left ltx_eqn_cell">
             <span class="ltx_Math" id="E73.m2">
              \displaystyle\approx\bm{A}_{t}\Delta\bm{x}_{t}+\bm{B}_{t}\Delta\bm{u}_{t},
             </span>
            </td>
            <td class="ltx_eqn_cell ltx_eqn_center_padright">
            </td>
           </tr>
          </tbody>
         </table>
         <div class="ltx_eqn_eqno">
          <div>
           (73)
          </div>
         </div>
        </div>
        <p class="ltx_p">
         with residual vectors
        </p>
        <div class="equation" style="display:flex;align-items:center;">
         <table class="ltx_equation ltx_eqn_table" id="Ex57">
          <tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
           <td class="ltx_eqn_cell ltx_eqn_center_padleft">
           </td>
           <td class="ltx_eqn_cell ltx_align_center">
            <span class="ltx_Math" id="Ex57.m1">
             \Delta\bm{x}_{t}\!=\!\bm{x}_{t}\!-\!\bm{\hat{x}}_{t},\quad\Delta\bm{u}_{t}\!=\!\bm{u}_{t}\!-\!\bm{\hat{u}}_{t},
            </span>
           </td>
           <td class="ltx_eqn_cell ltx_eqn_center_padright">
           </td>
          </tr>
         </table>
        </div>
        <p class="ltx_p">
         and Jacobian matrices
        </p>
        <div class="equation" style="display:flex;align-items:center;">
         <table class="ltx_equation ltx_eqn_table" id="Ex58">
          <tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
           <td class="ltx_eqn_cell ltx_eqn_center_padleft">
           </td>
           <td class="ltx_eqn_cell ltx_align_center">
            <span class="ltx_Math" id="Ex58.m1">
             \bm{A}_{t}=\frac{\partial\bm{d}}{\partial\bm{x}_{t}}\Big|_{\bm{\hat{x}}_{t},\bm{\hat{u}}_{t}},\quad\bm{B}_{t}=\frac{\partial\bm{d}}{\partial\bm{u}_{t}}\Big|_{\bm{\hat{x}}_{t},\bm{\hat{u}}_{t}}.
            </span>
           </td>
           <td class="ltx_eqn_cell ltx_eqn_center_padright">
           </td>
          </tr>
         </table>
        </div>
       </div>
       <div class="ltx_para" id="p4">
        <p class="ltx_p">
         The cost function
         <span class="ltx_Math" id="p4.m1">
          c(\bm{x}_{t},\bm{u}_{t})
         </span>
         for time step
         <span class="ltx_Math" id="p4.m2">
          t
         </span>
         can similarly be approximated by a second order Taylor expansion around the point
         <span class="ltx_Math" id="p4.m3">
          (\bm{\hat{x}}_{t},\bm{\hat{u}}_{t})
         </span>
         , namely
        </p>
        <div class="equation" style="display:flex;align-items:center;">
         <table class="ltx_equationgroup ltx_eqn_table" id="eq:dc">
          <tr class="ltx_equation ltx_eqn_row ltx_align_baseline" id="E74X">
           <td class="ltx_eqn_cell ltx_eqn_center_padleft">
           </td>
           <td class="ltx_td ltx_align_right ltx_eqn_cell">
            <span class="ltx_Math" id="E74X.m2">
             \displaystyle c(\bm{x}_{t},\bm{u}_{t})
            </span>
           </td>
           <td class="ltx_td ltx_align_left ltx_eqn_cell">
            <span class="ltx_Math" id="E74X.m3">
             \displaystyle\approx c(\bm{\hat{x}}_{t},\bm{\hat{u}}_{t})+\Delta\bm{x}_{t}^{\scriptscriptstyle\top}\frac{\partial c}{\partial\bm{x}_{t}}+\Delta\bm{u}_{t}^{\scriptscriptstyle\top}\frac{\partial c}{\partial\bm{u}_{t}}+\frac{1}{2}\Delta\bm{x}_{t}^{\scriptscriptstyle\top}\frac{\partial^{2}c}{\partial\bm{x}_{t}^{2}}\Delta\bm{x}_{t}+\Delta\bm{x}_{t}^{\scriptscriptstyle\top}\frac{\partial^{2}c}{\partial\bm{x}_{t}\bm{u}_{t}}\Delta\bm{u}_{t}+\frac{1}{2}\Delta\bm{u}_{t}^{\scriptscriptstyle\top}\frac{\partial^{2}c}{\partial\bm{u}_{t}^{2}}\Delta\bm{u}_{t},
            </span>
           </td>
           <td class="ltx_eqn_cell ltx_eqn_center_padright">
           </td>
          </tr>
          <tr class="ltx_equation ltx_eqn_row ltx_align_baseline" id="E74Xa">
           <td class="ltx_eqn_cell ltx_eqn_center_padleft">
           </td>
           <td class="ltx_td ltx_align_right ltx_eqn_cell">
            <span class="ltx_Math" id="E74Xa.m2">
             \displaystyle\iff c(\bm{x}_{t},\bm{u}_{t})
            </span>
           </td>
           <td class="ltx_td ltx_align_left ltx_eqn_cell">
            <span class="ltx_Math" id="E74Xa.m3">
             \displaystyle\approx c(\bm{\hat{x}}_{t},\bm{\hat{u}}_{t})+\frac{1}{2}\begin{bmatrix}1\\
\Delta\bm{x}_{t}\\
\Delta\bm{u}_{t}\end{bmatrix}^{\!{\scriptscriptstyle\top}}\begin{bmatrix}0&amp;\bm{g}_{\bm{x},t}^{\scriptscriptstyle\top}&amp;\bm{g}_{\bm{u},t}^{\scriptscriptstyle\top}\\
\bm{g}_{\bm{x},t}&amp;\bm{H}_{\bm{x}\bm{x},t}&amp;\bm{H}_{\bm{u}\bm{x},t}^{\scriptscriptstyle\top}\\
\bm{g}_{\bm{u},t}&amp;\bm{H}_{\bm{u}\bm{x},t}&amp;\bm{H}_{\bm{u}\bm{u},t}\\
\end{bmatrix}\begin{bmatrix}1\\
\Delta\bm{x}_{t}\\
\Delta\bm{u}_{t}\end{bmatrix},
            </span>
           </td>
           <td class="ltx_eqn_cell ltx_eqn_center_padright">
           </td>
          </tr>
         </table>
         <div class="ltx_eqn_eqno">
          <div>
           (74)
          </div>
         </div>
        </div>
        <p class="ltx_p">
         with gradients
        </p>
        <div class="equation" style="display:flex;align-items:center;">
         <table class="ltx_equation ltx_eqn_table" id="Ex59">
          <tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
           <td class="ltx_eqn_cell ltx_eqn_center_padleft">
           </td>
           <td class="ltx_eqn_cell ltx_align_center">
            <span class="ltx_Math" id="Ex59.m1">
             \bm{g}_{\bm{x},t}=\frac{\partial c}{\partial\bm{x}_{t}}\Big|_{\bm{\hat{x}}_{t},\bm{\hat{u}}_{t}},\quad\bm{g}_{\bm{u},t}=\frac{\partial c}{\partial\bm{u}_{t}}\Big|_{\bm{\hat{x}}_{t},\bm{\hat{u}}_{t}},
            </span>
           </td>
           <td class="ltx_eqn_cell ltx_eqn_center_padright">
           </td>
          </tr>
         </table>
        </div>
        <p class="ltx_p">
         and Hessian matrices
        </p>
        <div class="equation" style="display:flex;align-items:center;">
         <table class="ltx_equation ltx_eqn_table" id="Ex60">
          <tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
           <td class="ltx_eqn_cell ltx_eqn_center_padleft">
           </td>
           <td class="ltx_eqn_cell ltx_align_center">
            <span class="ltx_Math" id="Ex60.m1">
             \bm{H}_{\bm{x}\bm{x},t}=\frac{\partial^{2}c}{\partial\bm{x}_{t}^{2}}\Big|_{\bm{\hat{x}}_{t},\bm{\hat{u}}_{t}},\quad\bm{H}_{\bm{u}\bm{u},t}=\frac{\partial^{2}c}{\partial\bm{u}_{t}^{2}}\Big|_{\bm{\hat{x}}_{t},\bm{\hat{u}}_{t}},\quad\bm{H}_{\bm{u}\bm{x},t}=\frac{\partial^{2}c}{\partial\bm{u}_{t}\partial\bm{x}_{t}}\Big|_{\bm{\hat{x}}_{t},\bm{\hat{u}}_{t}}.
            </span>
           </td>
           <td class="ltx_eqn_cell ltx_eqn_center_padright">
           </td>
          </tr>
         </table>
        </div>
       </div>
       <div id="sec:iLQRbatch">
       </div>
       <h2 class="ltx_title ltx_title_subsection">
        <span class="ltx_tag ltx_tag_subsection">
         <span class="ltx_text">
          7.1
         </span>
        </span>
        <span class="ltx_text">
         Batch formulation of iLQR
        </span>
       </h2>
       <div class="ltx_para" id="SS1.p1">
        <p class="ltx_p">
         A solution in batch form can be computed by minimizing over
         <span class="ltx_Math" id="SS1.p1.m1">
          \bm{u}\!=\!{\begin{bmatrix}\bm{u}_{1}^{\scriptscriptstyle\top},\bm{u}_{2}^{\scriptscriptstyle\top},\ldots,\bm{u}_{T-1}^{\scriptscriptstyle\top}\end{bmatrix}}^{\scriptscriptstyle\top}
         </span>
         , yielding a series of open loop control commands
         <span class="ltx_Math" id="SS1.p1.m2">
          \bm{u}_{t}
         </span>
         , corresponding to a Gauss–Newton iteration scheme, see Section
         <a class="ltx_ref" href="S2.html#sec:GaussNewton" title="2.1 Gauss–Newton algorithm ‣ 2 Newton’s method for minimization ‣ A practical guide to learning and control problems in robotics solved with second-order optimization">
          <span class="ltx_text ltx_ref_tag">
           2.1
          </span>
         </a>
         .
        </p>
       </div>
       <div class="ltx_para" id="SS1.p2">
        <p class="ltx_p">
         At a trajectory level, we denote
         <span class="ltx_Math" id="SS1.p2.m1">
          \bm{x}\!=\!{\begin{bmatrix}\bm{x}_{1}^{\scriptscriptstyle\top},\bm{x}_{2}^{\scriptscriptstyle\top},\ldots,\bm{x}_{T}^{\scriptscriptstyle\top}\end{bmatrix}}^{\scriptscriptstyle\top}
         </span>
         the evolution of the state and
         <span class="ltx_Math" id="SS1.p2.m2">
          \bm{u}\!=\!{\begin{bmatrix}\bm{u}_{1}^{\scriptscriptstyle\top},\bm{u}_{2}^{\scriptscriptstyle\top},\ldots,\bm{u}_{T-1}^{\scriptscriptstyle\top}\end{bmatrix}}^{\scriptscriptstyle\top}
         </span>
         the evolution of the control commands.
The evolution of the state in (
         <a class="ltx_ref" href="#eq:DS" title="(73) ‣ 7 iLQR optimization ‣ A practical guide to learning and control problems in robotics solved with second-order optimization">
          <span class="ltx_text ltx_ref_tag">
           73
          </span>
         </a>
         ) becomes
         <span class="ltx_Math" id="SS1.p2.m3">
          \Delta\bm{x}=\bm{S}_{\bm{u}}\Delta\bm{u}
         </span>
         , see Appendix
         <a class="ltx_ref" href="A1.html" title="Appendix A System dynamics at trajectory level ‣ A practical guide to learning and control problems in robotics solved with second-order optimization">
          <span class="ltx_text ltx_ref_tag">
           A
          </span>
         </a>
         for details.
         <span class="ltx_note ltx_role_footnote" id="footnote1">
          <sup class="ltx_note_mark">
           1
          </sup>
          <span class="ltx_note_outer">
           <span class="ltx_note_content">
            <sup class="ltx_note_mark">
             1
            </sup>
            <span class="ltx_tag ltx_tag_note">
             1
            </span>
            Note that
            <span class="ltx_Math" id="footnote1.m1">
             \bm{S}_{\bm{x}}\Delta\bm{x}_{1}\!=\!\bm{0}
            </span>
            because
            <span class="ltx_Math" id="footnote1.m2">
             \Delta\bm{x}_{1}\!=\!\bm{0}
            </span>
            (as we want our motion to start from
            <span class="ltx_Math" id="footnote1.m3">
             \bm{x}_{1}
            </span>
            ).
           </span>
          </span>
         </span>
        </p>
       </div>
       <div class="ltx_para" id="SS1.p3">
        <p class="ltx_p">
         The minimization problem can then be rewritten in batch form as
        </p>
        <div class="equation" style="display:flex;align-items:center;">
         <table class="ltx_equation ltx_eqn_table" id="eq:dc_batch">
          <tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
           <td class="ltx_eqn_cell ltx_eqn_center_padleft">
           </td>
           <td class="ltx_eqn_cell ltx_align_center">
            <span class="ltx_Math" id="E75.m1">
             \min_{\Delta\bm{u}}\Delta c(\Delta\bm{x},\Delta\bm{u}),\quad\text{s.t.}\quad\Delta\bm{x}=\bm{S}_{\bm{u}}\Delta\bm{u},\quad\text{where}\quad\Delta c(\Delta\bm{x},\Delta\bm{u})=\frac{1}{2}\begin{bmatrix}1\\
\Delta\bm{x}\\
\Delta\bm{u}\end{bmatrix}^{\!{\scriptscriptstyle\top}}\begin{bmatrix}0&amp;\bm{g}_{\bm{x}}^{\scriptscriptstyle\top}&amp;\bm{g}_{\bm{u}}^{\scriptscriptstyle\top}\\
\bm{g}_{\bm{x}}&amp;\bm{H}_{\bm{x}\bm{x}}&amp;\bm{H}_{\bm{u}\bm{x}}^{\scriptscriptstyle\top}\\
\bm{g}_{\bm{u}}&amp;\bm{H}_{\bm{u}\bm{x}}&amp;\bm{H}_{\bm{u}\bm{u}}\\
\end{bmatrix}\begin{bmatrix}1\\
\Delta\bm{x}\\
\Delta\bm{u}\end{bmatrix}.
            </span>
           </td>
           <td class="ltx_eqn_cell ltx_eqn_center_padright">
           </td>
          </tr>
         </table>
         <div class="ltx_eqn_eqno">
          <div>
           (75)
          </div>
         </div>
        </div>
       </div>
       <div class="ltx_para" id="SS1.p4">
        <p class="ltx_p">
         By inserting the constraint into the cost, we obtain the optimization problem
        </p>
        <div class="equation" style="display:flex;align-items:center;">
         <table class="ltx_equation ltx_eqn_table" id="eq:minu">
          <tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
           <td class="ltx_eqn_cell ltx_eqn_center_padleft">
           </td>
           <td class="ltx_eqn_cell ltx_align_center">
            <span class="ltx_Math" id="E76.m1">
             \min_{\Delta\bm{u}}\quad\Delta\bm{u}^{\scriptscriptstyle\top}\bm{S}_{\bm{u}}^{\scriptscriptstyle\top}\bm{g}_{\bm{x}}+\Delta\bm{u}^{\scriptscriptstyle\top}\bm{g}_{\bm{u}}+\frac{1}{2}\Delta\bm{u}^{\scriptscriptstyle\top}\bm{S}_{\bm{u}}^{\scriptscriptstyle\top}\bm{H}_{\bm{x}\bm{x}}\bm{S}_{\bm{u}}\Delta\bm{u}+\Delta\bm{u}^{\scriptscriptstyle\top}\bm{S}_{\bm{u}}^{\scriptscriptstyle\top}\bm{H}_{\bm{u}\bm{x}}^{\scriptscriptstyle\top}\Delta\bm{u}+\frac{1}{2}\Delta\bm{u}^{\scriptscriptstyle\top}\bm{H}_{\bm{u}\bm{u}}\Delta\bm{u},
            </span>
           </td>
           <td class="ltx_eqn_cell ltx_eqn_center_padright">
           </td>
          </tr>
         </table>
         <div class="ltx_eqn_eqno">
          <div>
           (76)
          </div>
         </div>
        </div>
        <p class="ltx_p">
         which can be solved analytically by differentiating with respect to
         <span class="ltx_Math" id="SS1.p4.m1">
          \Delta\bm{u}
         </span>
         and equating to zero, namely,
        </p>
        <div class="equation" style="display:flex;align-items:center;">
         <table class="ltx_equation ltx_eqn_table" id="E77">
          <tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
           <td class="ltx_eqn_cell ltx_eqn_center_padleft">
           </td>
           <td class="ltx_eqn_cell ltx_align_center">
            <span class="ltx_Math" id="E77.m1">
             \bm{S}_{\bm{u}}^{\scriptscriptstyle\top}\bm{g}_{\bm{x}}+\bm{g}_{\bm{u}}+\\
\bm{S}_{\bm{u}}^{\scriptscriptstyle\top}\bm{H}_{\bm{x}\bm{x}}\bm{S}_{\bm{u}}\Delta\bm{u}+2\bm{S}_{\bm{u}}^{\scriptscriptstyle\top}\bm{H}_{\bm{u}\bm{x}}^{\scriptscriptstyle\top}\Delta\bm{u}+\bm{H}_{\bm{u}\bm{u}}\Delta\bm{u}=0,
            </span>
           </td>
           <td class="ltx_eqn_cell ltx_eqn_center_padright">
           </td>
          </tr>
         </table>
         <div class="ltx_eqn_eqno">
          <div>
           (77)
          </div>
         </div>
        </div>
        <p class="ltx_p">
         providing the least squares solution
        </p>
        <div class="equation" style="display:flex;align-items:center;">
         <table class="ltx_equation ltx_eqn_table" id="eq:du_general">
          <tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
           <td class="ltx_eqn_cell ltx_eqn_center_padleft">
           </td>
           <td class="ltx_eqn_cell ltx_align_center">
            <span class="ltx_Math" id="E78.m1">
             \Delta\bm{\hat{u}}={\left(\bm{S}_{\bm{u}}^{\scriptscriptstyle\top}\bm{H}_{\bm{x}\bm{x}}\bm{S}_{\bm{u}}+2\bm{S}_{\bm{u}}^{\scriptscriptstyle\top}\bm{H}_{\bm{u}\bm{x}}^{\scriptscriptstyle\top}+\bm{H}_{\bm{u}\bm{u}}\right)}^{-1}\left(-\bm{S}_{\bm{u}}^{\scriptscriptstyle\top}\bm{g}_{\bm{x}}-\bm{g}_{\bm{u}}\right),
            </span>
           </td>
           <td class="ltx_eqn_cell ltx_eqn_center_padright">
           </td>
          </tr>
         </table>
         <div class="ltx_eqn_eqno">
          <div>
           (78)
          </div>
         </div>
        </div>
        <p class="ltx_p">
         which can be used to update the control commands estimate at each iteration step of the iLQR algorithm.
        </p>
       </div>
       <div class="ltx_para" id="SS1.p5">
        <p class="ltx_p">
         The complete iLQR procedure is described in Algorithm
         <a class="ltx_ref" href="#alg:iLQRbatch" title="Algorithm 4 ‣ 7.4 Updates by considering step sizes ‣ 7 iLQR optimization ‣ A practical guide to learning and control problems in robotics solved with second-order optimization">
          <span class="ltx_text ltx_ref_tag">
           4
          </span>
         </a>
         (including backtracking line search). Figure
         <a class="ltx_ref" href="#fig:iLQR_summary" title="Figure 15 ‣ 7.1 Batch formulation of iLQR ‣ 7 iLQR optimization ‣ A practical guide to learning and control problems in robotics solved with second-order optimization">
          <span class="ltx_text ltx_ref_tag">
           15
          </span>
         </a>
         also presents an illustrative summary of the iLQR optimization procedure in batch form.
        </p>
       </div>
       <div id="sec:iLQRrecursive">
       </div>
       <h2 class="ltx_title ltx_title_subsection">
        <span class="ltx_tag ltx_tag_subsection">
         <span class="ltx_text">
          7.2
         </span>
        </span>
        <span class="ltx_text">
         Recursive formulation of iLQR
        </span>
       </h2>
       <div class="ltx_para" id="SS2.p1">
        <p class="ltx_p">
         A solution can alternatively be computed in a recursive form to provide a controller with feedback gains. Section
         <a class="ltx_ref" href="S6.html#sec:LQRrecursive" title="6.3 LQR with a recursive formulation ‣ 6 Linear quadratic tracking (LQT) ‣ A practical guide to learning and control problems in robotics solved with second-order optimization">
          <span class="ltx_text ltx_ref_tag">
           6.3
          </span>
         </a>
         presented the dynamic programming principle in the context of linear quadratic regulation problems, which allowed us to reduce the minimization over an entire sequence of control commands to a sequence of minimization problems over control commands at a single time step, by proceeding backwards in time. In this section, the approach is extended to iLQR.
        </p>
       </div>
       <div class="ltx_para" id="SS2.p2">
        <p class="ltx_p">
         Similarly to (
         <a class="ltx_ref" href="S6.html#eq:qtLQR" title="(62) ‣ 6.3 LQR with a recursive formulation ‣ 6 Linear quadratic tracking (LQT) ‣ A practical guide to learning and control problems in robotics solved with second-order optimization">
          <span class="ltx_text ltx_ref_tag">
           62
          </span>
         </a>
         ), we have here
        </p>
        <div class="equation" style="display:flex;align-items:center;">
         <table class="ltx_equationgroup ltx_eqn_align ltx_eqn_table" id="A4.EGx14">
          <tbody id="eq:qtiLQR">
           <tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
            <td class="ltx_eqn_cell ltx_eqn_center_padleft">
            </td>
            <td class="ltx_td ltx_align_right ltx_eqn_cell">
             <span class="ltx_Math" id="E79.m1">
              \displaystyle\hat{v}_{t}(\Delta\bm{x}_{t})
             </span>
            </td>
            <td class="ltx_td ltx_align_left ltx_eqn_cell">
             <span class="ltx_Math" id="E79.m2">
              \displaystyle=\min_{\Delta\bm{u}_{t}}\,\underbrace{c_{t}(\Delta\bm{x}_{t},\Delta\bm{u}_{t})+\hat{v}_{t+1}(\Delta\bm{x}_{t+1})}_{q_{t}(\Delta\bm{x}_{t},\Delta\bm{u}_{t})},
             </span>
            </td>
            <td class="ltx_eqn_cell ltx_eqn_center_padright">
            </td>
           </tr>
          </tbody>
         </table>
         <div class="ltx_eqn_eqno">
          <div>
           (79)
          </div>
         </div>
        </div>
       </div>
       <div class="ltx_para" id="SS2.p3">
        <p class="ltx_p">
         Similarly to LQR, by starting from the last time step
         <span class="ltx_Math" id="SS2.p3.m1">
          T
         </span>
         ,
         <span class="ltx_Math" id="SS2.p3.m2">
          \hat{v}_{T}(\Delta\bm{x}_{T})
         </span>
         is independent of the control commands. By relabeling
         <span class="ltx_Math" id="SS2.p3.m3">
          \bm{g}_{\bm{x},T}
         </span>
         and
         <span class="ltx_Math" id="SS2.p3.m4">
          \bm{H}_{\bm{x}\bm{x},T}
         </span>
         as
         <span class="ltx_Math" id="SS2.p3.m5">
          \bm{v}_{\bm{x},T}
         </span>
         and
         <span class="ltx_Math" id="SS2.p3.m6">
          \bm{V}_{\bm{x}\bm{x},T}
         </span>
         , we can show that
         <span class="ltx_Math" id="SS2.p3.m7">
          \hat{v}_{T-1}
         </span>
         has the same quadratic form as
         <span class="ltx_Math" id="SS2.p3.m8">
          \hat{v}_{T}
         </span>
         , enabling the backward recursive computation of
         <span class="ltx_Math" id="SS2.p3.m9">
          \hat{v}_{t}
         </span>
         from
         <span class="ltx_Math" id="SS2.p3.m10">
          t=T-1
         </span>
         to
         <span class="ltx_Math" id="SS2.p3.m11">
          t=1
         </span>
         .
        </p>
       </div>
       <div class="ltx_para" id="SS2.p4">
        <p class="ltx_p">
         This dynamic programming recursion takes the form
        </p>
        <div class="equation" style="display:flex;align-items:center;">
         <table class="ltx_equation ltx_eqn_table" id="eq:vhatTiLQR">
          <tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
           <td class="ltx_eqn_cell ltx_eqn_center_padleft">
           </td>
           <td class="ltx_eqn_cell ltx_align_center">
            <span class="ltx_Math" id="E80.m1">
             \hat{v}_{t+1}=\begin{bmatrix}1\\
\Delta\bm{x}_{t+1}\end{bmatrix}^{\!{\scriptscriptstyle\top}}\begin{bmatrix}0&amp;\bm{v}_{\bm{x},{t+1}}^{\scriptscriptstyle\top}\\
\bm{v}_{\bm{x},{t+1}}&amp;\bm{V}_{\bm{x}\bm{x},{t+1}}\end{bmatrix}\begin{bmatrix}1\\
\Delta\bm{x}_{t+1}\end{bmatrix},
            </span>
           </td>
           <td class="ltx_eqn_cell ltx_eqn_center_padright">
           </td>
          </tr>
         </table>
         <div class="ltx_eqn_eqno">
          <div>
           (80)
          </div>
         </div>
        </div>
        <p class="ltx_p">
         and we then have with (
         <a class="ltx_ref" href="#eq:qtiLQR" title="(79) ‣ 7.2 Recursive formulation of iLQR ‣ 7 iLQR optimization ‣ A practical guide to learning and control problems in robotics solved with second-order optimization">
          <span class="ltx_text ltx_ref_tag">
           79
          </span>
         </a>
         ) that
        </p>
        <div class="equation" style="display:flex;align-items:center;">
         <table class="ltx_equation ltx_eqn_table" id="eq:ct0iLQR">
          <tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
           <td class="ltx_eqn_cell ltx_eqn_center_padleft">
           </td>
           <td class="ltx_eqn_cell ltx_align_center">
            <span class="ltx_Math" id="E81.m1">
             \hat{v}_{t}=\min_{\Delta\bm{u}_{t}}\begin{bmatrix}1\\
\Delta\bm{x}_{t}\\
\Delta\bm{u}_{t}\end{bmatrix}^{\!{\scriptscriptstyle\top}}\begin{bmatrix}0&amp;\bm{g}_{\bm{x},{t}}^{\scriptscriptstyle\top}&amp;\bm{g}_{\bm{u},{t}}^{\scriptscriptstyle\top}\\
\bm{g}_{\bm{x},{t}}&amp;\bm{H}_{\bm{x}\bm{x},{t}}&amp;\bm{H}_{\bm{u}\bm{x},{t}}^{\scriptscriptstyle\top}\\
\bm{g}_{\bm{u},{t}}&amp;\bm{H}_{\bm{u}\bm{x},{t}}&amp;\bm{H}_{\bm{u}\bm{u},{t}}\\
\end{bmatrix}\begin{bmatrix}1\\
\Delta\bm{x}_{t}\\
\Delta\bm{u}_{t}\end{bmatrix}+\begin{bmatrix}1\\
\Delta\bm{x}_{t+1}\end{bmatrix}^{\!{\scriptscriptstyle\top}}\begin{bmatrix}0&amp;\bm{v}_{\bm{x},{t+1}}^{\scriptscriptstyle\top}\\
\bm{v}_{\bm{x},{t+1}}&amp;\bm{V}_{\bm{x}\bm{x},{t+1}}\end{bmatrix}\begin{bmatrix}1\\
\Delta\bm{x}_{t+1}\end{bmatrix}.
            </span>
           </td>
           <td class="ltx_eqn_cell ltx_eqn_center_padright">
           </td>
          </tr>
         </table>
         <div class="ltx_eqn_eqno">
          <div>
           (81)
          </div>
         </div>
        </div>
       </div>
       <div class="ltx_para" id="SS2.p5">
        <p class="ltx_p">
         By substituting
         <span class="ltx_Math" id="SS2.p5.m1">
          \Delta\bm{x}_{t+1}=\bm{A}_{t}\Delta\bm{x}_{t}+\bm{B}_{t}\Delta\bm{u}_{t}
         </span>
         into (
         <a class="ltx_ref" href="#eq:ct0iLQR" title="(81) ‣ 7.2 Recursive formulation of iLQR ‣ 7 iLQR optimization ‣ A practical guide to learning and control problems in robotics solved with second-order optimization">
          <span class="ltx_text ltx_ref_tag">
           81
          </span>
         </a>
         ),
         <span class="ltx_Math" id="SS2.p5.m2">
          \hat{v}_{t}
         </span>
         can be rewritten as
        </p>
        <div class="equation" style="display:flex;align-items:center;">
         <table class="ltx_equation ltx_eqn_table" id="eq:qt">
          <tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
           <td class="ltx_eqn_cell ltx_eqn_center_padleft">
           </td>
           <td class="ltx_eqn_cell ltx_align_center">
            <span class="ltx_Math" id="E82.m1">
             \hat{v}_{t}=\min_{\Delta\bm{u}_{t}}\begin{bmatrix}1\\
\Delta\bm{x}_{t}\\
\Delta\bm{u}_{t}\end{bmatrix}^{\!\!{\scriptscriptstyle\top}}\!\!\begin{bmatrix}0&amp;\bm{q}_{\bm{x},t}^{\scriptscriptstyle\top}&amp;\bm{q}_{\bm{u},t}^{\scriptscriptstyle\top}\\
\bm{q}_{\bm{x},t}&amp;\bm{Q}_{\bm{x}\bm{x},t}&amp;\bm{Q}_{\bm{u}\bm{x},t}^{\scriptscriptstyle\top}\\
\bm{q}_{\bm{u},t}&amp;\bm{Q}_{\bm{u}\bm{x},t}&amp;\bm{Q}_{\bm{u}\bm{u},t}\\
\end{bmatrix}\!\!\begin{bmatrix}1\\
\Delta\bm{x}_{t}\\
\Delta\bm{u}_{t}\end{bmatrix},\quad\text{where}\quad\left\{\begin{aligned} \bm{q}_{\bm{x},t}&amp;=\bm{g}_{\bm{x},t}+\bm{A}_{t}^{\scriptscriptstyle\top}\bm{v}_{\bm{x},t+1},\\
\bm{q}_{\bm{u},t}&amp;=\bm{g}_{\bm{u},t}+\bm{B}_{t}^{\scriptscriptstyle\top}\,\bm{v}_{\bm{x},t+1},\\
\bm{Q}_{\bm{x}\bm{x},t}&amp;\approx\bm{H}_{\bm{x}\bm{x},t}+\bm{A}_{t}^{\scriptscriptstyle\top}\,\bm{V}_{\bm{x}\bm{x},t+1}\,\bm{A}_{t},\\
\bm{Q}_{\bm{u}\bm{u},t}&amp;\approx\bm{H}_{\bm{u}\bm{u},t}+\bm{B}_{t}^{\scriptscriptstyle\top}\,\bm{V}_{\bm{x}\bm{x},t+1}\,\bm{B}_{t},\\
\bm{Q}_{\bm{u}\bm{x},t}&amp;\approx\bm{H}_{\bm{u}\bm{x},t}+\bm{B}_{t}^{\scriptscriptstyle\top}\,\bm{V}_{\bm{x}\bm{x},t+1}\,\bm{A}_{t},\end{aligned}\right.
            </span>
           </td>
           <td class="ltx_eqn_cell ltx_eqn_center_padright">
           </td>
          </tr>
         </table>
         <div class="ltx_eqn_eqno">
          <div>
           (82)
          </div>
         </div>
        </div>
        <p class="ltx_p">
         with gradients
        </p>
        <div class="equation" style="display:flex;align-items:center;">
         <table class="ltx_equation ltx_eqn_table" id="Ex61">
          <tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
           <td class="ltx_eqn_cell ltx_eqn_center_padleft">
           </td>
           <td class="ltx_eqn_cell ltx_align_center">
            <span class="ltx_Math" id="Ex61.m1">
             \bm{g}_{\bm{x},t}=\frac{\partial c}{\partial\bm{x}_{t}}\Big|_{\bm{\hat{x}}_{t},\bm{\hat{u}}_{t}},\quad\bm{g}_{\bm{u},t}=\frac{\partial c}{\partial\bm{u}_{t}}\Big|_{\bm{\hat{x}}_{t},\bm{\hat{u}}_{t}},\quad\bm{v}_{\bm{x},t}=\frac{\partial\hat{v}}{\partial\bm{x}_{t}}\Big|_{\bm{\hat{x}}_{t},\bm{\hat{u}}_{t}},\quad\bm{q}_{\bm{x},t}=\frac{\partial q}{\partial\bm{x}_{t}}\Big|_{\bm{\hat{x}}_{t},\bm{\hat{u}}_{t}},\quad\bm{q}_{\bm{u},t}=\frac{\partial q}{\partial\bm{u}_{t}}\Big|_{\bm{\hat{x}}_{t},\bm{\hat{u}}_{t}},
            </span>
           </td>
           <td class="ltx_eqn_cell ltx_eqn_center_padright">
           </td>
          </tr>
         </table>
        </div>
        <p class="ltx_p">
         Jacobian matrices
        </p>
        <div class="equation" style="display:flex;align-items:center;">
         <table class="ltx_equation ltx_eqn_table" id="Ex62">
          <tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
           <td class="ltx_eqn_cell ltx_eqn_center_padleft">
           </td>
           <td class="ltx_eqn_cell ltx_align_center">
            <span class="ltx_Math" id="Ex62.m1">
             \bm{A}_{t}=\frac{\partial\bm{d}}{\partial\bm{x}_{t}}\Big|_{\bm{\hat{x}}_{t},\bm{\hat{u}}_{t}},\quad\bm{B}_{t}=\frac{\partial\bm{d}}{\partial\bm{u}_{t}}\Big|_{\bm{\hat{x}}_{t},\bm{\hat{u}}_{t}},
            </span>
           </td>
           <td class="ltx_eqn_cell ltx_eqn_center_padright">
           </td>
          </tr>
         </table>
        </div>
        <p class="ltx_p">
         and Hessian matrices
        </p>
        <div class="equation" style="display:flex;align-items:center;">
         <table class="ltx_equation ltx_eqn_table" id="Ex63">
          <tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
           <td class="ltx_eqn_cell ltx_eqn_center_padleft">
           </td>
           <td class="ltx_eqn_cell ltx_align_center">
            <span class="ltx_Math" id="Ex63.m1">
             \bm{H}_{\bm{x}\bm{x},t}\!=\!\frac{\partial^{2}c}{\partial\bm{x}_{t}^{2}}\Big|_{\bm{\hat{x}}_{t},\bm{\hat{u}}_{t}},\quad\bm{H}_{\bm{u}\bm{u},t}\!=\!\frac{\partial^{2}c}{\partial\bm{u}_{t}^{2}}\Big|_{\bm{\hat{x}}_{t},\bm{\hat{u}}_{t}},\quad\bm{H}_{\bm{u}\bm{x},t}\!=\!\frac{\partial^{2}c}{\partial\bm{u}_{t}\partial\bm{x}_{t}}\Big|_{\bm{\hat{x}}_{t},\bm{\hat{u}}_{t}},\quad\bm{V}_{\bm{x}\bm{x},t}\!=\!\frac{\partial^{2}\hat{v}}{\partial\bm{x}_{t}^{2}}\Big|_{\bm{\hat{x}}_{t},\bm{\hat{u}}_{t}},
            </span>
           </td>
           <td class="ltx_eqn_cell ltx_eqn_center_padright">
           </td>
          </tr>
         </table>
        </div>
        <div class="equation" style="display:flex;align-items:center;">
         <table class="ltx_equation ltx_eqn_table" id="Ex64">
          <tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
           <td class="ltx_eqn_cell ltx_eqn_center_padleft">
           </td>
           <td class="ltx_eqn_cell ltx_align_center">
            <span class="ltx_Math" id="Ex64.m1">
             \bm{Q}_{\bm{x}\bm{x},t}=\frac{\partial^{2}q}{\partial\bm{x}_{t}^{2}}\Big|_{\bm{\hat{x}}_{t},\bm{\hat{u}}_{t}},\quad\bm{Q}_{\bm{u}\bm{u},t}=\frac{\partial^{2}q}{\partial\bm{u}_{t}^{2}}\Big|_{\bm{\hat{x}}_{t},\bm{\hat{u}}_{t}},\quad\bm{Q}_{\bm{u}\bm{x},t}=\frac{\partial^{2}q}{\partial\bm{u}_{t}\partial\bm{x}_{t}}\Big|_{\bm{\hat{x}}_{t},\bm{\hat{u}}_{t}}.
            </span>
           </td>
           <td class="ltx_eqn_cell ltx_eqn_center_padright">
           </td>
          </tr>
         </table>
        </div>
       </div>
       <div class="ltx_para" id="SS2.p6">
        <p class="ltx_p">
         Minimizing (
         <a class="ltx_ref" href="#eq:qt" title="(82) ‣ 7.2 Recursive formulation of iLQR ‣ 7 iLQR optimization ‣ A practical guide to learning and control problems in robotics solved with second-order optimization">
          <span class="ltx_text ltx_ref_tag">
           82
          </span>
         </a>
         ) w.r.t.
         <span class="ltx_Math" id="SS2.p6.m1">
          \Delta\bm{u}_{t}
         </span>
         can be achieved by differentiating the equation and equating to zero, yielding the controller
        </p>
        <div class="equation" style="display:flex;align-items:center;">
         <table class="ltx_equation ltx_eqn_table" id="eq:duhat">
          <tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
           <td class="ltx_eqn_cell ltx_eqn_center_padleft">
           </td>
           <td class="ltx_eqn_cell ltx_align_center">
            <span class="ltx_Math" id="E83.m1">
             \Delta\bm{\hat{u}}_{t}=\bm{k}_{t}+\bm{K}_{t}\,\Delta\bm{x}_{t},\;\text{with}\quad\left\{\begin{aligned} \bm{k}_{t}&amp;=-\bm{Q}_{\bm{u}\bm{u},t}^{-1}\,\bm{q}_{\bm{u},t},\\
\bm{K}_{t}&amp;=-\bm{Q}_{\bm{u}\bm{u},t}^{-1}\,\bm{Q}_{\bm{u}\bm{x},t},\end{aligned}\right.
            </span>
           </td>
           <td class="ltx_eqn_cell ltx_eqn_center_padright">
           </td>
          </tr>
         </table>
         <div class="ltx_eqn_eqno">
          <div>
           (83)
          </div>
         </div>
        </div>
        <p class="ltx_p">
         where
         <span class="ltx_Math" id="SS2.p6.m2">
          \bm{k}_{t}
         </span>
         is a feedforward command and
         <span class="ltx_Math" id="SS2.p6.m3">
          \bm{K}_{t}
         </span>
         is a feedback gain matrix.
        </p>
       </div>
       <div class="ltx_para" id="SS2.p7">
        <p class="ltx_p">
         By inserting (
         <a class="ltx_ref" href="#eq:duhat" title="(83) ‣ 7.2 Recursive formulation of iLQR ‣ 7 iLQR optimization ‣ A practical guide to learning and control problems in robotics solved with second-order optimization">
          <span class="ltx_text ltx_ref_tag">
           83
          </span>
         </a>
         ) into (
         <a class="ltx_ref" href="#eq:qt" title="(82) ‣ 7.2 Recursive formulation of iLQR ‣ 7 iLQR optimization ‣ A practical guide to learning and control problems in robotics solved with second-order optimization">
          <span class="ltx_text ltx_ref_tag">
           82
          </span>
         </a>
         ), we get the recursive updates
        </p>
        <div class="equation" style="display:flex;align-items:center;">
         <table class="ltx_equationgroup ltx_eqn_table" id="eq:vV">
          <tr class="ltx_equation ltx_eqn_row ltx_align_baseline" id="E84X">
           <td class="ltx_eqn_cell ltx_eqn_center_padleft">
           </td>
           <td class="ltx_td ltx_align_right ltx_eqn_cell">
            <span class="ltx_Math" id="E84X.m2">
             \displaystyle\bm{v}_{\bm{x},t}
            </span>
           </td>
           <td class="ltx_td ltx_align_left ltx_eqn_cell">
            <span class="ltx_Math" id="E84X.m3">
             \displaystyle=\bm{q}_{\bm{x},t}-\bm{Q}_{\bm{u}\bm{x},t}^{\scriptscriptstyle\top}\,\bm{Q}_{\bm{u}\bm{u},t}^{-1}\,\bm{q}_{\bm{u},t},
            </span>
           </td>
           <td class="ltx_eqn_cell ltx_eqn_center_padright">
           </td>
          </tr>
          <tr class="ltx_equation ltx_eqn_row ltx_align_baseline" id="E84Xa">
           <td class="ltx_eqn_cell ltx_eqn_center_padleft">
           </td>
           <td class="ltx_td ltx_align_right ltx_eqn_cell">
            <span class="ltx_Math" id="E84Xa.m2">
             \displaystyle\bm{V}_{\bm{x}\bm{x},t}
            </span>
           </td>
           <td class="ltx_td ltx_align_left ltx_eqn_cell">
            <span class="ltx_Math" id="E84Xa.m3">
             \displaystyle=\bm{Q}_{\bm{x}\bm{x},t}-\bm{Q}_{\bm{u}\bm{x},t}^{\scriptscriptstyle\top}\,\bm{Q}_{\bm{u}\bm{u},t}^{-1}\,\bm{Q}_{\bm{u}\bm{x},t}.
            </span>
           </td>
           <td class="ltx_eqn_cell ltx_eqn_center_padright">
           </td>
          </tr>
         </table>
         <div class="ltx_eqn_eqno">
          <div>
           (84)
          </div>
         </div>
        </div>
       </div>
       <div class="ltx_para" id="SS2.p8">
        <p class="ltx_p">
         In this recursive iLQR formulation, at each iteration step of the optimization algorithm, the nominal trajectories
         <span class="ltx_Math" id="SS2.p8.m1">
          (\bm{\hat{x}}_{t},\bm{\hat{u}}_{t})
         </span>
         are refined, together with feedback matrices
         <span class="ltx_Math" id="SS2.p8.m2">
          \bm{K}_{t}
         </span>
         . Thus, at each iteration step of the optimization algorithm, a backward and forward recursion is performed to evaluate these vectors and matrices. There is thus two types of iterations: one for the optimization algorithm, and one for the dynamic programming recursion performed at each given iteration.
        </p>
       </div>
       <div class="ltx_para" id="SS2.p9">
        <p class="ltx_p">
         After convergence, by using (
         <a class="ltx_ref" href="#eq:duhat" title="(83) ‣ 7.2 Recursive formulation of iLQR ‣ 7 iLQR optimization ‣ A practical guide to learning and control problems in robotics solved with second-order optimization">
          <span class="ltx_text ltx_ref_tag">
           83
          </span>
         </a>
         ) and the nominal trajectories in the state and control spaces
         <span class="ltx_Math" id="SS2.p9.m1">
          (\bm{\hat{x}}_{t},\bm{\hat{u}}_{t})
         </span>
         , the resulting controller at each time step
         <span class="ltx_Math" id="SS2.p9.m2">
          t
         </span>
         is
        </p>
        <div class="equation" style="display:flex;align-items:center;">
         <table class="ltx_equation ltx_eqn_table" id="eq:iLQRrecursiveController">
          <tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
           <td class="ltx_eqn_cell ltx_eqn_center_padleft">
           </td>
           <td class="ltx_eqn_cell ltx_align_center">
            <span class="ltx_Math" id="E85.m1">
             \bm{u}_{t}=\bm{\hat{u}}_{t}+\bm{K}_{t}\,(\bm{\hat{x}}_{t}-\bm{x}_{t}),
            </span>
           </td>
           <td class="ltx_eqn_cell ltx_eqn_center_padright">
           </td>
          </tr>
         </table>
         <div class="ltx_eqn_eqno">
          <div>
           (85)
          </div>
         </div>
        </div>
        <p class="ltx_p">
         where the evolution of the state is described by
         <span class="ltx_Math" id="SS2.p9.m3">
          \bm{x}_{t+1}=\bm{d}(\bm{x}_{t},\bm{u}_{t})
         </span>
         .
        </p>
       </div>
       <div class="ltx_para" id="SS2.p10">
        <p class="ltx_p">
         The complete iLQR procedure is described in Algorithm
         <a class="ltx_ref" href="#alg:iLQRrecursive" title="Algorithm 5 ‣ 7.4 Updates by considering step sizes ‣ 7 iLQR optimization ‣ A practical guide to learning and control problems in robotics solved with second-order optimization">
          <span class="ltx_text ltx_ref_tag">
           5
          </span>
         </a>
         (including backtracking line search).
        </p>
       </div>
       <div id="sec:iLQRLS">
       </div>
       <h2 class="ltx_title ltx_title_subsection">
        <span class="ltx_tag ltx_tag_subsection">
         <span class="ltx_text">
          7.3
         </span>
        </span>
        <span class="ltx_text">
         Least squares formulation of recursive iLQR
        </span>
       </h2>
       <div class="ltx_para" id="SS3.p1">
        <p class="ltx_p">
         First, note that (
         <a class="ltx_ref" href="#eq:duhat" title="(83) ‣ 7.2 Recursive formulation of iLQR ‣ 7 iLQR optimization ‣ A practical guide to learning and control problems in robotics solved with second-order optimization">
          <span class="ltx_text ltx_ref_tag">
           83
          </span>
         </a>
         ) can be rewritten as
        </p>
        <div class="equation" style="display:flex;align-items:center;">
         <table class="ltx_equation ltx_eqn_table" id="eq:duhat2">
          <tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
           <td class="ltx_eqn_cell ltx_eqn_center_padleft">
           </td>
           <td class="ltx_eqn_cell ltx_align_center">
            <span class="ltx_Math" id="E86.m1">
             \Delta\bm{\hat{u}}_{t}=\bm{\tilde{K}}_{t}\,\begin{bmatrix}\Delta\bm{x}_{t}\\
1\end{bmatrix},\;\text{with}\quad\bm{\tilde{K}}_{t}=-\bm{Q}_{\bm{u}\bm{u},t}^{-1}\Big[\bm{Q}_{\bm{u}\bm{x},t},\;\bm{q}_{\bm{u},t}\Big].
            </span>
           </td>
           <td class="ltx_eqn_cell ltx_eqn_center_padright">
           </td>
          </tr>
         </table>
         <div class="ltx_eqn_eqno">
          <div>
           (86)
          </div>
         </div>
        </div>
       </div>
       <div class="ltx_para" id="SS3.p2">
        <p class="ltx_p">
         Also, (
         <a class="ltx_ref" href="#eq:minu" title="(76) ‣ 7.1 Batch formulation of iLQR ‣ 7 iLQR optimization ‣ A practical guide to learning and control problems in robotics solved with second-order optimization">
          <span class="ltx_text ltx_ref_tag">
           76
          </span>
         </a>
         ) can be rewritten as
        </p>
        <div class="equation" style="display:flex;align-items:center;">
         <table class="ltx_equation ltx_eqn_table" id="Ex65">
          <tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
           <td class="ltx_eqn_cell ltx_eqn_center_padleft">
           </td>
           <td class="ltx_eqn_cell ltx_align_center">
            <span class="ltx_Math" id="Ex65.m1">
             \min_{\Delta\bm{u}}\quad\underbrace{\frac{1}{2}\begin{bmatrix}\Delta\bm{u}\\
1\end{bmatrix}^{\scriptscriptstyle\top}\begin{bmatrix}\bm{C}&amp;\bm{c}\\
\bm{c}^{\scriptscriptstyle\top}&amp;0\end{bmatrix}\begin{bmatrix}\Delta\bm{u}\\
1\end{bmatrix}}_{\frac{1}{2}\Delta\bm{u}^{\scriptscriptstyle\top}\bm{C}\Delta\bm{u}+\Delta\bm{u}^{\scriptscriptstyle\top}\bm{c}},\quad\text{where}\quad\left\{\begin{aligned} \bm{c}&amp;=\bm{S}_{\bm{u}}^{\scriptscriptstyle\top}\bm{g}_{\bm{x}}+\bm{g}_{\bm{u}},\\
\bm{C}&amp;=\bm{S}_{\bm{u}}^{\scriptscriptstyle\top}\bm{H}_{\bm{x}\bm{x}}\bm{S}_{\bm{u}}+2\bm{S}_{\bm{u}}^{\scriptscriptstyle\top}\bm{H}_{\bm{u}\bm{x}}^{\scriptscriptstyle\top}+\bm{H}_{\bm{u}\bm{u}}.\end{aligned}\right.
            </span>
           </td>
           <td class="ltx_eqn_cell ltx_eqn_center_padright">
           </td>
          </tr>
         </table>
        </div>
       </div>
       <div class="ltx_para" id="SS3.p3">
        <p class="ltx_p">
         Similarly to Section
         <a class="ltx_ref" href="S6.html#sec:LQRLS" title="6.5 Least squares formulation of recursive LQR ‣ 6 Linear quadratic tracking (LQT) ‣ A practical guide to learning and control problems in robotics solved with second-order optimization">
          <span class="ltx_text ltx_ref_tag">
           6.5
          </span>
         </a>
         , we set
        </p>
        <div class="equation" style="display:flex;align-items:center;">
         <table class="ltx_equation ltx_eqn_table" id="E87">
          <tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
           <td class="ltx_eqn_cell ltx_eqn_center_padleft">
           </td>
           <td class="ltx_eqn_cell ltx_align_center">
            <span class="ltx_Math" id="E87.m1">
             \Delta\bm{u}=-\bm{F}\begin{bmatrix}\Delta\bm{x}_{1}\\
1\end{bmatrix}=-\bm{F}\begin{bmatrix}\bm{0}\\
1\end{bmatrix}=-\bm{F}\Delta\bm{\tilde{x}}_{1},
            </span>
           </td>
           <td class="ltx_eqn_cell ltx_eqn_center_padright">
           </td>
          </tr>
         </table>
         <div class="ltx_eqn_eqno">
          <div>
           (87)
          </div>
         </div>
        </div>
        <p class="ltx_p">
         and redefine the optimization problem as
        </p>
        <div class="equation" style="display:flex;align-items:center;">
         <table class="ltx_equation ltx_eqn_table" id="E88">
          <tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
           <td class="ltx_eqn_cell ltx_eqn_center_padleft">
           </td>
           <td class="ltx_eqn_cell ltx_align_center">
            <span class="ltx_Math" id="E88.m1">
             \min_{\bm{F}}\quad\frac{1}{2}\Delta\bm{\tilde{x}}_{1}^{\scriptscriptstyle\top}\bm{F}^{\scriptscriptstyle\top}\bm{C}\bm{F}\Delta\bm{\tilde{x}}_{1}-\Delta\bm{\tilde{x}}_{1}^{\scriptscriptstyle\top}\bm{F}^{\scriptscriptstyle\top}\bm{c}.
            </span>
           </td>
           <td class="ltx_eqn_cell ltx_eqn_center_padright">
           </td>
          </tr>
         </table>
         <div class="ltx_eqn_eqno">
          <div>
           (88)
          </div>
         </div>
        </div>
       </div>
       <div class="ltx_para" id="SS3.p4">
        <p class="ltx_p">
         By differentiating w.r.t.
         <span class="ltx_Math" id="SS3.p4.m1">
          \bm{F}
         </span>
         and equating to zero, we get
        </p>
        <div class="equation" style="display:flex;align-items:center;">
         <table class="ltx_equation ltx_eqn_table" id="E89">
          <tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
           <td class="ltx_eqn_cell ltx_eqn_center_padleft">
           </td>
           <td class="ltx_eqn_cell ltx_align_center">
            <span class="ltx_Math" id="E89.m1">
             \bm{F}\Delta\bm{\tilde{x}}_{1}=\bm{C}^{-1}\bm{c}.
            </span>
           </td>
           <td class="ltx_eqn_cell ltx_eqn_center_padright">
           </td>
          </tr>
         </table>
         <div class="ltx_eqn_eqno">
          <div>
           (89)
          </div>
         </div>
        </div>
       </div>
       <div class="ltx_para" id="SS3.p5">
        <p class="ltx_p">
         Similarly to Section
         <a class="ltx_ref" href="S6.html#sec:LQRLS" title="6.5 Least squares formulation of recursive LQR ‣ 6 Linear quadratic tracking (LQT) ‣ A practical guide to learning and control problems in robotics solved with second-order optimization">
          <span class="ltx_text ltx_ref_tag">
           6.5
          </span>
         </a>
         , we decompose
         <span class="ltx_Math" id="SS3.p5.m1">
          \bm{F}
         </span>
         as block matrices
         <span class="ltx_Math" id="SS3.p5.m2">
          \bm{F}_{t}
         </span>
         with
         <span class="ltx_Math" id="SS3.p5.m3">
          t\in\{1,\ldots,T-1\}
         </span>
         .
         <span class="ltx_Math" id="SS3.p5.m4">
          \bm{F}
         </span>
         can then be used to iteratively reconstruct regulation gains
         <span class="ltx_Math" id="SS3.p5.m5">
          \bm{K}_{t}
         </span>
         , by starting from
         <span class="ltx_Math" id="SS3.p5.m6">
          \bm{K}_{1}=\bm{F}_{1}
         </span>
         ,
         <span class="ltx_Math" id="SS3.p5.m7">
          \bm{P}_{1}=\bm{I}
         </span>
         , and by computing with forward recursion
        </p>
        <div class="equation" style="display:flex;align-items:center;">
         <table class="ltx_equation ltx_eqn_table" id="E90">
          <tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
           <td class="ltx_eqn_cell ltx_eqn_center_padleft">
           </td>
           <td class="ltx_eqn_cell ltx_align_center">
            <span class="ltx_Math" id="E90.m1">
             \bm{P}_{t}=\bm{P}_{t-1}{(\bm{A}_{t-1}-\bm{B}_{t-1}\bm{K}_{t-1})}^{-1},\quad\bm{K}_{t}=\bm{F}_{t}\;\bm{P}_{t},
            </span>
           </td>
           <td class="ltx_eqn_cell ltx_eqn_center_padright">
           </td>
          </tr>
         </table>
         <div class="ltx_eqn_eqno">
          <div>
           (90)
          </div>
         </div>
        </div>
        <p class="ltx_p">
         from
         <span class="ltx_Math" id="SS3.p5.m8">
          t=2
         </span>
         to
         <span class="ltx_Math" id="SS3.p5.m9">
          t=T-1
         </span>
         .
        </p>
       </div>
       <div id="SS4">
       </div>
       <h2 class="ltx_title ltx_title_subsection">
        <span class="ltx_tag ltx_tag_subsection">
         <span class="ltx_text">
          7.4
         </span>
        </span>
        <span class="ltx_text">
         Updates by considering step sizes
        </span>
       </h2>
       <figure class="ltx_float" id="alg:linesearch">
        <div class="ltx_listing ltx_lst_numbers_left ltx_listing">
         <div class="ltx_listingline">
          <span class="ltx_Math" id="algorithm3.m3">
           \alpha\leftarrow 1
          </span>
         </div>
         <div class="ltx_listingline">
          <span class="ltx_text ltx_font_bold">
           while
          </span>
          <em class="ltx_emph ltx_font_italic">
           <span class="ltx_Math" id="algorithm3.m4">
            c(\bm{\hat{u}}+\alpha\;\Delta\bm{\hat{u}})&gt;c(\bm{\hat{u}})\;\textbf{and}\;\;\alpha&gt;\alpha_{\min}
           </span>
          </em>
          <span class="ltx_text ltx_font_bold">
           do
          </span>
         </div>
         <div class="ltx_listingline">
          <span class="ltx_rule">
          </span>
          <span class="ltx_Math" id="algorithm3.m5">
           \alpha\leftarrow\frac{\alpha}{2}
          </span>
         </div>
         <div class="ltx_listingline">
          end while
         </div>
         <div class="ltx_listingline">
         </div>
        </div>
        <figcaption class="ltx_caption">
         <span class="ltx_tag ltx_tag_float">
          <span class="ltx_text ltx_font_bold">
           Algorithm 3
          </span>
         </span>
         Backtracking line search method with parameter
         <span class="ltx_Math" id="algorithm3.m2">
          \alpha_{\min}
         </span>
        </figcaption>
       </figure>
       <figure class="ltx_float" id="alg:iLQRbatch">
        <div class="ltx_listing ltx_lst_numbers_left ltx_listing">
         <div class="ltx_listingline">
          Define cost
          <span class="ltx_Math" id="algorithm4.m1">
           c(\cdot)
          </span>
          , dynamics
          <span class="ltx_Math" id="algorithm4.m2">
           \bm{d}(\cdot)
          </span>
          ,
          <span class="ltx_Math" id="algorithm4.m3">
           \bm{x}_{1}
          </span>
          ,
          <span class="ltx_Math" id="algorithm4.m4">
           \alpha_{\min}
          </span>
          ,
          <span class="ltx_Math" id="algorithm4.m5">
           \Delta_{\min}
          </span>
         </div>
         <div class="ltx_listingline">
          Initialize
          <span class="ltx_Math" id="algorithm4.m6">
           \bm{\hat{u}}
          </span>
         </div>
         <div class="ltx_listingline">
          <span class="ltx_text ltx_font_bold">
           repeat
          </span>
         </div>
         <div class="ltx_listingline">
          <span class="ltx_rule">
          </span>
          Compute
          <span class="ltx_Math" id="algorithm4.m7">
           \bm{\hat{x}}
          </span>
          using
          <span class="ltx_Math" id="algorithm4.m8">
           \bm{\hat{u}}
          </span>
          ,
          <span class="ltx_Math" id="algorithm4.m9">
           \bm{d}(\cdot)
          </span>
          , and
          <span class="ltx_Math" id="algorithm4.m10">
           \bm{x}_{1}
          </span>
         </div>
         <div class="ltx_listingline">
          <span class="ltx_rule">
          </span>
          Compute
          <span class="ltx_Math" id="algorithm4.m11">
           \bm{A}_{t},\bm{B}_{t}
          </span>
          in (
          <a class="ltx_ref" href="#eq:DS" title="(73) ‣ 7 iLQR optimization ‣ A practical guide to learning and control problems in robotics solved with second-order optimization">
           <span class="ltx_text ltx_ref_tag">
            73
           </span>
          </a>
          )
         </div>
         <div class="ltx_listingline">
          <span class="ltx_rule">
          </span>
          Compute
          <span class="ltx_Math" id="algorithm4.m12">
           \bm{S}_{\bm{u}}
          </span>
          with (
          <a class="ltx_ref" href="A1.html#eq:SxSu" title="(113) ‣ Appendix A System dynamics at trajectory level ‣ A practical guide to learning and control problems in robotics solved with second-order optimization">
           <span class="ltx_text ltx_ref_tag">
            113
           </span>
          </a>
          )
         </div>
         <div class="ltx_listingline">
          <span class="ltx_rule">
          </span>
          Compute
          <span class="ltx_Math" id="algorithm4.m13">
           \bm{g}_{\bm{\cdot}}
          </span>
          and
          <span class="ltx_Math" id="algorithm4.m14">
           \bm{H}_{\bm{\cdot}}
          </span>
          in (
          <a class="ltx_ref" href="#eq:dc_batch" title="(75) ‣ 7.1 Batch formulation of iLQR ‣ 7 iLQR optimization ‣ A practical guide to learning and control problems in robotics solved with second-order optimization">
           <span class="ltx_text ltx_ref_tag">
            75
           </span>
          </a>
          ), using (
          <a class="ltx_ref" href="#eq:dc" title="(74) ‣ 7 iLQR optimization ‣ A practical guide to learning and control problems in robotics solved with second-order optimization">
           <span class="ltx_text ltx_ref_tag">
            74
           </span>
          </a>
          )
         </div>
         <div class="ltx_listingline">
          <span class="ltx_rule">
          </span>
          Compute
          <span class="ltx_Math" id="algorithm4.m15">
           \Delta\bm{\hat{u}}
          </span>
          with (
          <a class="ltx_ref" href="#eq:du_general" title="(78) ‣ 7.1 Batch formulation of iLQR ‣ 7 iLQR optimization ‣ A practical guide to learning and control problems in robotics solved with second-order optimization">
           <span class="ltx_text ltx_ref_tag">
            78
           </span>
          </a>
          )
         </div>
         <div class="ltx_listingline">
          <span class="ltx_rule">
          </span>
          Compute
          <span class="ltx_Math" id="algorithm4.m16">
           \alpha
          </span>
          with Algorithm
          <a class="ltx_ref" href="#alg:linesearch" title="Algorithm 3 ‣ 7.4 Updates by considering step sizes ‣ 7 iLQR optimization ‣ A practical guide to learning and control problems in robotics solved with second-order optimization">
           <span class="ltx_text ltx_ref_tag">
            3
           </span>
          </a>
         </div>
         <div class="ltx_listingline">
          <span class="ltx_rule">
          </span>
          Update
          <span class="ltx_Math" id="algorithm4.m17">
           \bm{\hat{u}}
          </span>
          with (
          <a class="ltx_ref" href="#eq:alpha" title="(91) ‣ 7.4 Updates by considering step sizes ‣ 7 iLQR optimization ‣ A practical guide to learning and control problems in robotics solved with second-order optimization">
           <span class="ltx_text ltx_ref_tag">
            91
           </span>
          </a>
          )
         </div>
         <div class="ltx_listingline">
          <span class="ltx_text ltx_font_bold">
           until
          </span>
          <em class="ltx_emph ltx_font_italic">
           <span class="ltx_Math" id="algorithm4.m18">
            \|\Delta\bm{\hat{u}}\|&lt;\Delta_{\min}
           </span>
          </em>
          ;
         </div>
         <div class="ltx_listingline">
         </div>
        </div>
        <figcaption class="ltx_caption">
         <span class="ltx_tag ltx_tag_float">
          <span class="ltx_text ltx_font_bold">
           Algorithm 4
          </span>
         </span>
         Batch formulation of iLQR
        </figcaption>
       </figure>
       <figure class="ltx_float" id="alg:iLQRrecursive">
        <div class="ltx_listing ltx_lst_numbers_left ltx_listing">
         <div class="ltx_listingline">
          Define cost
          <span class="ltx_Math" id="algorithm5.m1">
           c(\cdot)
          </span>
          , dynamics
          <span class="ltx_Math" id="algorithm5.m2">
           \bm{d}(\cdot)
          </span>
          ,
          <span class="ltx_Math" id="algorithm5.m3">
           \bm{x}_{1}
          </span>
          ,
          <span class="ltx_Math" id="algorithm5.m4">
           \alpha_{\min}
          </span>
          ,
          <span class="ltx_Math" id="algorithm5.m5">
           \Delta_{\min}
          </span>
         </div>
         <div class="ltx_listingline">
          Initialize all
          <span class="ltx_Math" id="algorithm5.m6">
           \bm{\hat{u}}_{t}
          </span>
         </div>
         <div class="ltx_listingline">
          <span class="ltx_text ltx_font_bold">
           repeat
          </span>
         </div>
         <div class="ltx_listingline">
          <span class="ltx_rule">
          </span>
          Compute
          <span class="ltx_Math" id="algorithm5.m7">
           \bm{\hat{x}}
          </span>
          using
          <span class="ltx_Math" id="algorithm5.m8">
           \bm{\hat{u}}
          </span>
          ,
          <span class="ltx_Math" id="algorithm5.m9">
           \bm{d}(\cdot)
          </span>
          , and
          <span class="ltx_Math" id="algorithm5.m10">
           \bm{x}_{1}
          </span>
         </div>
         <div class="ltx_listingline">
          <span class="ltx_rule">
          </span>
          <span class="ltx_text ltx_font_typewriter">
           //
          </span>
          <span class="ltx_text ltx_font_typewriter">
           Evaluating derivatives
          </span>
         </div>
         <div class="ltx_listingline">
          <span class="ltx_rule">
          </span>
          Compute all
          <span class="ltx_Math" id="algorithm5.m11">
           \bm{A}_{t},\bm{B}_{t}
          </span>
          in (
          <a class="ltx_ref" href="#eq:DS" title="(73) ‣ 7 iLQR optimization ‣ A practical guide to learning and control problems in robotics solved with second-order optimization">
           <span class="ltx_text ltx_ref_tag">
            73
           </span>
          </a>
          )
         </div>
         <div class="ltx_listingline">
          <span class="ltx_rule">
          </span>
          Compute all
          <span class="ltx_Math" id="algorithm5.m12">
           \bm{g}_{\bm{\cdot},t}
          </span>
          and
          <span class="ltx_Math" id="algorithm5.m13">
           \bm{H}_{\bm{\cdot},t}
          </span>
          in (
          <a class="ltx_ref" href="#eq:dc" title="(74) ‣ 7 iLQR optimization ‣ A practical guide to learning and control problems in robotics solved with second-order optimization">
           <span class="ltx_text ltx_ref_tag">
            74
           </span>
          </a>
          )
         </div>
         <div class="ltx_listingline">
          <span class="ltx_rule">
          </span>
          <span class="ltx_text ltx_font_typewriter">
           //
          </span>
          <span class="ltx_text ltx_font_typewriter">
           Backward pass
          </span>
         </div>
         <div class="ltx_listingline">
          <span class="ltx_rule">
          </span>
          Set
          <span class="ltx_Math" id="algorithm5.m14">
           \bm{v}_{\bm{x},T}=\bm{g}_{\bm{x},T}
          </span>
          and
          <span class="ltx_Math" id="algorithm5.m15">
           \bm{V}_{\bm{x}\bm{x},T}=\bm{H}_{\bm{x}\bm{x},T}
          </span>
         </div>
         <div class="ltx_listingline">
          <span class="ltx_rule">
          </span>
          <span class="ltx_text ltx_font_bold">
           for
          </span>
          <em class="ltx_emph ltx_font_italic">
           <span class="ltx_Math" id="algorithm5.m16">
            t\leftarrow T-1
           </span>
           to
           <span class="ltx_Math" id="algorithm5.m17">
            1
           </span>
          </em>
          <span class="ltx_text ltx_font_bold">
           do
          </span>
         </div>
         <div class="ltx_listingline">
          <span class="ltx_rule">
          </span>
          <span class="ltx_rule">
          </span>
          Compute
          <span class="ltx_Math" id="algorithm5.m18">
           \bm{q}_{\bm{\cdot},t}
          </span>
          and
          <span class="ltx_Math" id="algorithm5.m19">
           \bm{Q}_{\bm{\cdot},t}
          </span>
          with (
          <a class="ltx_ref" href="#eq:qt" title="(82) ‣ 7.2 Recursive formulation of iLQR ‣ 7 iLQR optimization ‣ A practical guide to learning and control problems in robotics solved with second-order optimization">
           <span class="ltx_text ltx_ref_tag">
            82
           </span>
          </a>
          )
         </div>
         <div class="ltx_listingline">
          <span class="ltx_rule">
          </span>
          <span class="ltx_rule">
          </span>
          Compute
          <span class="ltx_Math" id="algorithm5.m20">
           \bm{k}_{t}
          </span>
          and
          <span class="ltx_Math" id="algorithm5.m21">
           \bm{K}_{t}
          </span>
          with (
          <a class="ltx_ref" href="#eq:duhat" title="(83) ‣ 7.2 Recursive formulation of iLQR ‣ 7 iLQR optimization ‣ A practical guide to learning and control problems in robotics solved with second-order optimization">
           <span class="ltx_text ltx_ref_tag">
            83
           </span>
          </a>
          )
         </div>
         <div class="ltx_listingline">
          <span class="ltx_rule">
          </span>
          <span class="ltx_rule">
          </span>
          Compute
          <span class="ltx_Math" id="algorithm5.m22">
           \bm{v}_{\bm{x},t}
          </span>
          and
          <span class="ltx_Math" id="algorithm5.m23">
           \bm{V}_{\bm{x}\bm{x},t}
          </span>
          with (
          <a class="ltx_ref" href="#eq:vV" title="(84) ‣ 7.2 Recursive formulation of iLQR ‣ 7 iLQR optimization ‣ A practical guide to learning and control problems in robotics solved with second-order optimization">
           <span class="ltx_text ltx_ref_tag">
            84
           </span>
          </a>
          )
         </div>
         <div class="ltx_listingline">
          <span class="ltx_rule">
          </span>
          end for
         </div>
         <div class="ltx_listingline">
          <span class="ltx_rule">
          </span>
          <span class="ltx_text ltx_font_typewriter">
           //
          </span>
          <span class="ltx_text ltx_font_typewriter">
           Forward pass
          </span>
         </div>
         <div class="ltx_listingline">
          <span class="ltx_rule">
          </span>
          <span class="ltx_Math" id="algorithm5.m24">
           \alpha\leftarrow 2
          </span>
         </div>
         <div class="ltx_listingline">
          <span class="ltx_rule">
          </span>
          <span class="ltx_text ltx_font_bold">
           while
          </span>
          <em class="ltx_emph ltx_font_italic">
           <span class="ltx_Math" id="algorithm5.m25">
            c(\bm{\hat{u}}+\alpha\;\Delta\bm{\hat{u}})&gt;c(\bm{\hat{u}})\;\textbf{and}\;\;\alpha&gt;\alpha_{\min}
           </span>
          </em>
          <span class="ltx_text ltx_font_bold">
           do
          </span>
         </div>
         <div class="ltx_listingline">
          <span class="ltx_rule">
          </span>
          <span class="ltx_rule">
          </span>
          <span class="ltx_Math" id="algorithm5.m26">
           \alpha\leftarrow\frac{\alpha}{2}
          </span>
         </div>
         <div class="ltx_listingline">
          <span class="ltx_rule">
          </span>
          <span class="ltx_rule">
          </span>
          <span class="ltx_text ltx_font_bold">
           for
          </span>
          <em class="ltx_emph ltx_font_italic">
           <span class="ltx_Math" id="algorithm5.m27">
            t\leftarrow 1
           </span>
           to
           <span class="ltx_Math" id="algorithm5.m28">
            T-1
           </span>
          </em>
          <span class="ltx_text ltx_font_bold">
           do
          </span>
         </div>
         <div class="ltx_listingline">
          <span class="ltx_rule">
          </span>
          <span class="ltx_rule">
          </span>
          <span class="ltx_rule">
          </span>
          Update
          <span class="ltx_Math" id="algorithm5.m29">
           \bm{\hat{u}}_{t}
          </span>
          with (
          <a class="ltx_ref" href="#eq:alpha2" title="(92) ‣ 7.4 Updates by considering step sizes ‣ 7 iLQR optimization ‣ A practical guide to learning and control problems in robotics solved with second-order optimization">
           <span class="ltx_text ltx_ref_tag">
            92
           </span>
          </a>
          )
         </div>
         <div class="ltx_listingline">
          <span class="ltx_rule">
          </span>
          <span class="ltx_rule">
          </span>
          <span class="ltx_rule">
          </span>
          Compute
          <span class="ltx_Math" id="algorithm5.m30">
           \bm{\hat{x}}_{t+1}
          </span>
          with
          <span class="ltx_Math" id="algorithm5.m31">
           \bm{d}(\cdot)
          </span>
         </div>
         <div class="ltx_listingline">
          <span class="ltx_rule">
          </span>
          <span class="ltx_rule">
          </span>
          end for
         </div>
         <div class="ltx_listingline">
          <span class="ltx_rule">
          </span>
          <span class="ltx_rule">
          </span>
         </div>
         <div class="ltx_listingline">
          <span class="ltx_rule">
          </span>
          end while
         </div>
         <div class="ltx_listingline">
          <span class="ltx_rule">
          </span>
         </div>
         <div class="ltx_listingline">
          <span class="ltx_text ltx_font_bold">
           until
          </span>
          <em class="ltx_emph ltx_font_italic">
           <span class="ltx_Math" id="algorithm5.m32">
            \|\Delta\bm{\hat{u}}\|&lt;\Delta_{\min}
           </span>
          </em>
          ;
         </div>
         <div class="ltx_listingline">
          Use (
          <a class="ltx_ref" href="#eq:iLQRrecursiveController" title="(85) ‣ 7.2 Recursive formulation of iLQR ‣ 7 iLQR optimization ‣ A practical guide to learning and control problems in robotics solved with second-order optimization">
           <span class="ltx_text ltx_ref_tag">
            85
           </span>
          </a>
          ) and
          <span class="ltx_Math" id="algorithm5.m33">
           \bm{d}(\cdot)
          </span>
          for reproduction
         </div>
         <div class="ltx_listingline">
         </div>
        </div>
        <figcaption class="ltx_caption">
         <span class="ltx_tag ltx_tag_float">
          <span class="ltx_text ltx_font_bold">
           Algorithm 5
          </span>
         </span>
         Recursive formulation of iLQR
        </figcaption>
       </figure>
       <div class="ltx_para" id="SS4.p1">
        <p class="ltx_p">
         To be more efficient, iLQR most often requires at each iteration to estimate a step size
         <span class="ltx_Math" id="SS4.p1.m1">
          \alpha
         </span>
         to scale the control command updates.
For the batch formulation in Section
         <a class="ltx_ref" href="#sec:iLQRbatch" title="7.1 Batch formulation of iLQR ‣ 7 iLQR optimization ‣ A practical guide to learning and control problems in robotics solved with second-order optimization">
          <span class="ltx_text ltx_ref_tag">
           7.1
          </span>
         </a>
         , this can be achieved by setting the update (
         <a class="ltx_ref" href="#eq:du_general" title="(78) ‣ 7.1 Batch formulation of iLQR ‣ 7 iLQR optimization ‣ A practical guide to learning and control problems in robotics solved with second-order optimization">
          <span class="ltx_text ltx_ref_tag">
           78
          </span>
         </a>
         ) as
        </p>
        <div class="equation" style="display:flex;align-items:center;">
         <table class="ltx_equation ltx_eqn_table" id="eq:alpha">
          <tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
           <td class="ltx_eqn_cell ltx_eqn_center_padleft">
           </td>
           <td class="ltx_eqn_cell ltx_align_center">
            <span class="ltx_Math" id="E91.m1">
             \bm{\hat{u}}\leftarrow\bm{\hat{u}}+\alpha\;\Delta\bm{\hat{u}},
            </span>
           </td>
           <td class="ltx_eqn_cell ltx_eqn_center_padright">
           </td>
          </tr>
         </table>
         <div class="ltx_eqn_eqno">
          <div>
           (91)
          </div>
         </div>
        </div>
        <p class="ltx_p">
         where the resulting procedure consists of estimating a descent direction with (
         <a class="ltx_ref" href="#eq:du_general" title="(78) ‣ 7.1 Batch formulation of iLQR ‣ 7 iLQR optimization ‣ A practical guide to learning and control problems in robotics solved with second-order optimization">
          <span class="ltx_text ltx_ref_tag">
           78
          </span>
         </a>
         ) along which the objective function will be reduced, and then estimating with (
         <a class="ltx_ref" href="#eq:alpha" title="(91) ‣ 7.4 Updates by considering step sizes ‣ 7 iLQR optimization ‣ A practical guide to learning and control problems in robotics solved with second-order optimization">
          <span class="ltx_text ltx_ref_tag">
           91
          </span>
         </a>
         ) a step size that determines how far one can move along this direction.
        </p>
       </div>
       <div class="ltx_para" id="SS4.p2">
        <p class="ltx_p">
         For the recursive formulation in Section
         <a class="ltx_ref" href="#sec:iLQRrecursive" title="7.2 Recursive formulation of iLQR ‣ 7 iLQR optimization ‣ A practical guide to learning and control problems in robotics solved with second-order optimization">
          <span class="ltx_text ltx_ref_tag">
           7.2
          </span>
         </a>
         , this can be achieved by setting the update (
         <a class="ltx_ref" href="#eq:duhat" title="(83) ‣ 7.2 Recursive formulation of iLQR ‣ 7 iLQR optimization ‣ A practical guide to learning and control problems in robotics solved with second-order optimization">
          <span class="ltx_text ltx_ref_tag">
           83
          </span>
         </a>
         ) as
        </p>
        <div class="equation" style="display:flex;align-items:center;">
         <table class="ltx_equation ltx_eqn_table" id="eq:alpha2">
          <tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
           <td class="ltx_eqn_cell ltx_eqn_center_padleft">
           </td>
           <td class="ltx_eqn_cell ltx_align_center">
            <span class="ltx_Math" id="E92.m1">
             \bm{\hat{u}}_{t}\leftarrow\bm{\hat{u}}_{t}+\alpha\;\bm{k}_{t}+\bm{K}_{t}\,\Delta\bm{x}_{t}.
            </span>
           </td>
           <td class="ltx_eqn_cell ltx_eqn_center_padright">
           </td>
          </tr>
         </table>
         <div class="ltx_eqn_eqno">
          <div>
           (92)
          </div>
         </div>
        </div>
       </div>
       <div class="ltx_para" id="SS4.p3">
        <p class="ltx_p">
         In practice, a simple backtracking line search procedure can be considered with Algorithm
         <a class="ltx_ref" href="#alg:linesearch" title="Algorithm 3 ‣ 7.4 Updates by considering step sizes ‣ 7 iLQR optimization ‣ A practical guide to learning and control problems in robotics solved with second-order optimization">
          <span class="ltx_text ltx_ref_tag">
           3
          </span>
         </a>
         , by considering a small value for
         <span class="ltx_Math" id="SS4.p3.m1">
          \alpha_{\min}
         </span>
         . For more elaborated methods, see Ch. 3 of
         <cite class="ltx_cite ltx_citemacro_cite">
          [
          <a class="ltx_ref" href="bib.html#bib18" title="Numerical optimization">
           10
          </a>
          ]
         </cite>
         .
        </p>
       </div>
       <div class="ltx_para" id="SS4.p4">
        <p class="ltx_p">
         The complete iLQR procedures are described in Algorithms
         <a class="ltx_ref" href="#alg:iLQRbatch" title="Algorithm 4 ‣ 7.4 Updates by considering step sizes ‣ 7 iLQR optimization ‣ A practical guide to learning and control problems in robotics solved with second-order optimization">
          <span class="ltx_text ltx_ref_tag">
           4
          </span>
         </a>
         and
         <a class="ltx_ref" href="#alg:iLQRrecursive" title="Algorithm 5 ‣ 7.4 Updates by considering step sizes ‣ 7 iLQR optimization ‣ A practical guide to learning and control problems in robotics solved with second-order optimization">
          <span class="ltx_text ltx_ref_tag">
           5
          </span>
         </a>
         for the batch and recursive formulations, respectively.
        </p>
       </div>
       <div id="SS5">
       </div>
       <h2 class="ltx_title ltx_title_subsection">
        <span class="ltx_tag ltx_tag_subsection">
         <span class="ltx_text">
          7.5
         </span>
        </span>
        <span class="ltx_text">
         iLQR with quadratic cost on
         <span class="ltx_Math" id="SS5.m1">
          f(x_{t})
         </span>
        </span>
       </h2>
       <div class="ltx_para" id="SS5.p1">
        <p class="ltx_p">
         We consider a cost defined by
        </p>
        <div class="equation" style="display:flex;align-items:center;">
         <table class="ltx_equation ltx_eqn_table" id="E93">
          <tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
           <td class="ltx_eqn_cell ltx_eqn_center_padleft">
           </td>
           <td class="ltx_eqn_cell ltx_align_center">
            <span class="ltx_Math" id="E93.m1">
             c(\bm{x}_{t},\bm{u}_{t})=\bm{f}(\bm{x}_{t})^{\!{\scriptscriptstyle\top}}\bm{Q}_{t}\bm{f}(\bm{x}_{t})+\bm{u}_{t}^{\scriptscriptstyle\top}\bm{R}_{t}\,\bm{u}_{t},
            </span>
           </td>
           <td class="ltx_eqn_cell ltx_eqn_center_padright">
           </td>
          </tr>
         </table>
         <div class="ltx_eqn_eqno">
          <div>
           (93)
          </div>
         </div>
        </div>
        <p class="ltx_p">
         where
         <span class="ltx_Math" id="SS5.p1.m1">
          \bm{Q}_{t}
         </span>
         and
         <span class="ltx_Math" id="SS5.p1.m2">
          \bm{R}_{t}
         </span>
         are weight matrices trading off task and control costs. Such cost is quadratic on
         <span class="ltx_Math" id="SS5.p1.m3">
          \bm{f}(\bm{x}_{t})
         </span>
         but non-quadratic on
         <span class="ltx_Math" id="SS5.p1.m4">
          \bm{x}_{t}
         </span>
         .
        </p>
       </div>
       <div class="ltx_para" id="SS5.p2">
        <p class="ltx_p">
         For the batch formulation of iLQR, the cost in (
         <a class="ltx_ref" href="#eq:dc" title="(74) ‣ 7 iLQR optimization ‣ A practical guide to learning and control problems in robotics solved with second-order optimization">
          <span class="ltx_text ltx_ref_tag">
           74
          </span>
         </a>
         ) then becomes
        </p>
        <div class="equation" style="display:flex;align-items:center;">
         <table class="ltx_equation ltx_eqn_table" id="E94">
          <tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
           <td class="ltx_eqn_cell ltx_eqn_center_padleft">
           </td>
           <td class="ltx_eqn_cell ltx_align_center">
            <span class="ltx_Math" id="E94.m1">
             \Delta c(\Delta\bm{x}_{t},\Delta\bm{u}_{t})\approx 2\Delta\bm{x}_{t}^{\scriptscriptstyle\top}\bm{J}(\bm{x}_{t})^{\scriptscriptstyle\top}\bm{Q}_{t}\bm{f}(\bm{x}_{t})+2\Delta\bm{u}_{t}^{\scriptscriptstyle\top}\bm{R}_{t}\,\bm{u}_{t}+\Delta\bm{x}_{t}^{\scriptscriptstyle\top}\bm{J}(\bm{x}_{t})^{\scriptscriptstyle\top}\bm{Q}_{t}\bm{J}(\bm{x}_{t})\Delta\bm{x}_{t}+\Delta\bm{u}_{t}^{\scriptscriptstyle\top}\bm{R}_{t}\Delta\bm{u}_{t},
            </span>
           </td>
           <td class="ltx_eqn_cell ltx_eqn_center_padright">
           </td>
          </tr>
         </table>
         <div class="ltx_eqn_eqno">
          <div>
           (94)
          </div>
         </div>
        </div>
        <p class="ltx_p">
         which used gradients
        </p>
        <div class="equation" style="display:flex;align-items:center;">
         <table class="ltx_equation ltx_eqn_table" id="eq:dcdx">
          <tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
           <td class="ltx_eqn_cell ltx_eqn_center_padleft">
           </td>
           <td class="ltx_eqn_cell ltx_align_center">
            <span class="ltx_Math" id="E95.m1">
             \bm{g}_{\bm{x},t}=2\bm{J}(\bm{x}_{t})^{\scriptscriptstyle\top}\bm{Q}_{t}\bm{f}(\bm{x}_{t}),\quad\bm{g}_{\bm{u},t}=2\bm{R}_{t}\bm{u}_{t},
            </span>
           </td>
           <td class="ltx_eqn_cell ltx_eqn_center_padright">
           </td>
          </tr>
         </table>
         <div class="ltx_eqn_eqno">
          <div>
           (95)
          </div>
         </div>
        </div>
        <p class="ltx_p">
         and Hessian matrices
        </p>
        <div class="equation" style="display:flex;align-items:center;">
         <table class="ltx_equation ltx_eqn_table" id="E96">
          <tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
           <td class="ltx_eqn_cell ltx_eqn_center_padleft">
           </td>
           <td class="ltx_eqn_cell ltx_align_center">
            <span class="ltx_Math" id="E96.m1">
             \bm{H}_{\bm{x}\bm{x},t}\approx 2\bm{J}(\bm{x}_{t})^{\scriptscriptstyle\top}\bm{Q}_{t}\bm{J}(\bm{x}_{t}),\quad\bm{H}_{\bm{u}\bm{x},t}=\bm{0},\quad\bm{H}_{\bm{u}\bm{u},t}=2\bm{R}_{t}.
            </span>
           </td>
           <td class="ltx_eqn_cell ltx_eqn_center_padright">
           </td>
          </tr>
         </table>
         <div class="ltx_eqn_eqno">
          <div>
           (96)
          </div>
         </div>
        </div>
        <p class="ltx_p">
         with
         <span class="ltx_Math" id="SS5.p2.m1">
          \bm{J}(\bm{x}_{t})=\frac{\partial\bm{f}(\bm{x}_{t})}{\partial\bm{x}_{t}}
         </span>
         a Jacobian matrix. The same results can be used in the recursive formulation in (
         <a class="ltx_ref" href="#eq:qt" title="(82) ‣ 7.2 Recursive formulation of iLQR ‣ 7 iLQR optimization ‣ A practical guide to learning and control problems in robotics solved with second-order optimization">
          <span class="ltx_text ltx_ref_tag">
           82
          </span>
         </a>
         ).
        </p>
       </div>
       <div class="ltx_para" id="SS5.p3">
        <p class="ltx_p">
         At a trajectory level, the evolution of the tracking and control weights is represented by
         <span class="ltx_Math" id="SS5.p3.m1">
          \bm{Q}\!=\!\mathrm{blockdiag}(\bm{Q}_{1},\bm{Q}_{2},\ldots,\bm{Q}_{T})
         </span>
         and
         <span class="ltx_Math" id="SS5.p3.m2">
          \bm{R}\!=\!\mathrm{blockdiag}(\bm{R}_{1},\bm{R}_{2},\ldots,\bm{R}_{T-1})
         </span>
         , respectively.
        </p>
       </div>
       <div class="ltx_para" id="SS5.p4">
        <p class="ltx_p">
         With a slight abuse of notation, we define
         <span class="ltx_Math" id="SS5.p4.m1">
          \bm{f}(\bm{x})
         </span>
         as a vector concatenating the vectors
         <span class="ltx_Math" id="SS5.p4.m2">
          \bm{f}(\bm{x}_{t})
         </span>
         , and
         <span class="ltx_Math" id="SS5.p4.m3">
          \bm{J}(\bm{x})
         </span>
         as a block-diagonal concatenation of the Jacobian matrices
         <span class="ltx_Math" id="SS5.p4.m4">
          \bm{J}(\bm{x}_{t})
         </span>
         . The minimization problem (
         <a class="ltx_ref" href="#eq:minu" title="(76) ‣ 7.1 Batch formulation of iLQR ‣ 7 iLQR optimization ‣ A practical guide to learning and control problems in robotics solved with second-order optimization">
          <span class="ltx_text ltx_ref_tag">
           76
          </span>
         </a>
         ) then becomes
        </p>
        <div class="equation" style="display:flex;align-items:center;">
         <table class="ltx_equation ltx_eqn_table" id="E97">
          <tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
           <td class="ltx_eqn_cell ltx_eqn_center_padleft">
           </td>
           <td class="ltx_eqn_cell ltx_align_center">
            <span class="ltx_Math" id="E97.m1">
             \min_{\Delta\bm{u}}\quad 2\Delta\bm{x}^{\!{\scriptscriptstyle\top}}\bm{J}(\bm{x})^{\scriptscriptstyle\top}\bm{Q}\bm{f}(\bm{x})+2\Delta\bm{u}^{\!{\scriptscriptstyle\top}}\bm{R}\,\bm{u}\;+\Delta\bm{x}^{\!{\scriptscriptstyle\top}}\bm{J}(\bm{x})^{\scriptscriptstyle\top}\bm{Q}\bm{J}(\bm{x})\Delta\bm{x}+\Delta\bm{u}^{\!{\scriptscriptstyle\top}}\bm{R}\Delta\bm{u},\quad\text{s.t.}\quad\Delta\bm{x}=\bm{S}_{\bm{u}}\Delta\bm{u},
            </span>
           </td>
           <td class="ltx_eqn_cell ltx_eqn_center_padright">
           </td>
          </tr>
         </table>
         <div class="ltx_eqn_eqno">
          <div>
           (97)
          </div>
         </div>
        </div>
        <p class="ltx_p">
         whose least squares solution is given by
        </p>
        <div class="equation" style="display:flex;align-items:center;">
         <table class="ltx_equation ltx_eqn_table" id="eq:du">
          <tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
           <td class="ltx_eqn_cell ltx_eqn_center_padleft">
           </td>
           <td class="ltx_eqn_cell ltx_align_center">
            <span class="ltx_Math" id="E98.m1">
             \Delta\bm{\hat{u}}\!=\!{\Big(\bm{S}_{\bm{u}}^{\scriptscriptstyle\top}\bm{J}(\bm{x})^{\scriptscriptstyle\top}\bm{Q}\bm{J}(\bm{x})\bm{S}_{\bm{u}}\!+\!\bm{R}\Big)}^{\!\!-1}\Big(-\bm{S}_{\bm{u}}^{\scriptscriptstyle\top}\bm{J}(\bm{x})^{\scriptscriptstyle\top}\bm{Q}\bm{f}(\bm{x})-\bm{R}\,\bm{u}\Big),
            </span>
           </td>
           <td class="ltx_eqn_cell ltx_eqn_center_padright">
           </td>
          </tr>
         </table>
         <div class="ltx_eqn_eqno">
          <div>
           (98)
          </div>
         </div>
        </div>
        <p class="ltx_p">
         which can be used to update the control commands estimates at each iteration step of the iLQR algorithm.
        </p>
       </div>
       <div class="ltx_para" id="SS5.p5">
        <p class="ltx_p">
         In the next sections, we show examples of functions
         <span class="ltx_Math" id="SS5.p5.m1">
          \bm{f}(\bm{x})
         </span>
         that can rely on this formulation.
        </p>
       </div>
       <div id="SS5.SSS1">
       </div>
       <h3 class="ltx_title ltx_title_subsubsection">
        <span class="ltx_tag ltx_tag_subsubsection">
         <span class="ltx_text">
          7.5.1
         </span>
        </span>
        <span class="ltx_text">
         Robot manipulator
        </span>
       </h3>
       <div class="ltx_para" id="SS5.SSS1.p1">
        <p class="ltx_p">
         We define a manipulation task involving a set of transformations as in Fig.
         <a class="ltx_ref" href="#fig:transformations" title="Figure 16 ‣ 7.5.1 Robot manipulator ‣ 7.5 iLQR with quadratic cost on f(xt) ‣ 7 iLQR optimization ‣ A practical guide to learning and control problems in robotics solved with second-order optimization">
          <span class="ltx_text ltx_ref_tag">
           16
          </span>
         </a>
         . By relying on these transformation operators, we will next describe all variables in the robot frame of reference (defined by
         <span class="ltx_Math" id="SS5.SSS1.p1.m1">
          \bm{0}
         </span>
         ,
         <span class="ltx_Math" id="SS5.SSS1.p1.m2">
          \bm{e}_{1}
         </span>
         and
         <span class="ltx_Math" id="SS5.SSS1.p1.m3">
          \bm{e}_{2}
         </span>
         in the figure).
        </p>
       </div>
       <div class="ltx_para" id="SS5.SSS1.p2">
        <p class="ltx_p">
         For a manipulator controlled by joint angle velocity commands
         <span class="ltx_Math" id="SS5.SSS1.p2.m1">
          \bm{u}=\bm{\dot{x}}
         </span>
         , the evolution of the system is described by
         <span class="ltx_Math" id="SS5.SSS1.p2.m2">
          \bm{x}_{t+1}=\bm{x}_{t}+\bm{u}_{t}\Delta t
         </span>
         , with the Taylor expansion (
         <a class="ltx_ref" href="#eq:DS" title="(73) ‣ 7 iLQR optimization ‣ A practical guide to learning and control problems in robotics solved with second-order optimization">
          <span class="ltx_text ltx_ref_tag">
           73
          </span>
         </a>
         ) simplifying to
         <span class="ltx_Math" id="SS5.SSS1.p2.m3">
          \bm{A}_{t}=\frac{\partial\bm{g}}{\partial\bm{x}_{t}}=\bm{I}
         </span>
         and
         <span class="ltx_Math" id="SS5.SSS1.p2.m4">
          \bm{B}_{t}=\frac{\partial\bm{g}}{\partial\bm{u}_{t}}=\bm{I}\Delta t
         </span>
         . Similarly, a double integrator can alternatively be considered, with acceleration commands
         <span class="ltx_Math" id="SS5.SSS1.p2.m5">
          \bm{u}=\bm{\ddot{x}}
         </span>
         and states composed of both positions and velocities.
        </p>
       </div>
       <div class="ltx_para" id="SS5.SSS1.p3">
        <p class="ltx_p">
         For a robot manipulator,
         <span class="ltx_Math" id="SS5.SSS1.p3.m1">
          \bm{f}(\bm{x}_{t})
         </span>
         in (
         <a class="ltx_ref" href="#eq:du" title="(98) ‣ 7.5 iLQR with quadratic cost on f(xt) ‣ 7 iLQR optimization ‣ A practical guide to learning and control problems in robotics solved with second-order optimization">
          <span class="ltx_text ltx_ref_tag">
           98
          </span>
         </a>
         ) typically represents the error between a reference
         <span class="ltx_Math" id="SS5.SSS1.p3.m2">
          \bm{\mu}_{t}
         </span>
         and the end-effector position computed by the forward kinematics function
         <span class="ltx_Math" id="SS5.SSS1.p3.m3">
          \bm{f}^{\text{\tiny ee}}(\bm{x}_{t})
         </span>
         . We then have
        </p>
        <div class="equation" style="display:flex;align-items:center;">
         <table class="ltx_equationgroup ltx_eqn_align ltx_eqn_table" id="A4.EGx15">
          <tbody id="Ex66">
           <tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
            <td class="ltx_eqn_cell ltx_eqn_center_padleft">
            </td>
            <td class="ltx_td ltx_align_right ltx_eqn_cell">
             <span class="ltx_Math" id="Ex66.m1">
              \displaystyle\bm{f}(\bm{x}_{t})
             </span>
            </td>
            <td class="ltx_td ltx_align_left ltx_eqn_cell">
             <span class="ltx_Math" id="Ex66.m2">
              \displaystyle=\bm{f}^{\text{\tiny ee}}(\bm{x}_{t})-\bm{\mu}_{t},
             </span>
            </td>
            <td class="ltx_eqn_cell ltx_eqn_center_padright">
            </td>
           </tr>
          </tbody>
          <tbody id="Ex67">
           <tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
            <td class="ltx_eqn_cell ltx_eqn_center_padleft">
            </td>
            <td class="ltx_td ltx_align_right ltx_eqn_cell">
             <span class="ltx_Math" id="Ex67.m1">
              \displaystyle\bm{J}(\bm{x}_{t})
             </span>
            </td>
            <td class="ltx_td ltx_align_left ltx_eqn_cell">
             <span class="ltx_Math" id="Ex67.m2">
              \displaystyle=\bm{J}^{\text{\tiny ee}}(\bm{x}_{t}).
             </span>
            </td>
            <td class="ltx_eqn_cell ltx_eqn_center_padright">
            </td>
           </tr>
          </tbody>
         </table>
        </div>
       </div>
       <div class="ltx_para" id="SS5.SSS1.p4">
        <p class="ltx_p">
         For the orientation part of the data (if considered), the Euclidean distance vector
         <span class="ltx_Math" id="SS5.SSS1.p4.m1">
          \bm{f}^{\text{\tiny ee}}(\bm{x}_{t})-\bm{\mu}_{t}
         </span>
         is replaced by a geodesic distance measure computed with the logarithmic map
         <span class="ltx_Math" id="SS5.SSS1.p4.m2">
          \log_{\bm{\mu}_{t}}\!\big(\bm{f}^{\text{\tiny ee}}(\bm{x}_{t})\big)
         </span>
         , see
         <cite class="ltx_cite ltx_citemacro_cite">
          [
          <a class="ltx_ref" href="bib.html#bib10" title="Gaussians on Riemannian manifolds: applications for robot learning and adaptive control">
           3
          </a>
          ]
         </cite>
         for details.
        </p>
       </div>
       <div class="ltx_para" id="SS5.SSS1.p5">
        <p class="ltx_p">
         The approach can similarly be extended to target objects/landmarks with positions
         <span class="ltx_Math" id="SS5.SSS1.p5.m1">
          \bm{\mu}_{t}
         </span>
         and orientation matrices
         <span class="ltx_Math" id="SS5.SSS1.p5.m2">
          \bm{U}_{t}
         </span>
         , whose columns are basis vectors forming a coordinate system, see Fig.
         <a class="ltx_ref" href="#fig:iLQR_manipulator" title="Figure 18 ‣ 7.5.3 Bounded task space ‣ 7.5 iLQR with quadratic cost on f(xt) ‣ 7 iLQR optimization ‣ A practical guide to learning and control problems in robotics solved with second-order optimization">
          <span class="ltx_text ltx_ref_tag">
           18
          </span>
         </a>
         . We can then define an error between the robot end-effector and an object/landmark expressed in the object/landmark coordinate system as
        </p>
        <div class="equation" style="display:flex;align-items:center;">
         <table class="ltx_equationgroup ltx_eqn_table" id="eq:fJU">
          <tr class="ltx_equation ltx_eqn_row ltx_align_baseline" id="E99X">
           <td class="ltx_eqn_cell ltx_eqn_center_padleft">
           </td>
           <td class="ltx_td ltx_align_right ltx_eqn_cell">
            <span class="ltx_Math" id="E99X.m2">
             \displaystyle\bm{f}(\bm{x}_{t})
            </span>
           </td>
           <td class="ltx_td ltx_align_left ltx_eqn_cell">
            <span class="ltx_Math" id="E99X.m3">
             \displaystyle=\bm{U}_{t}^{\scriptscriptstyle\top}\big(\bm{f}^{\text{\tiny ee}}(\bm{x}_{t})-\bm{\mu}_{t}\big),
            </span>
           </td>
           <td class="ltx_eqn_cell ltx_eqn_center_padright">
           </td>
          </tr>
          <tr class="ltx_equation ltx_eqn_row ltx_align_baseline" id="E99Xa">
           <td class="ltx_eqn_cell ltx_eqn_center_padleft">
           </td>
           <td class="ltx_td ltx_align_right ltx_eqn_cell">
            <span class="ltx_Math" id="E99Xa.m2">
             \displaystyle\bm{J}(\bm{x}_{t})
            </span>
           </td>
           <td class="ltx_td ltx_align_left ltx_eqn_cell">
            <span class="ltx_Math" id="E99Xa.m3">
             \displaystyle=\bm{U}_{t}^{\scriptscriptstyle\top}\bm{J}^{\text{\tiny ee}}(\bm{x}_{t}).
            </span>
           </td>
           <td class="ltx_eqn_cell ltx_eqn_center_padright">
           </td>
          </tr>
         </table>
         <div class="ltx_eqn_eqno">
          <div>
           (99)
          </div>
         </div>
        </div>
       </div>
       <div id="SS5.SSS2">
       </div>
       <h3 class="ltx_title ltx_title_subsubsection">
        <span class="ltx_tag ltx_tag_subsubsection">
         <span class="ltx_text">
          7.5.2
         </span>
        </span>
        <span class="ltx_text">
         Bounded joint space
        </span>
       </h3>
       <div class="ltx_para" id="SS5.SSS2.p1">
        <p class="ltx_p">
         The iLQR solution in (
         <a class="ltx_ref" href="#eq:du" title="(98) ‣ 7.5 iLQR with quadratic cost on f(xt) ‣ 7 iLQR optimization ‣ A practical guide to learning and control problems in robotics solved with second-order optimization">
          <span class="ltx_text ltx_ref_tag">
           98
          </span>
         </a>
         ) can be used to keep the state within a boundary (e.g., joint angle limits). We denote
         <span class="ltx_Math" id="SS5.SSS2.p1.m1">
          \bm{f}(\bm{x})=\bm{f}^{\text{\tiny cut}}(\bm{x})
         </span>
         as the vertical concatenation of
         <span class="ltx_Math" id="SS5.SSS2.p1.m2">
          \bm{f}^{\text{\tiny cut}}(\bm{x}_{t})
         </span>
         and
         <span class="ltx_Math" id="SS5.SSS2.p1.m3">
          \bm{J}(\bm{x})=\bm{J}^{\text{\tiny cut}}(\bm{x})
         </span>
         as a diagonal concatenation of diagonal Jacobian matrices
         <span class="ltx_Math" id="SS5.SSS2.p1.m4">
          \bm{J}^{\text{\tiny cut}}(\bm{x}_{t})
         </span>
         . Each element
         <span class="ltx_Math" id="SS5.SSS2.p1.m5">
          i
         </span>
         of
         <span class="ltx_Math" id="SS5.SSS2.p1.m6">
          \bm{f}^{\text{\tiny cut}}(\bm{x}_{t})
         </span>
         and
         <span class="ltx_Math" id="SS5.SSS2.p1.m7">
          \bm{J}^{\text{\tiny cut}}(\bm{x}_{t})
         </span>
         is defined as
        </p>
        <div class="equation" style="display:flex;align-items:center;">
         <table class="ltx_equationgroup ltx_eqn_align ltx_eqn_table" id="A4.EGx16">
          <tbody id="Ex71">
           <tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
            <td class="ltx_eqn_cell ltx_eqn_center_padleft">
            </td>
            <td class="ltx_td ltx_align_right ltx_eqn_cell">
             <span class="ltx_Math" id="Ex71.m1">
              \displaystyle f^{\text{\tiny cut}}_{i}(x_{t,i})
             </span>
            </td>
            <td class="ltx_td ltx_align_left ltx_eqn_cell">
             <span class="ltx_Math" id="Ex71.m2">
              \displaystyle=\begin{cases}\textstyle x_{t,i}-x_{i}^{\scriptscriptstyle\min},&amp;\text{if}\ x_{t,i}&lt;x_{i}^{\scriptscriptstyle\min}\\
\textstyle x_{t,i}-x_{i}^{\scriptscriptstyle\max},&amp;\text{if}\ x_{t,i}&gt;x_{i}^{\scriptscriptstyle\max}\\
\textstyle 0,&amp;\text{otherwise}\end{cases},
             </span>
            </td>
            <td class="ltx_eqn_cell ltx_eqn_center_padright">
            </td>
           </tr>
          </tbody>
          <tbody id="Ex75">
           <tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
            <td class="ltx_eqn_cell ltx_eqn_center_padleft">
            </td>
            <td class="ltx_td ltx_align_right ltx_eqn_cell">
             <span class="ltx_Math" id="Ex75.m1">
              \displaystyle J^{\text{\tiny cut}}_{i,i}(x_{t,i})
             </span>
            </td>
            <td class="ltx_td ltx_align_left ltx_eqn_cell">
             <span class="ltx_Math" id="Ex75.m2">
              \displaystyle=\begin{cases}\textstyle 1,\hskip 39.833858pt&amp;\text{if}\ x_{t,i}&lt;x_{i}^{\scriptscriptstyle\min}\\
\textstyle 1,&amp;\text{if}\ x_{t,i}&gt;x_{i}^{\scriptscriptstyle\max}\\
\textstyle 0,&amp;\text{otherwise}\end{cases},
             </span>
            </td>
            <td class="ltx_eqn_cell ltx_eqn_center_padright">
            </td>
           </tr>
          </tbody>
         </table>
        </div>
        <p class="ltx_p">
         where
         <span class="ltx_Math" id="SS5.SSS2.p1.m8">
          f^{\text{\tiny cut}}_{i}(x_{t,i})
         </span>
         describes continuous ReLU-like functions for each dimension.
         <span class="ltx_Math" id="SS5.SSS2.p1.m9">
          f^{\text{\tiny cut}}_{i}(x_{t,i})
         </span>
         is
         <span class="ltx_Math" id="SS5.SSS2.p1.m10">
          0
         </span>
         inside the bounded domain and takes the signed distance value outside the boundary, see Fig.
         <a class="ltx_ref" href="#fig:fcut" title="Figure 17 ‣ 7.5.2 Bounded joint space ‣ 7.5 iLQR with quadratic cost on f(xt) ‣ 7 iLQR optimization ‣ A practical guide to learning and control problems in robotics solved with second-order optimization">
          <span class="ltx_text ltx_ref_tag">
           17
          </span>
         </a>
         -
         <em class="ltx_emph ltx_font_italic">
          left
         </em>
         .
        </p>
       </div>
       <div class="ltx_para" id="SS5.SSS2.p2">
        <p class="ltx_p">
         We can see with (
         <a class="ltx_ref" href="#eq:dcdx" title="(95) ‣ 7.5 iLQR with quadratic cost on f(xt) ‣ 7 iLQR optimization ‣ A practical guide to learning and control problems in robotics solved with second-order optimization">
          <span class="ltx_text ltx_ref_tag">
           95
          </span>
         </a>
         ) that for
         <span class="ltx_Math" id="SS5.SSS2.p2.m1">
          \bm{Q}=\frac{1}{2}\bm{I}
         </span>
         , if
         <span class="ltx_Math" id="SS5.SSS2.p2.m2">
          \bm{x}
         </span>
         is outside the domain during some time steps
         <span class="ltx_Math" id="SS5.SSS2.p2.m3">
          t
         </span>
         ,
         <span class="ltx_Math" id="SS5.SSS2.p2.m4">
          \bm{g}_{\bm{x}}=\frac{\partial c}{\partial\bm{x}}=2{\bm{J}}^{\scriptscriptstyle\top}\bm{Q}\bm{f}
         </span>
         generates a vector bringing it back to the boundary of the domain.
        </p>
       </div>
       <div id="SS5.SSS3">
       </div>
       <h3 class="ltx_title ltx_title_subsubsection">
        <span class="ltx_tag ltx_tag_subsubsection">
         <span class="ltx_text">
          7.5.3
         </span>
        </span>
        <span class="ltx_text">
         Bounded task space
        </span>
       </h3>
       <div class="ltx_para" id="SS5.SSS3.p1">
        <p class="ltx_p">
         The iLQR solution in (
         <a class="ltx_ref" href="#eq:du" title="(98) ‣ 7.5 iLQR with quadratic cost on f(xt) ‣ 7 iLQR optimization ‣ A practical guide to learning and control problems in robotics solved with second-order optimization">
          <span class="ltx_text ltx_ref_tag">
           98
          </span>
         </a>
         ) can be used to keep the end-effector within a boundary (e.g., end-effector position limits).
Based on the above definitions,
         <span class="ltx_Math" id="SS5.SSS3.p1.m1">
          \bm{f}(\bm{x})
         </span>
         and
         <span class="ltx_Math" id="SS5.SSS3.p1.m2">
          \bm{J}(\bm{x})
         </span>
         are in this case defined as
        </p>
        <div class="equation" style="display:flex;align-items:center;">
         <table class="ltx_equationgroup ltx_eqn_align ltx_eqn_table" id="A4.EGx17">
          <tbody id="Ex76">
           <tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
            <td class="ltx_eqn_cell ltx_eqn_center_padleft">
            </td>
            <td class="ltx_td ltx_align_right ltx_eqn_cell">
             <span class="ltx_Math" id="Ex76.m1">
              \displaystyle\bm{f}(\bm{x}_{t})
             </span>
            </td>
            <td class="ltx_td ltx_align_left ltx_eqn_cell">
             <span class="ltx_Math" id="Ex76.m2">
              \displaystyle=\bm{f}^{\text{\tiny cut}}\Big(\bm{e}(\bm{x}_{t})\Big),
             </span>
            </td>
            <td class="ltx_eqn_cell ltx_eqn_center_padright">
            </td>
           </tr>
          </tbody>
          <tbody id="Ex77">
           <tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
            <td class="ltx_eqn_cell ltx_eqn_center_padleft">
            </td>
            <td class="ltx_td ltx_align_right ltx_eqn_cell">
             <span class="ltx_Math" id="Ex77.m1">
              \displaystyle\bm{J}(\bm{x}_{t})
             </span>
            </td>
            <td class="ltx_td ltx_align_left ltx_eqn_cell">
             <span class="ltx_Math" id="Ex77.m2">
              \displaystyle=\bm{J}^{\text{\tiny cut}}\Big(\bm{e}(\bm{x}_{t})\Big)\;\bm{J}^{\text{\tiny ee}}(\bm{x}_{t}),
             </span>
            </td>
            <td class="ltx_eqn_cell ltx_eqn_center_padright">
            </td>
           </tr>
          </tbody>
          <tbody id="Ex78">
           <tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
            <td class="ltx_eqn_cell ltx_eqn_center_padleft">
            </td>
            <td class="ltx_td ltx_align_right ltx_eqn_cell">
             <span class="ltx_Math" id="Ex78.m1">
              \displaystyle\text{with}\quad\bm{e}(\bm{x}_{t})
             </span>
            </td>
            <td class="ltx_td ltx_align_left ltx_eqn_cell">
             <span class="ltx_Math" id="Ex78.m2">
              \displaystyle=\bm{f}^{\text{\tiny ee}}(\bm{x}_{t}).
             </span>
            </td>
            <td class="ltx_eqn_cell ltx_eqn_center_padright">
            </td>
           </tr>
          </tbody>
         </table>
        </div>
       </div>
       <div id="sec:reaching">
       </div>
       <h3 class="ltx_title ltx_title_subsubsection">
        <span class="ltx_tag ltx_tag_subsubsection">
         <span class="ltx_text">
          7.5.4
         </span>
        </span>
        <span class="ltx_text">
         Reaching task with robot manipulator and prismatic object boundaries
        </span>
       </h3>
       <div class="ltx_para" id="SS5.SSS4.p1">
        <p class="ltx_p">
         The definition of
         <span class="ltx_Math" id="SS5.SSS4.p1.m1">
          \bm{f}(\bm{x}_{t})
         </span>
         and
         <span class="ltx_Math" id="SS5.SSS4.p1.m2">
          \bm{J}(\bm{x}_{t})
         </span>
         in (
         <a class="ltx_ref" href="#eq:fJU" title="(99) ‣ 7.5.1 Robot manipulator ‣ 7.5 iLQR with quadratic cost on f(xt) ‣ 7 iLQR optimization ‣ A practical guide to learning and control problems in robotics solved with second-order optimization">
          <span class="ltx_text ltx_ref_tag">
           99
          </span>
         </a>
         ) can also be extended to objects/landmarks with boundaries by defining
        </p>
        <div class="equation" style="display:flex;align-items:center;">
         <table class="ltx_equationgroup ltx_eqn_align ltx_eqn_table" id="A4.EGx18">
          <tbody id="Ex79">
           <tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
            <td class="ltx_eqn_cell ltx_eqn_center_padleft">
            </td>
            <td class="ltx_td ltx_align_right ltx_eqn_cell">
             <span class="ltx_Math" id="Ex79.m1">
              \displaystyle\bm{f}(\bm{x}_{t})
             </span>
            </td>
            <td class="ltx_td ltx_align_left ltx_eqn_cell">
             <span class="ltx_Math" id="Ex79.m2">
              \displaystyle=\bm{f}^{\text{\tiny cut}}\Big(\bm{e}(\bm{x}_{t})\Big),
             </span>
            </td>
            <td class="ltx_eqn_cell ltx_eqn_center_padright">
            </td>
           </tr>
          </tbody>
          <tbody id="Ex80">
           <tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
            <td class="ltx_eqn_cell ltx_eqn_center_padleft">
            </td>
            <td class="ltx_td ltx_align_right ltx_eqn_cell">
             <span class="ltx_Math" id="Ex80.m1">
              \displaystyle\bm{J}(\bm{x}_{t})
             </span>
            </td>
            <td class="ltx_td ltx_align_left ltx_eqn_cell">
             <span class="ltx_Math" id="Ex80.m2">
              \displaystyle=\bm{J}^{\text{\tiny cut}}\Big(\bm{e}(\bm{x}_{t})\Big)\;\bm{U}_{t}^{\scriptscriptstyle\top}\;\bm{J}^{\text{\tiny ee}}(\bm{x}_{t}),
             </span>
            </td>
            <td class="ltx_eqn_cell ltx_eqn_center_padright">
            </td>
           </tr>
          </tbody>
          <tbody id="Ex81">
           <tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
            <td class="ltx_eqn_cell ltx_eqn_center_padleft">
            </td>
            <td class="ltx_td ltx_align_right ltx_eqn_cell">
             <span class="ltx_Math" id="Ex81.m1">
              \displaystyle\text{with}\quad\bm{e}(\bm{x}_{t})
             </span>
            </td>
            <td class="ltx_td ltx_align_left ltx_eqn_cell">
             <span class="ltx_Math" id="Ex81.m2">
              \displaystyle=\bm{U}_{t}^{\scriptscriptstyle\top}\big(\bm{f}^{\text{\tiny ee}}(\bm{x}_{t})-\bm{\mu}_{t}\big),
             </span>
            </td>
            <td class="ltx_eqn_cell ltx_eqn_center_padright">
            </td>
           </tr>
          </tbody>
         </table>
        </div>
        <p class="ltx_p">
         see also Fig.
         <a class="ltx_ref" href="#fig:iLQR_manipulator" title="Figure 18 ‣ 7.5.3 Bounded task space ‣ 7.5 iLQR with quadratic cost on f(xt) ‣ 7 iLQR optimization ‣ A practical guide to learning and control problems in robotics solved with second-order optimization">
          <span class="ltx_text ltx_ref_tag">
           18
          </span>
         </a>
         .
        </p>
       </div>
       <div id="SS5.SSS5">
       </div>
       <h3 class="ltx_title ltx_title_subsubsection">
        <span class="ltx_tag ltx_tag_subsubsection">
         <span class="ltx_text">
          7.5.5
         </span>
        </span>
        <span class="ltx_text">
         Center of mass
        </span>
       </h3>
       <div class="ltx_para" id="SS5.SSS5.p1">
        <p class="ltx_p">
         If we assume an equal mass for each link concentrated at the joint (i.e., assuming that the motors and gripper are heavier than the link structures), the forward kinematics function to determine the center of a mass of an articulated chain can simply be computed with
        </p>
        <div class="equation" style="display:flex;align-items:center;">
         <table class="ltx_equation ltx_eqn_table" id="Ex82">
          <tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
           <td class="ltx_eqn_cell ltx_eqn_center_padleft">
           </td>
           <td class="ltx_eqn_cell ltx_align_center">
            <span class="ltx_Math" id="Ex82.m1">
             \bm{f}^{\text{\tiny CoM}}=\frac{1}{D}\begin{bmatrix}\bm{\ell}^{\scriptscriptstyle\top}\bm{L}\cos(\bm{L}\bm{x})\\
\bm{\ell}^{\scriptscriptstyle\top}\bm{L}\sin(\bm{L}\bm{x})\end{bmatrix},
            </span>
           </td>
           <td class="ltx_eqn_cell ltx_eqn_center_padright">
           </td>
          </tr>
         </table>
        </div>
        <p class="ltx_p">
         which corresponds to the row average of
         <span class="ltx_Math" id="SS5.SSS5.p1.m1">
          \tilde{f}
         </span>
         in (
         <a class="ltx_ref" href="S3.html#eq:FKall" title="(13) ‣ 3 Forward kinematics (FK) for a planar robot manipulator ‣ A practical guide to learning and control problems in robotics solved with second-order optimization">
          <span class="ltx_text ltx_ref_tag">
           13
          </span>
         </a>
         ) for the first two columns (position). The corresponding Jacobian matrix is
        </p>
        <div class="equation" style="display:flex;align-items:center;">
         <table class="ltx_equation ltx_eqn_table" id="Ex83">
          <tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
           <td class="ltx_eqn_cell ltx_eqn_center_padleft">
           </td>
           <td class="ltx_eqn_cell ltx_align_center">
            <span class="ltx_Math" id="Ex83.m1">
             \bm{J}^{\text{\tiny CoM}}=\frac{1}{D}\begin{bmatrix}-\sin(\bm{L}\bm{x})^{\scriptscriptstyle\top}\bm{L}\;\mathrm{diag}(\bm{\ell}^{\scriptscriptstyle\top}\bm{L})\\
\cos(\bm{L}\bm{x})^{\scriptscriptstyle\top}\bm{L}\;\mathrm{diag}(\bm{\ell}^{\scriptscriptstyle\top}\bm{L})\end{bmatrix}.
            </span>
           </td>
           <td class="ltx_eqn_cell ltx_eqn_center_padright">
           </td>
          </tr>
         </table>
        </div>
       </div>
       <div class="ltx_para" id="SS5.SSS5.p2">
        <p class="ltx_p">
         The forward kinematics function
         <span class="ltx_Math" id="SS5.SSS5.p2.m1">
          \bm{f}^{\text{\tiny CoM}}
         </span>
         can be used in tracking tasks similar to the ones considering the end-effector, as in Section
         <a class="ltx_ref" href="#sec:reaching" title="7.5.4 Reaching task with robot manipulator and prismatic object boundaries ‣ 7.5 iLQR with quadratic cost on f(xt) ‣ 7 iLQR optimization ‣ A practical guide to learning and control problems in robotics solved with second-order optimization">
          <span class="ltx_text ltx_ref_tag">
           7.5.4
          </span>
         </a>
         . Fig.
         <a class="ltx_ref" href="#fig:iLQR_CoM" title="Figure 19 ‣ 7.5.5 Center of mass ‣ 7.5 iLQR with quadratic cost on f(xt) ‣ 7 iLQR optimization ‣ A practical guide to learning and control problems in robotics solved with second-order optimization">
          <span class="ltx_text ltx_ref_tag">
           19
          </span>
         </a>
         shows an example in which the starting and ending poses are depicted in different grayscale levels. The corresponding center of mass is depicted by a darker semi-filled disc. The area allowed for the center of mass is depicted as a transparent red rectangle. The task consists of reaching the green object with the end-effector at the end of the movement, while always keeping the center of mass within the desired bounding box during the movement.
        </p>
       </div>
       <div id="SS5.SSS6">
       </div>
       <h3 class="ltx_title ltx_title_subsubsection">
        <span class="ltx_tag ltx_tag_subsubsection">
         <span class="ltx_text">
          7.5.6
         </span>
        </span>
        <span class="ltx_text">
         Bimanual robot
        </span>
       </h3>
       <div class="ltx_para" id="SS5.SSS6.p1">
        <p class="ltx_p">
         We consider a 5-link planar bimanual robot with a torso link shared by the two arms, see Fig.
         <a class="ltx_ref" href="#fig:iLQR_bimanual" title="Figure 20 ‣ 7.5.6 Bimanual robot ‣ 7.5 iLQR with quadratic cost on f(xt) ‣ 7 iLQR optimization ‣ A practical guide to learning and control problems in robotics solved with second-order optimization">
          <span class="ltx_text ltx_ref_tag">
           20
          </span>
         </a>
         . We define the forward kinematics function as
        </p>
        <div class="equation" style="display:flex;align-items:center;">
         <table class="ltx_equation ltx_eqn_table" id="Ex84">
          <tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
           <td class="ltx_eqn_cell ltx_eqn_center_padleft">
           </td>
           <td class="ltx_eqn_cell ltx_align_center">
            <span class="ltx_Math" id="Ex84.m1">
             \bm{f}=\begin{bmatrix}\bm{\ell}_{\scriptscriptstyle{[1,2,3]}}^{\scriptscriptstyle\top}\cos(\bm{L}\bm{x}_{\scriptscriptstyle{[1,2,3]}})\\
\bm{\ell}_{\scriptscriptstyle{[1,2,3]}}^{\scriptscriptstyle\top}\sin(\bm{L}\bm{x}_{\scriptscriptstyle{[1,2,3]}})\\
\bm{\ell}_{\scriptscriptstyle{[1,4,5]}}^{\scriptscriptstyle\top}\cos(\bm{L}\bm{x}_{\scriptscriptstyle{[1,4,5]}})\\
\bm{\ell}_{\scriptscriptstyle{[1,4,5]}}^{\scriptscriptstyle\top}\sin(\bm{L}\bm{x}_{\scriptscriptstyle{[1,4,5]}})\\
\end{bmatrix}\!\!,
            </span>
           </td>
           <td class="ltx_eqn_cell ltx_eqn_center_padright">
           </td>
          </tr>
         </table>
        </div>
        <p class="ltx_p">
         where the first two and last two dimensions of
         <span class="ltx_Math" id="SS5.SSS6.p1.m1">
          \bm{f}
         </span>
         correspond to the position of the left and right end-effectors, respectively. The corresponding Jacobian matrix
         <span class="ltx_Math" id="SS5.SSS6.p1.m2">
          \bm{J}\in\mathbb{R}^{4\times 5}
         </span>
         has entries
        </p>
        <div class="equation" style="display:flex;align-items:center;">
         <table class="ltx_equation ltx_eqn_table" id="Ex85">
          <tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
           <td class="ltx_eqn_cell ltx_eqn_center_padleft">
           </td>
           <td class="ltx_eqn_cell ltx_align_center">
            <span class="ltx_Math" id="Ex85.m1">
             \bm{J}_{\scriptscriptstyle{[1,2],[1,2,3]}}=\begin{bmatrix}-\sin(\bm{L}\bm{x}_{\scriptscriptstyle{[1,2,3]}})^{\scriptscriptstyle\top}\mathrm{diag}(\bm{\ell}_{\scriptscriptstyle{[1,2,3]}})\bm{L}\\
\cos(\bm{L}\bm{x}_{\scriptscriptstyle{[1,2,3]}})^{\scriptscriptstyle\top}\mathrm{diag}(\bm{\ell}_{\scriptscriptstyle{[1,2,3]}})\bm{L}\end{bmatrix},\quad\bm{J}_{\scriptscriptstyle{[3,4],[1,4,5]}}=\begin{bmatrix}-\sin(\bm{L}\bm{x}_{\scriptscriptstyle{[1,4,5]}})^{\scriptscriptstyle\top}\mathrm{diag}(\bm{\ell}_{\scriptscriptstyle{[1,4,5]}})\bm{L}\\
\cos(\bm{L}\bm{x}_{\scriptscriptstyle{[1,4,5]}})^{\scriptscriptstyle\top}\mathrm{diag}(\bm{\ell}_{\scriptscriptstyle{[1,4,5]}})\bm{L}\end{bmatrix},\\
            </span>
           </td>
           <td class="ltx_eqn_cell ltx_eqn_center_padright">
           </td>
          </tr>
         </table>
        </div>
        <p class="ltx_p">
         where the remaining entries are zeros.
        </p>
       </div>
       <div class="ltx_para" id="SS5.SSS6.p2">
        <p class="ltx_p">
         If we assume a unit mass for each arm link concentrated at the joint and a mass of two units at the tip of the first link (i.e., assuming that the motors and gripper are heavier than the link structures, and that two motors are located at the tip of the first link to control the left and right arms), the forward kinematics function to determine the center of a mass of the bimanual articulated chain in Fig.
         <a class="ltx_ref" href="#fig:iLQR_bimanual" title="Figure 20 ‣ 7.5.6 Bimanual robot ‣ 7.5 iLQR with quadratic cost on f(xt) ‣ 7 iLQR optimization ‣ A practical guide to learning and control problems in robotics solved with second-order optimization">
          <span class="ltx_text ltx_ref_tag">
           20
          </span>
         </a>
         can be computed with
        </p>
        <div class="equation" style="display:flex;align-items:center;">
         <table class="ltx_equation ltx_eqn_table" id="Ex86">
          <tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
           <td class="ltx_eqn_cell ltx_eqn_center_padleft">
           </td>
           <td class="ltx_eqn_cell ltx_align_center">
            <span class="ltx_Math" id="Ex86.m1">
             \bm{f}^{\text{\tiny CoM}}=\frac{1}{6}\begin{bmatrix}\bm{\ell}_{\scriptscriptstyle{[1,2,3]}}^{\scriptscriptstyle\top}\bm{L}\cos(\bm{L}\bm{x}_{\scriptscriptstyle{[1,2,3]}})+\bm{\ell}_{\scriptscriptstyle{[1,4,5]}}^{\scriptscriptstyle\top}\bm{L}\cos(\bm{L}\bm{x}_{\scriptscriptstyle{[1,4,5]}})\\
\bm{\ell}_{\scriptscriptstyle{[1,2,3]}}^{\scriptscriptstyle\top}\bm{L}\sin(\bm{L}\bm{x}_{\scriptscriptstyle{[1,2,3]}})+\bm{\ell}_{\scriptscriptstyle{[1,4,5]}}^{\scriptscriptstyle\top}\bm{L}\sin(\bm{L}\bm{x}_{\scriptscriptstyle{[1,4,5]}})\end{bmatrix},
            </span>
           </td>
           <td class="ltx_eqn_cell ltx_eqn_center_padright">
           </td>
          </tr>
         </table>
        </div>
        <p class="ltx_p">
         with the corresponding Jacobian matrix
         <span class="ltx_Math" id="SS5.SSS6.p2.m1">
          \bm{J}^{\text{\tiny CoM}}\in\mathbb{R}^{2\times 5}
         </span>
         computed as
        </p>
        <div class="equation" style="display:flex;align-items:center;">
         <table class="ltx_equation ltx_eqn_table" id="Ex87">
          <tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
           <td class="ltx_eqn_cell ltx_eqn_center_padleft">
           </td>
           <td class="ltx_eqn_cell ltx_align_center">
            <span class="ltx_Math" id="Ex87.m1">
             \bm{J}^{\text{\tiny CoM}}=\begin{bmatrix}\bm{J}^{\text{\tiny CoM-L}}_{[1,2],1}+\bm{J}^{\text{\tiny CoM-R}}_{[1,2],1},&amp;\bm{J}^{\text{\tiny CoM-L}}_{[1,2],[2,3]},&amp;\bm{J}^{\text{\tiny CoM-R}}_{[1,2],[2,3]}\end{bmatrix},
            </span>
           </td>
           <td class="ltx_eqn_cell ltx_eqn_center_padright">
           </td>
          </tr>
         </table>
        </div>
        <div class="equation" style="display:flex;align-items:center;">
         <table class="ltx_equation ltx_eqn_table" id="Ex88">
          <tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
           <td class="ltx_eqn_cell ltx_eqn_center_padleft">
           </td>
           <td class="ltx_eqn_cell ltx_align_center">
            <span class="ltx_Math" id="Ex88.m1">
             \text{with}\quad\bm{J}^{\text{\tiny CoM-L}}=\frac{1}{6}\begin{bmatrix}-\sin(\bm{L}\bm{x}_{\scriptscriptstyle{[1,2,3]}})^{\scriptscriptstyle\top}\bm{L}\;\mathrm{diag}(\bm{\ell}_{\scriptscriptstyle{[1,2,3]}}^{\scriptscriptstyle\top}\bm{L})\\
\cos(\bm{L}\bm{x}_{\scriptscriptstyle{[1,2,3]}})^{\scriptscriptstyle\top}\bm{L}\;\mathrm{diag}(\bm{\ell}_{\scriptscriptstyle{[1,2,3]}}^{\scriptscriptstyle\top}\bm{L})\end{bmatrix},\quad\bm{J}^{\text{\tiny CoM-R}}=\frac{1}{6}\begin{bmatrix}-\sin(\bm{L}\bm{x}_{\scriptscriptstyle{[1,4,5]}})^{\scriptscriptstyle\top}\bm{L}\;\mathrm{diag}(\bm{\ell}_{\scriptscriptstyle{[1,4,5]}}^{\scriptscriptstyle\top}\bm{L})\\
\cos(\bm{L}\bm{x}_{\scriptscriptstyle{[1,4,5]}})^{\scriptscriptstyle\top}\bm{L}\;\mathrm{diag}(\bm{\ell}_{\scriptscriptstyle{[1,4,5]}}^{\scriptscriptstyle\top}\bm{L})\end{bmatrix}.
            </span>
           </td>
           <td class="ltx_eqn_cell ltx_eqn_center_padright">
           </td>
          </tr>
         </table>
        </div>
       </div>
       <div id="SS5.SSS7">
       </div>
       <h3 class="ltx_title ltx_title_subsubsection">
        <span class="ltx_tag ltx_tag_subsubsection">
         <span class="ltx_text">
          7.5.7
         </span>
        </span>
        <span class="ltx_text">
         Obstacle avoidance with ellipsoid shapes
        </span>
       </h3>
       <div class="ltx_para" id="SS5.SSS7.p1">
        <p class="ltx_p">
         By taking as example a point-mass system, iLQR can be used to solve an ellipsoidal obstacle avoidance problem with the cost (typically used with other costs, see Fig.
         <a class="ltx_ref" href="#fig:iLQR_obstacle" title="Figure 21 ‣ 7.5.7 Obstacle avoidance with ellipsoid shapes ‣ 7.5 iLQR with quadratic cost on f(xt) ‣ 7 iLQR optimization ‣ A practical guide to learning and control problems in robotics solved with second-order optimization">
          <span class="ltx_text ltx_ref_tag">
           21
          </span>
         </a>
         for an example). We first define a ReLU-like function and its gradient as (see also Fig.
         <a class="ltx_ref" href="#fig:fcut" title="Figure 17 ‣ 7.5.2 Bounded joint space ‣ 7.5 iLQR with quadratic cost on f(xt) ‣ 7 iLQR optimization ‣ A practical guide to learning and control problems in robotics solved with second-order optimization">
          <span class="ltx_text ltx_ref_tag">
           17
          </span>
         </a>
         -
         <em class="ltx_emph ltx_font_italic">
          right
         </em>
         )
        </p>
        <div class="equation" style="display:flex;align-items:center;">
         <table class="ltx_equation ltx_eqn_table" id="Ex89">
          <tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
           <td class="ltx_eqn_cell ltx_eqn_center_padleft">
           </td>
           <td class="ltx_eqn_cell ltx_align_center">
            <span class="ltx_Math" id="Ex89.m1">
             f^{\text{\tiny avoid}}(d)=\begin{cases}0,&amp;\text{if}\ d&gt;1\\
1-d,&amp;\text{otherwise}\end{cases},\quad\quad g^{\text{\tiny avoid}}(d)=\begin{cases}0,\hskip 17.071654pt&amp;\text{if}\ d&gt;1\\
-1,&amp;\text{otherwise}\end{cases},
            </span>
           </td>
           <td class="ltx_eqn_cell ltx_eqn_center_padright">
           </td>
          </tr>
         </table>
        </div>
        <p class="ltx_p">
         that we exploit to define
         <span class="ltx_Math" id="SS5.SSS7.p1.m1">
          \bm{f}(\bm{x}_{t})
         </span>
         and
         <span class="ltx_Math" id="SS5.SSS7.p1.m2">
          \bm{J}(\bm{x}_{t})
         </span>
         in (
         <a class="ltx_ref" href="#eq:du" title="(98) ‣ 7.5 iLQR with quadratic cost on f(xt) ‣ 7 iLQR optimization ‣ A practical guide to learning and control problems in robotics solved with second-order optimization">
          <span class="ltx_text ltx_ref_tag">
           98
          </span>
         </a>
         ) as
        </p>
        <div class="equation" style="display:flex;align-items:center;">
         <table class="ltx_equationgroup ltx_eqn_align ltx_eqn_table" id="A4.EGx19">
          <tbody id="Ex90">
           <tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
            <td class="ltx_eqn_cell ltx_eqn_center_padleft">
            </td>
            <td class="ltx_td ltx_align_right ltx_eqn_cell">
             <span class="ltx_Math" id="Ex90.m1">
              \displaystyle\bm{f}(\bm{x}_{t})
             </span>
            </td>
            <td class="ltx_td ltx_align_left ltx_eqn_cell">
             <span class="ltx_Math" id="Ex90.m2">
              \displaystyle=f^{\text{\tiny avoid}}\Big(e(\bm{x}_{t})\Big),\quad\quad\bm{J}(\bm{x}_{t})=2\;g^{\text{\tiny avoid}}\Big(e(\bm{x}_{t})\Big)\;{(\bm{x}_{t}-\bm{\mu})}^{\scriptscriptstyle\top}\;\bm{\Sigma}^{-1},
             </span>
            </td>
            <td class="ltx_eqn_cell ltx_eqn_center_padright">
            </td>
           </tr>
          </tbody>
          <tbody id="Ex91">
           <tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
            <td class="ltx_eqn_cell ltx_eqn_center_padleft">
            </td>
            <td class="ltx_td ltx_align_right ltx_eqn_cell">
             <span class="ltx_Math" id="Ex91.m1">
              \displaystyle\text{with}\quad e(\bm{x}_{t})
             </span>
            </td>
            <td class="ltx_td ltx_align_left ltx_eqn_cell">
             <span class="ltx_Math" id="Ex91.m2">
              \displaystyle={(\bm{x}_{t}-\bm{\mu})}^{\scriptscriptstyle\top}\bm{\Sigma}^{-1}(\bm{x}_{t}-\bm{\mu}).
             </span>
            </td>
            <td class="ltx_eqn_cell ltx_eqn_center_padright">
            </td>
           </tr>
          </tbody>
         </table>
        </div>
       </div>
       <div class="ltx_para" id="SS5.SSS7.p2">
        <p class="ltx_p">
         In the above,
         <span class="ltx_Math" id="SS5.SSS7.p2.m1">
          \bm{f}(\bm{x})
         </span>
         defines a continuous function that is
         <span class="ltx_Math" id="SS5.SSS7.p2.m2">
          0
         </span>
         outside the obstacle boundaries and
         <span class="ltx_Math" id="SS5.SSS7.p2.m3">
          1
         </span>
         at the center of the obstacle. The ellipsoid is defined by a center
         <span class="ltx_Math" id="SS5.SSS7.p2.m4">
          \bm{\mu}
         </span>
         and a shape
         <span class="ltx_Math" id="SS5.SSS7.p2.m5">
          \bm{\Sigma}=\bm{V}\bm{V}^{\scriptscriptstyle\top}
         </span>
         , where
         <span class="ltx_Math" id="SS5.SSS7.p2.m6">
          \bm{V}
         </span>
         is a horizontal concatenation of vectors
         <span class="ltx_Math" id="SS5.SSS7.p2.m7">
          \bm{V}_{i}
         </span>
         describing the principal axes of the ellipsoid, see Fig.
         <a class="ltx_ref" href="#fig:iLQR_obstacle" title="Figure 21 ‣ 7.5.7 Obstacle avoidance with ellipsoid shapes ‣ 7.5 iLQR with quadratic cost on f(xt) ‣ 7 iLQR optimization ‣ A practical guide to learning and control problems in robotics solved with second-order optimization">
          <span class="ltx_text ltx_ref_tag">
           21
          </span>
         </a>
         .
        </p>
       </div>
       <div class="ltx_para" id="SS5.SSS7.p3">
        <p class="ltx_p">
         A similar principle can be applied to robot manipulators by composing forward kinematics and obstacle avoidance functions.
        </p>
       </div>
       <div id="SS5.SSS8">
       </div>
       <h3 class="ltx_title ltx_title_subsubsection">
        <span class="ltx_tag ltx_tag_subsubsection">
         <span class="ltx_text">
          7.5.8
         </span>
        </span>
        <span class="ltx_text">
         Maintaining a desired distance to an object
        </span>
       </h3>
       <div class="ltx_para" id="SS5.SSS8.p1">
        <p class="ltx_p">
         The obstacle example above can easily be extended to the problem of maintaining a desired distance to an object, which can also typically used with other objectives. We first define a function and a gradient
        </p>
        <div class="equation" style="display:flex;align-items:center;">
         <table class="ltx_equation ltx_eqn_table" id="Ex92">
          <tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
           <td class="ltx_eqn_cell ltx_eqn_center_padleft">
           </td>
           <td class="ltx_eqn_cell ltx_align_center">
            <span class="ltx_Math" id="Ex92.m1">
             f^{\text{\tiny dist}}(d)=1-d,\quad\quad g^{\text{\tiny dist}}(d)=-1,
            </span>
           </td>
           <td class="ltx_eqn_cell ltx_eqn_center_padright">
           </td>
          </tr>
         </table>
        </div>
        <p class="ltx_p">
         that we exploit to define
         <span class="ltx_Math" id="SS5.SSS8.p1.m1">
          \bm{f}(\bm{x}_{t})
         </span>
         and
         <span class="ltx_Math" id="SS5.SSS8.p1.m2">
          \bm{J}(\bm{x}_{t})
         </span>
         in (
         <a class="ltx_ref" href="#eq:du" title="(98) ‣ 7.5 iLQR with quadratic cost on f(xt) ‣ 7 iLQR optimization ‣ A practical guide to learning and control problems in robotics solved with second-order optimization">
          <span class="ltx_text ltx_ref_tag">
           98
          </span>
         </a>
         ) as
        </p>
        <div class="equation" style="display:flex;align-items:center;">
         <table class="ltx_equationgroup ltx_eqn_align ltx_eqn_table" id="A4.EGx20">
          <tbody id="Ex93">
           <tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
            <td class="ltx_eqn_cell ltx_eqn_center_padleft">
            </td>
            <td class="ltx_td ltx_align_right ltx_eqn_cell">
             <span class="ltx_Math" id="Ex93.m1">
              \displaystyle\bm{f}(\bm{x}_{t})
             </span>
            </td>
            <td class="ltx_td ltx_align_left ltx_eqn_cell">
             <span class="ltx_Math" id="Ex93.m2">
              \displaystyle=f^{\text{\tiny dist}}\Big(e(\bm{x}_{t})\Big),\quad\quad\bm{J}(\bm{x}_{t})=-\frac{2}{r^{2}}{(\bm{x}_{t}-\bm{\mu})}^{\scriptscriptstyle\top},
             </span>
            </td>
            <td class="ltx_eqn_cell ltx_eqn_center_padright">
            </td>
           </tr>
          </tbody>
          <tbody id="Ex94">
           <tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
            <td class="ltx_eqn_cell ltx_eqn_center_padleft">
            </td>
            <td class="ltx_td ltx_align_right ltx_eqn_cell">
             <span class="ltx_Math" id="Ex94.m1">
              \displaystyle\text{with}\quad e(\bm{x}_{t})
             </span>
            </td>
            <td class="ltx_td ltx_align_left ltx_eqn_cell">
             <span class="ltx_Math" id="Ex94.m2">
              \displaystyle=\frac{1}{r^{2}}{(\bm{x}_{t}-\bm{\mu})}^{\scriptscriptstyle\top}(\bm{x}_{t}-\bm{\mu}).
             </span>
            </td>
            <td class="ltx_eqn_cell ltx_eqn_center_padright">
            </td>
           </tr>
          </tbody>
         </table>
        </div>
       </div>
       <div class="ltx_para" id="SS5.SSS8.p2">
        <p class="ltx_p">
         In the above,
         <span class="ltx_Math" id="SS5.SSS8.p2.m1">
          \bm{f}(\bm{x})
         </span>
         defines a continuous function that is
         <span class="ltx_Math" id="SS5.SSS8.p2.m2">
          0
         </span>
         on a sphere of radius
         <span class="ltx_Math" id="SS5.SSS8.p2.m3">
          r
         </span>
         centered on the object (defined by a center
         <span class="ltx_Math" id="SS5.SSS8.p2.m4">
          \bm{\mu}
         </span>
         ), and increasing/decreasing when moving away from this surface in one direction or the other.
        </p>
       </div>
       <div id="SS5.SSS9">
       </div>
       <h3 class="ltx_title ltx_title_subsubsection">
        <span class="ltx_tag ltx_tag_subsubsection">
         <span class="ltx_text">
          7.5.9
         </span>
        </span>
        <span class="ltx_text">
         Manipulability tracking
        </span>
       </h3>
       <div class="ltx_para" id="SS5.SSS9.p1">
        <p class="ltx_p">
         Skills transfer can exploit manipulability ellipsoids in the form of geometric descriptors representing the skills to be transferred to the robot. As these ellipsoids lie on symmetric positive definite (SPD) manifolds, Riemannian geometry can be used to learn and reproduce these descriptors in a probabilistic manner
         <cite class="ltx_cite ltx_citemacro_cite">
          [
          <a class="ltx_ref" href="bib.html#bib10" title="Gaussians on Riemannian manifolds: applications for robot learning and adaptive control">
           3
          </a>
          ]
         </cite>
         .
        </p>
       </div>
       <div class="ltx_para" id="SS5.SSS9.p2">
        <p class="ltx_p">
         Manipulability ellipsoids come in different flavors. They can be defined for either positions or forces (including the orientation/rotational part). Manipulability can be described at either kinematic or dynamic levels, for either open or closed linkages (e.g., for bimanual manipulation or in-hand manipulation), and for either actuated or non-actuated joints
         <cite class="ltx_cite ltx_citemacro_cite">
          [
          <a class="ltx_ref" href="bib.html#bib14" title="Manipulability of closed kinematic chains">
           13
          </a>
          ]
         </cite>
         . This large set of manipulability ellipsoids provide rich descriptors to characterize robot skills for robots with legs and arms.
        </p>
       </div>
       <div class="ltx_para" id="SS5.SSS9.p3">
        <p class="ltx_p">
         Manipulability ellipsoids are helpful descriptors to handle skill transfer problems involving dissimilar kinematic chains, such as transferring manipulation skills between humans and robots, or between two robots with different kinematic chains or capabilities. In such transfer problems, imitation at joint angles level is not possible due to the different structures, and imitation at end-effector(s) level is limited, because it does not encapsulate postural information, which is often an essential aspect of the skill that we would like to transfer. Manipulability ellipsoids provide intermediate descriptors that allows postural information to be transferred indirectly, with the advantage that it allows different embodiments and capabilities to be considered in the skill transfer process.
        </p>
       </div>
       <div class="ltx_para" id="SS5.SSS9.p4">
        <p class="ltx_p">
         The manipulability ellipsoid
         <span class="ltx_Math" id="SS5.SSS9.p4.m1">
          \bm{M}(\bm{x})=\bm{J}(\bm{x}){\bm{J}(\bm{x})}^{\scriptscriptstyle\top}
         </span>
         is a symmetric positive definite matrix representing the manipulability at a given point on the kinematic chain defined by a forward kinematics function
         <span class="ltx_Math" id="SS5.SSS9.p4.m2">
          \bm{f}(\bm{x})
         </span>
         , given the joint angle posture
         <span class="ltx_Math" id="SS5.SSS9.p4.m3">
          \bm{x}
         </span>
         , where
         <span class="ltx_Math" id="SS5.SSS9.p4.m4">
          \bm{J}(\bm{x})
         </span>
         is the Jacobian of
         <span class="ltx_Math" id="SS5.SSS9.p4.m5">
          \bm{f}(\bm{x})
         </span>
         . The determinant of
         <span class="ltx_Math" id="SS5.SSS9.p4.m6">
          \bm{M}(\bm{x})
         </span>
         is often used as a scalar manipulability index indicating the volume of the ellipsoid
         <cite class="ltx_cite ltx_citemacro_cite">
          [
          <a class="ltx_ref" href="bib.html#bib13" title="Dynamic manipulability of robot manipulators">
           15
          </a>
          ]
         </cite>
         , with the drawback of ignoring the specific shape of this ellipsoid.
        </p>
       </div>
       <div class="ltx_para" id="SS5.SSS9.p5">
        <p class="ltx_p">
         In
         <cite class="ltx_cite ltx_citemacro_cite">
          [
          <a class="ltx_ref" href="bib.html#bib12" title="Geometry-aware manipulability learning, tracking and transfer">
           5
          </a>
          ]
         </cite>
         , we showed that a geometric cost on manipulability can alternatively be defined with the geodesic distance
        </p>
        <div class="equation" style="display:flex;align-items:center;">
         <table class="ltx_equationgroup ltx_eqn_align ltx_eqn_table" id="A4.EGx21">
          <tbody id="Ex95">
           <tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
            <td class="ltx_eqn_cell ltx_eqn_center_padleft">
            </td>
            <td class="ltx_td ltx_align_right ltx_eqn_cell">
             <span class="ltx_Math" id="Ex95.m1">
              \displaystyle c
             </span>
            </td>
            <td class="ltx_td ltx_align_left ltx_eqn_cell">
             <span class="ltx_Math" id="Ex95.m2">
              \displaystyle=\|\bm{A}\|^{2}_{\text{F}},\quad\text{with}\quad\bm{A}=\log\!\big(\bm{S}^{\frac{1}{2}}\bm{M}(\bm{x})\bm{S}^{\frac{1}{2}}\big),
             </span>
            </td>
            <td class="ltx_eqn_cell ltx_eqn_center_padright">
            </td>
           </tr>
          </tbody>
          <tbody id="eq:cManipulability">
           <tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
            <td class="ltx_eqn_cell ltx_eqn_center_padleft">
            </td>
            <td class="ltx_td ltx_align_right ltx_eqn_cell">
             <span class="ltx_Math" id="E100.m1">
              \displaystyle\iff\;c
             </span>
            </td>
            <td class="ltx_td ltx_align_left ltx_eqn_cell">
             <span class="ltx_Math" id="E100.m2">
              \displaystyle=\text{trace}(\bm{A}\bm{A}^{\scriptscriptstyle\top})=\sum_{i}\text{trace}(\bm{A}_{i}\bm{A}_{i}^{\scriptscriptstyle\top})=\sum_{i}\bm{A}_{i}^{\scriptscriptstyle\top}\bm{A}_{i}={\text{vec}(\bm{A})}^{\scriptscriptstyle\top}\text{vec}(\bm{A}),
             </span>
            </td>
            <td class="ltx_eqn_cell ltx_eqn_center_padright">
            </td>
           </tr>
          </tbody>
         </table>
         <div class="ltx_eqn_eqno">
          <div>
           (100)
          </div>
         </div>
        </div>
        <p class="ltx_p">
         where
         <span class="ltx_Math" id="SS5.SSS9.p5.m1">
          \bm{S}
         </span>
         is the desired manipulability matrix to reach,
         <span class="ltx_Math" id="SS5.SSS9.p5.m2">
          \log(\cdot)
         </span>
         is the logarithm matrix function, and
         <span class="ltx_Math" id="SS5.SSS9.p5.m3">
          \|\cdot\|_{\text{F}}
         </span>
         is a Frobenius norm. By exploiting the trace properties, we can see that (
         <a class="ltx_ref" href="#eq:cManipulability" title="(100) ‣ 7.5.9 Manipulability tracking ‣ 7.5 iLQR with quadratic cost on f(xt) ‣ 7 iLQR optimization ‣ A practical guide to learning and control problems in robotics solved with second-order optimization">
          <span class="ltx_text ltx_ref_tag">
           100
          </span>
         </a>
         ) can be expressed in a quadratic form, where the vectorization operation
         <span class="ltx_Math" id="SS5.SSS9.p5.m4">
          \text{vec}(\bm{A})
         </span>
         can be computed efficiently by exploiting the symmetry of the matrix
         <span class="ltx_Math" id="SS5.SSS9.p5.m5">
          \bm{A}
         </span>
         . This is implemented by keeping only the lower half of the matrix, with the elements below the diagonal multiplied by a factor
         <span class="ltx_Math" id="SS5.SSS9.p5.m6">
          \sqrt{2}
         </span>
         .
        </p>
       </div>
       <div class="ltx_para" id="SS5.SSS9.p6">
        <p class="ltx_p">
         The derivatives of (
         <a class="ltx_ref" href="#eq:cManipulability" title="(100) ‣ 7.5.9 Manipulability tracking ‣ 7.5 iLQR with quadratic cost on f(xt) ‣ 7 iLQR optimization ‣ A practical guide to learning and control problems in robotics solved with second-order optimization">
          <span class="ltx_text ltx_ref_tag">
           100
          </span>
         </a>
         ) with respect to the state
         <span class="ltx_Math" id="SS5.SSS9.p6.m1">
          \bm{x}
         </span>
         and control commands
         <span class="ltx_Math" id="SS5.SSS9.p6.m2">
          \bm{u}
         </span>
         can be computed numerically (as in the provided example), analytically (by following an approach similar to the one presented in
         <cite class="ltx_cite ltx_citemacro_cite">
          [
          <a class="ltx_ref" href="bib.html#bib12" title="Geometry-aware manipulability learning, tracking and transfer">
           5
          </a>
          ]
         </cite>
         ), or by automatic differentiation. The quadratic form of (
         <a class="ltx_ref" href="#eq:cManipulability" title="(100) ‣ 7.5.9 Manipulability tracking ‣ 7.5 iLQR with quadratic cost on f(xt) ‣ 7 iLQR optimization ‣ A practical guide to learning and control problems in robotics solved with second-order optimization">
          <span class="ltx_text ltx_ref_tag">
           100
          </span>
         </a>
         ) can be exploited to solve the iLQR problem with Gauss–Newton optimization, by using Jacobians (see description in Section
         <a class="ltx_ref" href="S4.html#sec:IKnum" title="4.1 Numerical estimation of the Jacobian ‣ 4 Inverse kinematics (IK) for a planar robot manipulator ‣ A practical guide to learning and control problems in robotics solved with second-order optimization">
          <span class="ltx_text ltx_ref_tag">
           4.1
          </span>
         </a>
         within the context of inverse kinematics). Marić
         <em class="ltx_emph ltx_font_italic">
          et al.
         </em>
         demonstrated the advantages of a geometric cost as in (
         <a class="ltx_ref" href="#eq:cManipulability" title="(100) ‣ 7.5.9 Manipulability tracking ‣ 7.5 iLQR with quadratic cost on f(xt) ‣ 7 iLQR optimization ‣ A practical guide to learning and control problems in robotics solved with second-order optimization">
          <span class="ltx_text ltx_ref_tag">
           100
          </span>
         </a>
         ) for planning problems, by comparing it to alternative widely used metrics such as the manipulability index and the dexterity index
         <cite class="ltx_cite ltx_citemacro_cite">
          [
          <a class="ltx_ref" href="bib.html#bib15" title="A Riemannian metric for geometry-aware singularity avoidance by articulated robots">
           7
          </a>
          ]
         </cite>
         .
        </p>
       </div>
       <div class="ltx_para" id="SS5.SSS9.p7">
        <p class="ltx_p">
         Note here that manipulability can be defined at several points of interest, including endeffectors and centers of mass. Figure
         <a class="ltx_ref" href="#fig:iLQR_manipulability" title="Figure 22 ‣ 7.5.9 Manipulability tracking ‣ 7.5 iLQR with quadratic cost on f(xt) ‣ 7 iLQR optimization ‣ A practical guide to learning and control problems in robotics solved with second-order optimization">
          <span class="ltx_text ltx_ref_tag">
           22
          </span>
         </a>
         presents a simple example with a bimanual robot. Manipulability ellipsoids can also be exploited as descriptors for object affordances, by defining manipulability at the level of specific points on objects or tools held by the robot. For example, we can consider a manipulability ellipsoid at the level of the head of a hammer. When the robot grasps the hammer, its endeffector is extended so that the head of the hammer becomes the extremity of the kinematic chain. In this situation, the different options that the robot has to grasp the hammer will have an impact on the resulting manipulability at the head of the hammer. Thus, grabbing the hammer at the extremity of the handle will improve the resulting manipulability. Such descriptors offer promises for learning and optimization in manufacturing environments, in order to let robots automatically determine the correct ways to employ tools, including grasping points and body postures.
        </p>
       </div>
       <div class="ltx_para" id="SS5.SSS9.p8">
        <p class="ltx_p">
         The above iLQR approach, with a geodesic cost on SPD manifolds, has been presented for manipulability ellipsoids, but it can be extended to other descriptors represented as ellipsoids. In particular, stiffness, feedback gains, inertia, and centroidal momentum have similar structures. For the latter, the centroidal momentum ellipsoid quantifies the momentum generation ability of the robot
         <cite class="ltx_cite ltx_citemacro_cite">
          [
          <a class="ltx_ref" href="bib.html#bib16" title="Centroidal momentum matrix of a humanoid robot: structure and properties">
           11
          </a>
          ]
         </cite>
         , which is another useful descriptor for robotics skills. Similarly to manipulability ellipsoids, it is constructed from Jacobians, which are in this case the centroidal momentum matrices mapping the joint angle velocities to the centroidal momentum, which sums over the individual link momenta after projecting each to the robot’s center of mass.
        </p>
       </div>
       <div class="ltx_para" id="SS5.SSS9.p9">
        <p class="ltx_p">
         The approach can also be extended to other forms of symmetric positive definite matrices, such as kernel matrices used in machine learning algorithms to compute similarities, or graph graph Laplacians (a matrix representation of a graph that can for example be used to construct a low dimensional embedding of a graph).
        </p>
       </div>
       <div id="SS6">
       </div>
       <h2 class="ltx_title ltx_title_subsection">
        <span class="ltx_tag ltx_tag_subsection">
         <span class="ltx_text">
          7.6
         </span>
        </span>
        <span class="ltx_text">
         iLQR with control primitives
        </span>
       </h2>
       <div class="ltx_para" id="SS6.p1">
        <p class="ltx_p">
         The use of control primitives can be extended to iLQR, by considering
         <span class="ltx_Math" id="SS6.p1.m1">
          \Delta\bm{u}=\bm{\Psi}\Delta\bm{w}
         </span>
         .
For problems with quadratic cost on
         <span class="ltx_Math" id="SS6.p1.m2">
          \bm{f}(\bm{x}_{t})
         </span>
         (see previous Section), the update of the weights vector is then given by
        </p>
        <div class="equation" style="display:flex;align-items:center;">
         <table class="ltx_equation ltx_eqn_table" id="eq:dw">
          <tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
           <td class="ltx_eqn_cell ltx_eqn_center_padleft">
           </td>
           <td class="ltx_eqn_cell ltx_align_center">
            <span class="ltx_Math" id="E101.m1">
             \Delta\bm{\hat{w}}\!=\!{\Big(\bm{\Psi}^{\!{\scriptscriptstyle\top}}\bm{S}_{\bm{u}}^{\scriptscriptstyle\top}\bm{J}(\bm{x})^{\scriptscriptstyle\top}\bm{Q}\bm{J}(\bm{x})\bm{S}_{\bm{u}}\bm{\Psi}+\bm{\Psi}^{\!{\scriptscriptstyle\top}}\bm{R}\,\bm{\Psi}\Big)}^{\!\!-1}\Big(-\bm{\Psi}^{\!{\scriptscriptstyle\top}}\bm{S}_{\bm{u}}^{\scriptscriptstyle\top}\bm{J}(\bm{x})^{\scriptscriptstyle\top}\bm{Q}\bm{f}(\bm{x})-\bm{\Psi}^{\!{\scriptscriptstyle\top}}\bm{R}\,\bm{u}\Big).
            </span>
           </td>
           <td class="ltx_eqn_cell ltx_eqn_center_padright">
           </td>
          </tr>
         </table>
         <div class="ltx_eqn_eqno">
          <div>
           (101)
          </div>
         </div>
        </div>
       </div>
       <div class="ltx_para" id="SS6.p2">
        <p class="ltx_p">
         For a 5-link kinematic chain, by setting the coordination matrix in (
         <a class="ltx_ref" href="S6.html#eq:Psi2" title="(58) ‣ 6.2 LQT with control primitives ‣ 6 Linear quadratic tracking (LQT) ‣ A practical guide to learning and control problems in robotics solved with second-order optimization">
          <span class="ltx_text ltx_ref_tag">
           58
          </span>
         </a>
         ) as
        </p>
        <div class="equation" style="display:flex;align-items:center;">
         <table class="ltx_equation ltx_eqn_table" id="Ex96">
          <tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
           <td class="ltx_eqn_cell ltx_eqn_center_padleft">
           </td>
           <td class="ltx_eqn_cell ltx_align_center">
            <span class="ltx_Math" id="Ex96.m1">
             \bm{C}=\begin{bmatrix}-1&amp;0&amp;0\\
2&amp;0&amp;0\\
-1&amp;0&amp;0\\
0&amp;1&amp;0\\
0&amp;0&amp;1\end{bmatrix},
            </span>
           </td>
           <td class="ltx_eqn_cell ltx_eqn_center_padright">
           </td>
          </tr>
         </table>
        </div>
        <p class="ltx_p">
         the first three joints are coordinated such that the third link is always oriented in the same direction, while the last two joints can move independently. Figure
         <a class="ltx_ref" href="#fig:iLQR_humanoid" title="Figure 23 ‣ 7.6 iLQR with control primitives ‣ 7 iLQR optimization ‣ A practical guide to learning and control problems in robotics solved with second-order optimization">
          <span class="ltx_text ltx_ref_tag">
           23
          </span>
         </a>
         shows an example for a reaching task, with the 5-link kinematic chain depicting a humanoid robot that needs to keep its torso upright.
        </p>
       </div>
       <div class="ltx_para" id="SS6.p3">
        <p class="ltx_p">
         Note also that the iLQR updates in (
         <a class="ltx_ref" href="#eq:dw" title="(101) ‣ 7.6 iLQR with control primitives ‣ 7 iLQR optimization ‣ A practical guide to learning and control problems in robotics solved with second-order optimization">
          <span class="ltx_text ltx_ref_tag">
           101
          </span>
         </a>
         ) can usually be computed faster than in the original formulation, since a matrix of much smaller dimension needs to be inverted.
        </p>
       </div>
       <div id="SS7">
       </div>
       <h2 class="ltx_title ltx_title_subsection">
        <span class="ltx_tag ltx_tag_subsection">
         <span class="ltx_text">
          7.7
         </span>
        </span>
        <span class="ltx_text">
         iLQR for spacetime optimization
        </span>
       </h2>
       <div class="ltx_para" id="SS7.p1">
        <p class="ltx_p">
         We define a phase variable
         <span class="ltx_Math" id="SS7.p1.m1">
          s_{t}
         </span>
         starting from
         <span class="ltx_Math" id="SS7.p1.m2">
          s_{1}=0
         </span>
         at the beginning of the movement.
With an augmented state
         <span class="ltx_Math" id="SS7.p1.m3">
          \bm{x}_{t}={[\mathbf{x}_{t}^{\scriptscriptstyle\top},s_{t}]}^{\scriptscriptstyle\top}
         </span>
         and control command
         <span class="ltx_Math" id="SS7.p1.m4">
          \bm{u}_{t}={[{\bm{u}^{\mathbf{x}}_{t}}^{\scriptscriptstyle\top},u^{s}_{t}]}^{\scriptscriptstyle\top}
         </span>
         , we define the evolution of the system
         <span class="ltx_Math" id="SS7.p1.m5">
          \bm{x}_{t+1}=\bm{d}(\bm{x}_{t},\bm{u}_{t})
         </span>
         as
        </p>
        <div class="equation" style="display:flex;align-items:center;">
         <table class="ltx_equationgroup ltx_eqn_align ltx_eqn_table" id="A4.EGx22">
          <tbody id="Ex97">
           <tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
            <td class="ltx_eqn_cell ltx_eqn_center_padleft">
            </td>
            <td class="ltx_td ltx_align_right ltx_eqn_cell">
             <span class="ltx_Math" id="Ex97.m1">
              \displaystyle\mathbf{x}_{t+1}
             </span>
            </td>
            <td class="ltx_td ltx_align_left ltx_eqn_cell">
             <span class="ltx_Math" id="Ex97.m2">
              \displaystyle=\mathbf{A}_{t}\mathbf{x}_{t}+\mathbf{B}_{t}\bm{u}^{\mathbf{x}}_{t}\,u^{s}_{t},
             </span>
            </td>
            <td class="ltx_eqn_cell ltx_eqn_center_padright">
            </td>
           </tr>
          </tbody>
          <tbody id="Ex98">
           <tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
            <td class="ltx_eqn_cell ltx_eqn_center_padleft">
            </td>
            <td class="ltx_td ltx_align_right ltx_eqn_cell">
             <span class="ltx_Math" id="Ex98.m1">
              \displaystyle s_{t+1}
             </span>
            </td>
            <td class="ltx_td ltx_align_left ltx_eqn_cell">
             <span class="ltx_Math" id="Ex98.m2">
              \displaystyle=s_{t}+u^{s}_{t}.
             </span>
            </td>
            <td class="ltx_eqn_cell ltx_eqn_center_padright">
            </td>
           </tr>
          </tbody>
         </table>
        </div>
       </div>
       <div class="ltx_para" id="SS7.p2">
        <p class="ltx_p">
         Its first order Taylor expansion around
         <span class="ltx_Math" id="SS7.p2.m1">
          \bm{\hat{x}},\bm{\hat{u}}
         </span>
         provides the linear system
        </p>
        <div class="equation" style="display:flex;align-items:center;">
         <table class="ltx_equationgroup ltx_eqn_align ltx_eqn_table" id="A4.EGx23">
          <tbody id="Ex109">
           <tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
            <td class="ltx_eqn_cell ltx_eqn_center_padleft">
            </td>
            <td class="ltx_td ltx_align_right ltx_eqn_cell">
             <span class="ltx_Math" id="Ex109.m1">
              \displaystyle\underbrace{\begin{bmatrix}\textstyle\Delta\mathbf{x}_{t+1}\\
\textstyle\Delta s_{t+1}\end{bmatrix}}_{\Delta\bm{x}_{t+1}}
             </span>
            </td>
            <td class="ltx_td ltx_align_left ltx_eqn_cell">
             <span class="ltx_Math" id="Ex109.m2">
              \displaystyle=\underbrace{\begin{bmatrix}\textstyle\mathbf{A}_{t}&amp;\bm{0}\\
\textstyle\bm{0}&amp;1\end{bmatrix}}_{\bm{A}_{t}}\underbrace{\begin{bmatrix}\textstyle\Delta\mathbf{x}_{t}\\
\textstyle\Delta s_{t}\end{bmatrix}}_{\Delta\bm{x}_{t}}+\underbrace{\begin{bmatrix}\textstyle\mathbf{B}_{t}u^{s}_{t}&amp;\mathbf{B}_{t}\bm{u}^{\mathbf{x}}_{t}\\
\textstyle\bm{0}&amp;1\end{bmatrix}}_{\bm{B}_{t}}\underbrace{\begin{bmatrix}\textstyle\Delta\bm{u}^{\mathbf{x}}_{t}\\
\textstyle\Delta u^{s}_{t}\end{bmatrix}}_{\Delta\bm{u}_{t}},
             </span>
            </td>
            <td class="ltx_eqn_cell ltx_eqn_center_padright">
            </td>
           </tr>
          </tbody>
         </table>
        </div>
        <p class="ltx_p">
         with Jacobian matrices
         <span class="ltx_Math" id="SS7.p2.m2">
          \bm{A}_{t}\!=\!\frac{\partial\bm{d}}{\partial\bm{x}_{t}}
         </span>
         ,
         <span class="ltx_Math" id="SS7.p2.m3">
          \bm{B}_{t}\!=\!\frac{\partial\bm{d}}{\partial\bm{u}_{t}}
         </span>
         . Note that in the above equations, we used here the notation
         <span class="ltx_Math" id="SS7.p2.m4">
          \mathbf{x}_{t}
         </span>
         and
         <span class="ltx_Math" id="SS7.p2.m5">
          \bm{x}_{t}
         </span>
         to describe the standard state and augmented state, respectively. We similarly used
         <span class="ltx_Math" id="SS7.p2.m6">
          \{\mathbf{A}_{t},\mathbf{B}_{t}\}
         </span>
         and
         <span class="ltx_Math" id="SS7.p2.m7">
          \{\bm{A}_{t},\bm{B}_{t}\}
         </span>
         (with slanted font) for standard linear system and augmented linear system.
        </p>
       </div>
       <div class="ltx_para" id="SS7.p3">
        <p class="ltx_p">
         Figure
         <a class="ltx_ref" href="#fig:iLQR_spacetime" title="Figure 24 ‣ 7.7 iLQR for spacetime optimization ‣ 7 iLQR optimization ‣ A practical guide to learning and control problems in robotics solved with second-order optimization">
          <span class="ltx_text ltx_ref_tag">
           24
          </span>
         </a>
         shows a viapoints task example in which both path and duration are optimized (convergence after 10 iterations when starting from zero commands). The example uses a double integrator as linear system defined by constant
         <span class="ltx_Math" id="SS7.p3.m1">
          \mathbf{A}_{t}
         </span>
         and
         <span class="ltx_Math" id="SS7.p3.m2">
          \mathbf{B}_{t}
         </span>
         matrices.
        </p>
       </div>
       <div id="SS8">
       </div>
       <h2 class="ltx_title ltx_title_subsection">
        <span class="ltx_tag ltx_tag_subsection">
         <span class="ltx_text">
          7.8
         </span>
        </span>
        <span class="ltx_text">
         iLQR with offdiagonal elements in the precision matrix
        </span>
       </h2>
       <div class="ltx_para" id="SS8.p1">
        <p class="ltx_p">
         Spatial and/or temporal constraints can be considered by setting
         <span class="ltx_Math" id="SS8.p1.m1">
          \left[\begin{smallmatrix}\bm{I}&amp;-\bm{I}\\
-\bm{I}&amp;\bm{I}\end{smallmatrix}\right]
         </span>
         in the corresponding entries of the precision matrix
         <span class="ltx_Math" id="SS8.p1.m2">
          \bm{Q}
         </span>
         . With this formulation, we can constrain two positions to be the same without having to predetermine the position at which the two should meet. Indeed, we can see that a cost
         <span class="ltx_Math" id="SS8.p1.m3">
          c\!=\!\left[\begin{smallmatrix}x_{i}\\
x_{j}\end{smallmatrix}\right]^{\scriptscriptstyle\top}\left[\begin{smallmatrix}1&amp;-1\\
-1&amp;1\end{smallmatrix}\right]\left[\begin{smallmatrix}x_{i}\\
x_{j}\end{smallmatrix}\right]\!=\!(x_{i}-x_{j})^{2}
         </span>
         is minimized when
         <span class="ltx_Math" id="SS8.p1.m4">
          x_{i}\!=\!x_{j}
         </span>
         .
        </p>
       </div>
       <div class="ltx_para" id="SS8.p2">
        <p class="ltx_p">
         Such cost can for example be used to define costs on object affordances, see Fig.
         <a class="ltx_ref" href="#fig:iLQR_manipulator_objAffordances" title="Figure 25 ‣ 7.8 iLQR with offdiagonal elements in the precision matrix ‣ 7 iLQR optimization ‣ A practical guide to learning and control problems in robotics solved with second-order optimization">
          <span class="ltx_text ltx_ref_tag">
           25
          </span>
         </a>
         for an example.
        </p>
       </div>
       <div id="SS9">
       </div>
       <h2 class="ltx_title ltx_title_subsection">
        <span class="ltx_tag ltx_tag_subsection">
         <span class="ltx_text">
          7.9
         </span>
        </span>
        <span class="ltx_text">
         Car steering
        </span>
       </h2>
       <div class="ltx_para ltx_noindent" id="SS9.p1">
        <p class="ltx_p">
         <span class="ltx_text ltx_font_bold">
          Velocity Control Input
         </span>
         <br class="ltx_break"/>
         A car motion with position
         <span class="ltx_Math" id="SS9.p1.m1">
          (x_{1},x_{2})
         </span>
         , car orientation
         <span class="ltx_Math" id="SS9.p1.m2">
          \theta
         </span>
         , and front wheels orientation
         <span class="ltx_Math" id="SS9.p1.m3">
          \phi
         </span>
         (see Fig.
         <a class="ltx_ref" href="#fig:iLQR_car_bicopter" title="Figure 26 ‣ 7.9 Car steering ‣ 7 iLQR optimization ‣ A practical guide to learning and control problems in robotics solved with second-order optimization">
          <span class="ltx_text ltx_ref_tag">
           26
          </span>
         </a>
         -
         <em class="ltx_emph ltx_font_italic">
          left
         </em>
         ) is characterized by equations
        </p>
        <div class="equation" style="display:flex;align-items:center;">
         <table class="ltx_equation ltx_eqn_table" id="Ex110">
          <tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
           <td class="ltx_eqn_cell ltx_eqn_center_padleft">
           </td>
           <td class="ltx_eqn_cell ltx_align_center">
            <span class="ltx_Math" id="Ex110.m1">
             \dot{x}_{1}=u_{1}\cos(\theta),\quad\dot{x}_{2}=u_{1}\sin(\theta),\quad\dot{\theta}=\frac{u_{1}}{\ell}\tan(\phi),\quad\dot{\phi}=u_{2},
            </span>
           </td>
           <td class="ltx_eqn_cell ltx_eqn_center_padright">
           </td>
          </tr>
         </table>
        </div>
        <p class="ltx_p">
         where
         <span class="ltx_Math" id="SS9.p1.m4">
          \ell
         </span>
         is the distance between the front and back axles,
         <span class="ltx_Math" id="SS9.p1.m5">
          u_{1}
         </span>
         is the back wheels velocity command and
         <span class="ltx_Math" id="SS9.p1.m6">
          u_{2}
         </span>
         is the front wheels steering velocity command.
Its first order Taylor expansion around
         <span class="ltx_Math" id="SS9.p1.m7">
          (\hat{\theta},\hat{\phi},\hat{u}_{1})
         </span>
         is
        </p>
        <div class="equation" style="display:flex;align-items:center;">
         <table class="ltx_equation ltx_eqn_table" id="E102">
          <tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
           <td class="ltx_eqn_cell ltx_eqn_center_padleft">
           </td>
           <td class="ltx_eqn_cell ltx_align_center">
            <span class="ltx_Math" id="E102.m1">
             \footnotesize\begin{bmatrix}\Delta\dot{x}_{1}\\
\Delta\dot{x}_{2}\\
\Delta\dot{\theta}\\
\Delta\dot{\phi}\end{bmatrix}=\begin{bmatrix}0&amp;0&amp;-\hat{u}_{1}\sin(\hat{\theta})&amp;0\\
0&amp;0&amp;\hat{u}_{1}\cos(\hat{\theta})&amp;0\\
0&amp;0&amp;0&amp;\frac{\hat{u}_{1}}{\ell}(\tan(\hat{\phi})^{2}\!+\!1)\\
0&amp;0&amp;0&amp;0\end{bmatrix}\begin{bmatrix}\Delta x_{1}\\
\Delta x_{2}\\
\Delta\theta\\
\Delta\phi\end{bmatrix}+\footnotesize\begin{bmatrix}\cos(\hat{\theta})&amp;0\\
\sin(\hat{\theta})&amp;0\\
\frac{1}{\ell}\tan(\hat{\phi})&amp;0\\
0&amp;1\end{bmatrix}\begin{bmatrix}\Delta u_{1}\\
\Delta u_{2}\end{bmatrix},
            </span>
           </td>
           <td class="ltx_eqn_cell ltx_eqn_center_padright">
           </td>
          </tr>
         </table>
         <div class="ltx_eqn_eqno">
          <div>
           (102)
          </div>
         </div>
        </div>
        <p class="ltx_p">
         which can then be converted to a discrete form with (
         <a class="ltx_ref" href="A3.html#eq:AdAc" title="(117) ‣ Appendix C Linear systems used in the bimanual tennis serve example ‣ A practical guide to learning and control problems in robotics solved with second-order optimization">
          <span class="ltx_text ltx_ref_tag">
           117
          </span>
         </a>
         ).
         <br class="ltx_break"/>
        </p>
       </div>
       <div class="ltx_para ltx_noindent" id="SS9.p2">
        <p class="ltx_p">
         <span class="ltx_text ltx_font_bold">
          Acceleration Control Input
          <br class="ltx_break"/>
         </span>
         A car motion with position
         <span class="ltx_Math" id="SS9.p2.m1">
          (x_{1},x_{2})
         </span>
         , car orientation
         <span class="ltx_Math" id="SS9.p2.m2">
          \theta
         </span>
         , and front wheels orientation
         <span class="ltx_Math" id="SS9.p2.m3">
          \phi
         </span>
         (see Fig.
         <a class="ltx_ref" href="#fig:iLQR_car_bicopter" title="Figure 26 ‣ 7.9 Car steering ‣ 7 iLQR optimization ‣ A practical guide to learning and control problems in robotics solved with second-order optimization">
          <span class="ltx_text ltx_ref_tag">
           26
          </span>
         </a>
         -
         <em class="ltx_emph ltx_font_italic">
          left
         </em>
         ) is characterized by equations
        </p>
        <div class="equation" style="display:flex;align-items:center;">
         <table class="ltx_equation ltx_eqn_table" id="Ex111">
          <tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
           <td class="ltx_eqn_cell ltx_eqn_center_padleft">
           </td>
           <td class="ltx_eqn_cell ltx_align_center">
            <span class="ltx_Math" id="Ex111.m1">
             \dot{x}_{1}=v\cos(\theta),\quad\dot{x}_{2}=v\sin(\theta),\quad\dot{\theta}=\frac{v}{\ell}\tan(\phi),\quad\dot{v}=u_{1},\quad\dot{\phi}=u_{2},
            </span>
           </td>
           <td class="ltx_eqn_cell ltx_eqn_center_padright">
           </td>
          </tr>
         </table>
        </div>
        <p class="ltx_p">
         where
         <span class="ltx_Math" id="SS9.p2.m4">
          \ell
         </span>
         is the distance between the front and back axles,
         <span class="ltx_Math" id="SS9.p2.m5">
          u_{1}
         </span>
         is the back wheels acceleration command and
         <span class="ltx_Math" id="SS9.p2.m6">
          u_{2}
         </span>
         is the front wheels steering velocity command.
Its first order Taylor expansion around
         <span class="ltx_Math" id="SS9.p2.m7">
          (\hat{\theta},\hat{\phi},\hat{v})
         </span>
         is
        </p>
        <div class="equation" style="display:flex;align-items:center;">
         <table class="ltx_equation ltx_eqn_table" id="E103">
          <tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
           <td class="ltx_eqn_cell ltx_eqn_center_padleft">
           </td>
           <td class="ltx_eqn_cell ltx_align_center">
            <span class="ltx_Math" id="E103.m1">
             \footnotesize\begin{bmatrix}\Delta\dot{x}_{1}\\
\Delta\dot{x}_{2}\\
\Delta\dot{\theta}\\
\Delta\dot{v}\\
\Delta\dot{\phi}\end{bmatrix}=\begin{bmatrix}0&amp;0&amp;-\hat{v}\sin(\hat{\theta})&amp;\cos(\hat{\theta})&amp;0\\
0&amp;0&amp;\hat{v}\cos(\hat{\theta})&amp;\sin(\hat{\theta})&amp;0\\
0&amp;0&amp;0&amp;\frac{1}{\ell}\tan(\hat{\phi})&amp;\frac{\hat{v}}{\ell}(\tan(\hat{\phi})^{2}\!+\!1)\\
0&amp;0&amp;0&amp;0&amp;0\\
0&amp;0&amp;0&amp;0&amp;0\end{bmatrix}\begin{bmatrix}\Delta x_{1}\\
\Delta x_{2}\\
\Delta\theta\\
\Delta v\\
\Delta\phi\end{bmatrix}+\footnotesize\begin{bmatrix}0&amp;0\\
0&amp;0\\
0&amp;0\\
1&amp;0\\
0&amp;1\end{bmatrix}\begin{bmatrix}\Delta u_{1}\\
\Delta u_{2}\end{bmatrix},
            </span>
           </td>
           <td class="ltx_eqn_cell ltx_eqn_center_padright">
           </td>
          </tr>
         </table>
         <div class="ltx_eqn_eqno">
          <div>
           (103)
          </div>
         </div>
        </div>
        <p class="ltx_p">
         which can then be converted to a discrete form with (
         <a class="ltx_ref" href="A3.html#eq:AdAc" title="(117) ‣ Appendix C Linear systems used in the bimanual tennis serve example ‣ A practical guide to learning and control problems in robotics solved with second-order optimization">
          <span class="ltx_text ltx_ref_tag">
           117
          </span>
         </a>
         ).
        </p>
       </div>
       <div id="SS10">
       </div>
       <h2 class="ltx_title ltx_title_subsection">
        <span class="ltx_tag ltx_tag_subsection">
         <span class="ltx_text">
          7.10
         </span>
        </span>
        <span class="ltx_text">
         Bicopter
        </span>
       </h2>
       <div class="ltx_para" id="SS10.p1">
        <p class="ltx_p">
         A planar bicopter of mass
         <span class="ltx_Math" id="SS10.p1.m1">
          m
         </span>
         and inertia
         <span class="ltx_Math" id="SS10.p1.m2">
          I
         </span>
         actuated by two propellers at distance
         <span class="ltx_Math" id="SS10.p1.m3">
          \ell
         </span>
         (see Fig.
         <a class="ltx_ref" href="#fig:iLQR_car_bicopter" title="Figure 26 ‣ 7.9 Car steering ‣ 7 iLQR optimization ‣ A practical guide to learning and control problems in robotics solved with second-order optimization">
          <span class="ltx_text ltx_ref_tag">
           26
          </span>
         </a>
         -
         <em class="ltx_emph ltx_font_italic">
          right
         </em>
         ) is characterized by equations
        </p>
        <div class="equation" style="display:flex;align-items:center;">
         <table class="ltx_equation ltx_eqn_table" id="Ex112">
          <tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
           <td class="ltx_eqn_cell ltx_eqn_center_padleft">
           </td>
           <td class="ltx_eqn_cell ltx_align_center">
            <span class="ltx_Math" id="Ex112.m1">
             \ddot{x}_{1}=-\frac{1}{m}(u_{1}+u_{2})\sin(\theta),\quad\ddot{x}_{2}=\frac{1}{m}(u_{1}+u_{2})\cos(\theta)-g,\quad\ddot{\theta}=\frac{\ell}{I}(u_{1}-u_{2}),
            </span>
           </td>
           <td class="ltx_eqn_cell ltx_eqn_center_padright">
           </td>
          </tr>
         </table>
        </div>
        <p class="ltx_p">
         with acceleration
         <span class="ltx_Math" id="SS10.p1.m4">
          g\!=\!9.81
         </span>
         due to gravity. Its first order Taylor expansion around
         <span class="ltx_Math" id="SS10.p1.m5">
          (\hat{\theta},\hat{u}_{2},\hat{u}_{2})
         </span>
         is
        </p>
        <div class="equation" style="display:flex;align-items:center;">
         <table class="ltx_equation ltx_eqn_table" id="E104">
          <tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
           <td class="ltx_eqn_cell ltx_eqn_center_padleft">
           </td>
           <td class="ltx_eqn_cell ltx_align_center">
            <span class="ltx_Math" id="E104.m1">
             \footnotesize\begin{bmatrix}\Delta\dot{x}_{1}\\
\Delta\dot{x}_{2}\\
\Delta\dot{\theta}\\
\Delta\ddot{x}_{1}\\
\Delta\ddot{x}_{2}\\
\Delta\ddot{\theta}\end{bmatrix}=\begin{bmatrix}0&amp;0&amp;0&amp;1&amp;0&amp;0\\
0&amp;0&amp;0&amp;0&amp;1&amp;0\\
0&amp;0&amp;0&amp;0&amp;0&amp;1\\
0&amp;0&amp;-\frac{1}{m}(\hat{u}_{1}+\hat{u}_{2})\cos(\hat{\theta})&amp;0&amp;0&amp;0\\
0&amp;0&amp;-\frac{1}{m}(\hat{u}_{1}+\hat{u}_{2})\sin(\hat{\theta})&amp;0&amp;0&amp;0\\
0&amp;0&amp;0&amp;0&amp;0&amp;0\end{bmatrix}\begin{bmatrix}\Delta x_{1}\\
\Delta x_{2}\\
\Delta\theta\\
\Delta\dot{x}_{1}\\
\Delta\dot{x}_{2}\\
\Delta\dot{\theta}\end{bmatrix}+\footnotesize\begin{bmatrix}0&amp;0\\
0&amp;0\\
0&amp;0\\
-\frac{1}{m}\sin(\hat{\theta})&amp;-\frac{1}{m}\sin(\hat{\theta})\\
\frac{1}{m}\cos(\hat{\theta})&amp;\frac{1}{m}\cos(\hat{\theta})\\
\frac{\ell}{I}&amp;-\frac{\ell}{I}\end{bmatrix}\begin{bmatrix}\Delta u_{1}\\
\Delta u_{2}\end{bmatrix},
            </span>
           </td>
           <td class="ltx_eqn_cell ltx_eqn_center_padright">
           </td>
          </tr>
         </table>
         <div class="ltx_eqn_eqno">
          <div>
           (104)
          </div>
         </div>
        </div>
        <p class="ltx_p">
         which can then be converted to a discrete form with (
         <a class="ltx_ref" href="A3.html#eq:AdAc" title="(117) ‣ Appendix C Linear systems used in the bimanual tennis serve example ‣ A practical guide to learning and control problems in robotics solved with second-order optimization">
          <span class="ltx_text ltx_ref_tag">
           117
          </span>
         </a>
         ).
        </p>
       </div>
       <ul class="pagination justify-content-center small_menu">
        <li class="page-item previous_file">
         <a class="page-link" href="S6.html">
          Previous
         </a>
        </li>
        <li class="page-item next_file">
         <a class="page-link" href="S8.html">
          Next
         </a>
        </li>
       </ul>
      </div>
     </div>
     <div class="col-sm-3">
      <div id="img-col">
       <figure class="ltx_figure figure_main" id="fig:iLQR_summary">
        <img class="ltx_graphics ltx_centering" id="F15.g1" src="images/iLQR-eqs-overview01.png"/>
        <figcaption class="ltx_caption ltx_centering">
         <span class="ltx_tag ltx_tag_figure">
          <span class="ltx_text">
           Figure 15
          </span>
          :
         </span>
         <span class="ltx_text">
          Summary of the iLQR optimization procedure in batch form.
         </span>
        </figcaption>
       </figure>
       <figure class="ltx_figure figure_main" id="fig:transformations">
        <img class="ltx_graphics ltx_centering" id="F16.g1" src="images/transformations01.jpg"/>
        <figcaption class="ltx_caption ltx_centering">
         <span class="ltx_tag ltx_tag_figure">
          <span class="ltx_text">
           Figure 16
          </span>
          :
         </span>
         <span class="ltx_text">
          Typical transformations involved in a manipulation task involving a robot, a vision system, a visual marker on the object, and a desired grasping location on the object.
         </span>
        </figcaption>
       </figure>
       <figure class="ltx_figure ltx_align_floatright figure_main" id="fig:fcut">
        <img class="ltx_graphics ltx_centering" id="F17.g1" src="images/fcut01.png"/>
        <figcaption class="ltx_caption ltx_centering">
         <span class="ltx_tag ltx_tag_figure">
          <span class="ltx_text">
           Figure 17
          </span>
          :
         </span>
         <span class="ltx_text">
          ReLU-like functions used in optimization costs. The derivatives of these functions are simple, providing Jacobians whose entries are either
          <span class="ltx_Math" id="F17.m3">
           0
          </span>
          or
          <span class="ltx_Math" id="F17.m4">
           \pm 1
          </span>
          .
         </span>
        </figcaption>
       </figure>
       <figure class="ltx_figure figure_main" id="fig:iLQR_manipulator">
        <img class="ltx_graphics" id="F18.g1" src="images/iLQR_objectBoundaries01.jpg"/>
        <figcaption class="ltx_caption">
         <span class="ltx_tag ltx_tag_figure">
          <span class="ltx_text">
           Figure 18
          </span>
          :
         </span>
         <span class="ltx_text">
          Example of a viapoints task in which a planar robot with 3 joints needs to sequentially reach 2 objects, with object boundaries defining the allowed reaching points on the objects surfaces.
          <em class="ltx_emph ltx_font_italic">
           Left:
          </em>
          Reaching task with two viapoints at
          <span class="ltx_Math" id="F18.m5">
           t=25
          </span>
          and
          <span class="ltx_Math" id="F18.m6">
           t=50
          </span>
          .
          <em class="ltx_emph ltx_font_italic">
           Right:
          </em>
          Corresponding values of the cost function for the end-effector space at
          <span class="ltx_Math" id="F18.m7">
           t=25
          </span>
          and
          <span class="ltx_Math" id="F18.m8">
           t=50
          </span>
          .
         </span>
        </figcaption>
       </figure>
       <figure class="ltx_figure ltx_align_floatright figure_main" id="fig:iLQR_CoM">
        <img class="ltx_graphics ltx_centering" id="F19.g1" src="images/iLQR_CoM01.png"/>
        <figcaption class="ltx_caption ltx_centering">
         <span class="ltx_tag ltx_tag_figure">
          <span class="ltx_text">
           Figure 19
          </span>
          :
         </span>
         <span class="ltx_text">
          Reaching task with a humanoid (side view) by keeping the center of mass in an area defined by the feet location.
         </span>
        </figcaption>
       </figure>
       <figure class="ltx_figure figure_main" id="fig:iLQR_bimanual">
        <img class="ltx_graphics" id="F20.g1" src="images/iLQR_bimanual02.png"/>
        <img class="ltx_graphics" id="F20.g2" src="images/iLQR_bimanual01.png"/>
        <figcaption class="ltx_caption">
         <span class="ltx_tag ltx_tag_figure">
          <span class="ltx_text">
           Figure 20
          </span>
          :
         </span>
         <span class="ltx_text">
          Reaching tasks with a bimanual robot (frontal view).
          <em class="ltx_emph ltx_font_italic">
           Left:
          </em>
          with a target for each hand.
          <em class="ltx_emph ltx_font_italic">
           Right:
          </em>
          with a target for the hand on the left, while keeping the center of mass at the same location during the whole movement.
         </span>
        </figcaption>
       </figure>
       <figure class="ltx_figure ltx_align_floatright figure_main" id="fig:iLQR_obstacle">
        <img class="ltx_graphics ltx_centering" id="F21.g1" src="images/iLQR_ellipsoidObstacle01.png"/>
        <figcaption class="ltx_caption ltx_centering">
         <span class="ltx_tag ltx_tag_figure">
          <span class="ltx_text">
           Figure 21
          </span>
          :
         </span>
         <span class="ltx_text">
          Reaching task with obstacle avoidance, by starting from
          <span class="ltx_Math" id="F21.m3">
           \bm{x}_{1}
          </span>
          and reaching
          <span class="ltx_Math" id="F21.m4">
           \bm{\mu}_{T}
          </span>
          while avoiding the two obstacles in red.
         </span>
        </figcaption>
       </figure>
       <figure class="ltx_figure figure_main" id="fig:iLQR_manipulability">
        <img class="ltx_graphics" id="F22.g1" src="images/iLQR_manipulability01.png"/>
        <figcaption class="ltx_caption">
         <span class="ltx_tag ltx_tag_figure">
          <span class="ltx_text">
           Figure 22
          </span>
          :
         </span>
         <span class="ltx_text">
          Example of iLQR optimization with a cost on manipulability, where the goal is to reach, at the end of the motion, a desired manipulability defined at the center of mass (CoM) of a bimanual planar robot. The initial pose of the bimanual robot is displayed in light gray and the final pose of the robot is displayed in dark gray. The desired manipulability is represented by the red ellipse. The achieved manipulability at the end of the motion is represented by the gray ellipse. Both manipulability ellipses are displayed at the CoM reached at the end of the motion, displayed as a semi-filled dark gray disc (the CoM at the beginning of the motion is displayed in lighter gray color). We can see that the posture adopted by the robot to approach the desired manipulability is to extend both arms, which is the pose allowing the robot to swiftly move its center of mass in case of unexpected perturbations.
         </span>
        </figcaption>
       </figure>
       <figure class="ltx_figure figure_main" id="fig:iLQR_humanoid">
        <img class="ltx_graphics ltx_centering" id="F23.g1" src="images/iLQR_humanoid_CP01.png"/>
        <figcaption class="ltx_caption ltx_centering">
         <span class="ltx_tag ltx_tag_figure">
          <span class="ltx_text">
           Figure 23
          </span>
          :
         </span>
         <span class="ltx_text">
          Reaching task with control primitives.
         </span>
        </figcaption>
       </figure>
       <figure class="ltx_figure ltx_align_floatright figure_main" id="fig:iLQR_spacetime">
        <img class="ltx_graphics ltx_centering" id="F24.g1" src="images/iLQR_spacetime01.png"/>
        <figcaption class="ltx_caption ltx_centering">
         <span class="ltx_tag ltx_tag_figure">
          <span class="ltx_text">
           Figure 24
          </span>
          :
         </span>
         <span class="ltx_text">
          Spacetime optimization with iLQR for a viapoints task, where the estimated durations between consecutive viapoints are shown in blue.
         </span>
        </figcaption>
       </figure>
       <figure class="ltx_figure figure_main" id="fig:iLQR_manipulator_objAffordances">
        <img class="ltx_graphics" id="F25.g1" src="images/iLQR_objAffordances01.png"/>
        <img class="ltx_graphics" id="F25.g2" src="images/iLQR_objAffordances02.png"/>
        <figcaption class="ltx_caption">
         <span class="ltx_tag ltx_tag_figure">
          <span class="ltx_text">
           Figure 25
          </span>
          :
         </span>
         <span class="ltx_text">
          Manipulation with object affordances cost. The depicted
          <em class="ltx_emph ltx_font_italic">
           pick-and-place
          </em>
          task requires the offset at the picking location to be the same as the offset at the placing location, which can be achieved by setting a precision matrix with non-zero offdiagonal entries, see main text for details. In this example, an additional cost is set for choosing the picking and placing points within the object boundaries, which was also used for the task depicted in Fig.
          <a class="ltx_ref" href="#fig:iLQR_manipulator" title="Figure 18 ‣ 7.5.3 Bounded task space ‣ 7.5 iLQR with quadratic cost on f(xt) ‣ 7 iLQR optimization ‣ A practical guide to learning and control problems in robotics solved with second-order optimization">
           <span class="ltx_text ltx_ref_tag">
            18
           </span>
          </a>
          . We can see with the resulting motions that when picking the object, the robot anticipates what will be done later with this object, which can be viewed as a basic form of object affordance. In the two situations depicted in the figure, the robot efficiently chooses a grasping point close to one of the corners of the object, different in the two situations, so that the robot can bring the object at the desired location with less effort and without reaching joint angle limits.
         </span>
        </figcaption>
       </figure>
       <figure class="ltx_figure figure_main" id="fig:iLQR_car_bicopter">
        <img class="ltx_graphics ltx_centering" id="F26.g1" src="images/car-bicopter01.jpg"/>
        <figcaption class="ltx_caption ltx_centering">
         <span class="ltx_tag ltx_tag_figure">
          <span class="ltx_text">
           Figure 26
          </span>
          :
         </span>
         <span class="ltx_text">
          iLQR for car and bicopter control/planning problems.
         </span>
        </figcaption>
       </figure>
      </div>
     </div>
    </div>
   </div>
  </div>
 </body>
</html>
