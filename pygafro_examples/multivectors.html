<!--
    SPDX-FileCopyrightText: Copyright Â© 2025 Idiap Research Institute <contact@idiap.ch>

    SPDX-FileContributor: Philip Abbet <philip.abbet@idiap.ch>

    SPDX-License-Identifier: MPL-2.0
-->

<!doctype html>
<html>
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width,initial-scale=1.0">

        <link rel="stylesheet" href="https://pyscript.net/releases/2024.8.2/core.css">
        <script type="module" src="https://pyscript.net/releases/2024.8.2/core.js"></script>
        <script src="../mini-coi.js"></script>

        <link rel="stylesheet" href="../css/loader.css"/>

        <style>
            div#container {
                display: flex;
            }

            div.py-editor-input {
                border: 1px solid #202020;
            }
        </style>
    </head>

    <body style="font-family: monospace;">
        <h2>Multivectors</h2>

        <div id="loader-container">
            <span class="loader"></span>
        </div>

        <div id="container" style="display: none;">
            <div id="editor"></div>
            <div id="output" style="padding-left: 40px; padding-top: 2em;"></div>
        </div>

        <script type="py-editor" env="demo_env" setup
                config='{"packages":["numpy", "matplotlib"]}'
        >
            from pyscript import document
            from pyscript import display

            def print(*args):
                display(*args, target="output")

            document.getElementById('loader-container').style.display = 'none'
            document.getElementById('container').style.display = 'flex'

            def handle_event(event):
                document.getElementById('output').textContent = ''
                return True

            user_editor = document.getElementById("user_editor")
            user_editor.handleEvent = handle_event
            
            # Download the pygafro wheel
            import micropip
            parts = document.location.pathname.split('/')
            url = document.location.origin + '/'.join(parts[:-2]) + '/wasm/pygafro-1.3.0-cp312-cp312-pyodide_2024_0_wasm32.whl'
            await micropip.install(url)
        </script>

        <script id="user_editor" type="py-editor" env="demo_env" target="editor">
            from pygafro import Multivector
            from pygafro import blades
            from pygafro import Twist
            from pygafro import E0123i, E0

            # Create a multivector that corresponds to the scalar part of the algebra
            scalar = Multivector.create(['scalar'], 2.0)

            # Create a multivector that corresponds to a Euclidean vector
            vector = Multivector.create(['e1', 'e2', 'e3'], [1.0, 2.0, 3.0])

            # Note: this is equivalent to:
            #vector = Multivector.create([blades.e1, blades.e2, blades.e3], [1.0, 2.0, 3.0])

            # Expressions are immediately evaluated in Python (not the case in C++)
            geometric_product = scalar * vector
            sum = scalar + vector

            print(f'scalar = {scalar}')
            print(f'vector = {vector}')

            print('--------')

            print(f'geometric product: scalar * vector = {geometric_product}')
            print(f'outer product: scalar ^ vector = {scalar ^ vector}')
            print(f'inner product: scalar | vector = {scalar | vector}')
            print(f'sum: scalar + vector = {sum}')

            print('--------')

            # Access individual blade values
            e1 = vector['e1']   # equivalent to vector[blades.e1]
            vector['e1'] = 4.0

            print(f'modified vector = {vector}')

            print('--------')

            # Other examples
            twist = Twist.Random()

            print(f'twist = {twist}')
            print(f'E0123i(1.0) * E0(1.0) = {E0123i(1.0) * E0(1.0)}')
            print(f'twist | (E0123i(1.0) * E0(1.0)) = {twist | (E0123i(1.0) * E0(1.0))}')
        </script>
    </body>
</html>
