<!--
    SPDX-FileCopyrightText: Copyright Â© 2025 Idiap Research Institute <contact@idiap.ch>

    SPDX-FileContributor: Philip Abbet <philip.abbet@idiap.ch>

    SPDX-License-Identifier: MPL-2.0
-->

<!doctype html>
<html>
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width,initial-scale=1.0">

        <link rel="stylesheet" href="https://pyscript.net/releases/2024.8.2/core.css">
        <script type="module" src="https://pyscript.net/releases/2024.8.2/core.js"></script>
        <script src="../mini-coi.js"></script>

        <link rel="stylesheet" href="../css/loader.css"/>

        <style>
            div#container {
                display: flex;
            }

            div.py-editor-input {
                border: 1px solid #202020;
            }
        </style>
    </head>

    <body style="font-family: monospace;">
        <h2>Geometric primitives</h2>

        <div id="loader-container">
            <span class="loader"></span>
        </div>

        <div id="container" style="display: none;">
            <div id="editor"></div>
            <div id="output" style="padding-left: 40px; padding-top: 2em;"></div>
        </div>

        <script type="py-editor" env="demo_env" setup
                config='{"packages":["numpy", "matplotlib"]}'
        >
            from pyscript import document
            from pyscript import display

            def print(*args):
                display(*args, target="output")

            document.getElementById('loader-container').style.display = 'none'
            document.getElementById('container').style.display = 'flex'

            def handle_event(event):
                document.getElementById('output').textContent = ''
                return True

            user_editor = document.getElementById("user_editor")
            user_editor.handleEvent = handle_event
            
            # Download the pygafro wheel
            import micropip
            parts = document.location.pathname.split('/')
            url = document.location.origin + '/'.join(parts[:-2]) + '/wasm/pygafro-1.3.0-cp312-cp312-pyodide_2024_0_wasm32.whl'
            await micropip.install(url)
        </script>

        <script id="user_editor" type="py-editor" env="demo_env" target="editor">
            from pygafro import Multivector
            from pygafro import Point
            from pygafro import Line
            from pygafro import Plane


            # Create different geometric primitives
            p0 = Point()
            p1 = Point(1.0, 0.0, 0.0)
            p2 = Point(0.0, 1.0, 0.0)
            p3 = Point(0.0, 0.0, 1.0)

            ei = Multivector.create(['ei'], 1.0)

            line = Line(p0, p1)
            line_alternative = p0 ^ p1 ^ ei  # equivalent to line, but explicitly using the outer product (^)

            plane = Plane(p1, p2, p3)
            plane_alternative = p1 ^ p2 ^ p3 ^ ei # equivalent to plane

            # Print the values
            print(f"p0 = {p0}")
            print(f"p1 = {p1}")
            print(f"p2 = {p2}")
            print(f"p3 = {p3}")

            print("------")
            print(f"line = {line}")
            print(f"line_alternative = {line_alternative}")

            print("------")
            print(f"plane = {plane}")
            print(f"plane_alternative = {plane_alternative}")
        </script>
    </body>
</html>
