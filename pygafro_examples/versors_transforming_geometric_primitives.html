<!--
    SPDX-FileCopyrightText: Copyright Â© 2025 Idiap Research Institute <contact@idiap.ch>

    SPDX-FileContributor: Philip Abbet <philip.abbet@idiap.ch>

    SPDX-License-Identifier: MPL-2.0
-->

<!doctype html>
<html>
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width,initial-scale=1.0">

        <link rel="stylesheet" href="https://pyscript.net/releases/2024.8.2/core.css">
        <script type="module" src="https://pyscript.net/releases/2024.8.2/core.js"></script>
        <script src="../mini-coi.js"></script>

        <link rel="stylesheet" href="../css/loader.css"/>

        <style>
            div#container {
                display: flex;
            }

            div.py-editor-input {
                border: 1px solid #202020;
            }
        </style>
    </head>

    <body style="font-family: monospace;">
        <h2>Versors: log & exp</h2>

        <div id="loader-container">
            <span class="loader"></span>
        </div>

        <div id="container" style="display: none;">
            <div id="editor"></div>
            <div id="output" style="padding-left: 40px; padding-top: 2em;"></div>
        </div>

        <script type="py-editor" env="demo_env" setup
                config='{"packages":["numpy", "matplotlib"]}'
        >
            from pyscript import document
            from pyscript import display

            def print(*args):
                display(*args, target="output")

            document.getElementById('loader-container').style.display = 'none'
            document.getElementById('container').style.display = 'flex'

            def handle_event(event):
                document.getElementById('output').textContent = ''
                return True

            user_editor = document.getElementById("user_editor")
            user_editor.handleEvent = handle_event
            
            # Download the pygafro wheel
            import micropip
            parts = document.location.pathname.split('/')
            url = document.location.origin + '/'.join(parts[:-2]) + '/wasm/pygafro-1.3.0-cp312-cp312-pyodide_2024_0_wasm32.whl'
            await micropip.install(url)
        </script>

        <script id="user_editor" type="py-editor" env="demo_env" target="editor">
            from pygafro import Motor
            from pygafro import Point
            from pygafro import Line
            from pygafro import Plane


            # Create a random motor to transform the geometric primitives
            motor = Motor.Random()

            point = Point.Random()
            line = Line.Random()
            plane = Plane.Random()

            # Transform the geometric primitives
            point_transformed = motor.apply(point)
            line_transformed = motor.apply(line)
            plane_transformed = motor.apply(plane)

            # Explicit use of the geometric product to transform primitives using a motor
            point_transformed_alternative = motor * point * motor.reverse()
            line_transformed_alternative = motor * line * motor.reverse()
            plane_transformed_alternative = motor * plane * motor.reverse()

            print("Point:")
            print(f"point = {point}")
            print(f"point_transformed = {point_transformed}")
            print(f"point_transformed_alternative = {point_transformed_alternative}")
            print("------")
            print("Line:")
            print(f"line = {line}")
            print(f"line_transformed = {line_transformed}")
            print(f"line_transformed_alternative = {line_transformed_alternative}")
            print("------")
            print("Plane:")
            print(f"plane = {plane}")
            print(f"plane_transformed = {plane_transformed}")
            print(f"plane_transformed_alternative = {plane_transformed_alternative}")
        </script>
    </body>
</html>
