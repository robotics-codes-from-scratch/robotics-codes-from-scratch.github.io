<!--
    SPDX-FileCopyrightText: Copyright Â© 2025 Idiap Research Institute <contact@idiap.ch>

    SPDX-FileContributor: Philip Abbet <philip.abbet@idiap.ch>

    SPDX-License-Identifier: MPL-2.0
-->

<!doctype html>
<html>
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width,initial-scale=1.0">

        <link rel="stylesheet" href="https://pyscript.net/releases/2024.8.2/core.css">
        <script type="module" src="https://pyscript.net/releases/2024.8.2/core.js"></script>
        <script src="../mini-coi.js"></script>

        <link rel="stylesheet" href="../css/loader.css"/>

        <style>
            div#container {
                display: flex;
            }

            div.py-editor-input {
                border: 1px solid #202020;
            }
        </style>
    </head>

    <body style="font-family: monospace;">
        <h2>Versors: log & exp</h2>

        <div id="loader-container">
            <span class="loader"></span>
        </div>

        <div id="container" style="display: none;">
            <div id="editor"></div>
            <div id="output" style="padding-left: 40px; padding-top: 2em;"></div>
        </div>

        <script type="py-editor" env="demo_env" setup
                config='{"packages":["numpy", "matplotlib"]}'
        >
            from pyscript import document
            from pyscript import display

            def print(*args):
                display(*args, target="output")

            document.getElementById('loader-container').style.display = 'none'
            document.getElementById('container').style.display = 'flex'

            def handle_event(event):
                document.getElementById('output').textContent = ''
                return True

            user_editor = document.getElementById("user_editor")
            user_editor.handleEvent = handle_event
            
            # Download the pygafro wheel
            import micropip
            parts = document.location.pathname.split('/')
            url = document.location.origin + '/'.join(parts[:-2]) + '/wasm/pygafro-1.3.0-cp312-cp312-pyodide_2024_0_wasm32.whl'
            await micropip.install(url)
        </script>

        <script id="user_editor" type="py-editor" env="demo_env" target="editor">
            from pygafro import Motor
            from pygafro import Rotor
            from pygafro import RotorGenerator
            from pygafro import Translator
            from pygafro import TranslatorGenerator


            motor_1 = Motor.Random()

            # This is an expression for the motor logarithm
            motor_log = motor_1.log()

            # It will evaluate to a motor generator
            motor_gen = motor_log.evaluate()

            # The generator can be used to obtain a motor via the exponential
            motor_2 = Motor.exp(motor_gen).evaluate()

            # The different parts of a motor generator correspond to translation and rotation
            rotor_gen = RotorGenerator(motor_gen.vector()[:3])
            translator_gen = TranslatorGenerator(motor_gen.vector()[3:])

            rotor = Rotor.exp(rotor_gen)
            translator = Translator.exp(translator_gen)

            motor_3 = Motor(translator * rotor)
            motor_4 = Motor(translator, rotor)

            print(motor_1)
            print(motor_2)
            print(motor_3)
            print(motor_4)
        </script>
    </body>
</html>
