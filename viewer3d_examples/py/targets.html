<!--
SPDX-FileCopyrightText: 2023 Idiap Research Institute <contact@idiap.ch>

SPDX-FileContributor: Philip Abbet <philip.abbet@idiap.ch>

SPDX-License-Identifier: MIT
-->

<!DOCTYPE html>
<html lang="en">
<head>
    <title>Targets example (Python version)</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">

    <link href="https://pyscript.net/releases/2024.8.2/core.css" rel="stylesheet"/>
    <link href="../../css/loader.css" rel="stylesheet"/>

    <py-config type="toml">
        packages = ['numpy']
        [[fetch]]
            from = '../../viewer3d/'
            files = ['viewer3d.py']
    </py-config>
</head>


<body style="font-family: MONOSPACE;">
    <h2>Targets example (Python version)</h2>

    <p>This example shows how to add targets that can be manipulated by the user. Additionally, a checkbox allows to
    enable or disable the manipulations.</p>

    <div id="loader-container">
        <span class="loader"></span>
    </div>

    <div id="viewer3d" style="height: 700px"></div>

    <input type="checkbox" id="manipulations" name="manipulations" checked>
    <label for="manipulations">Manipulations enabled</label>


    <!-- Import all the necessary JavaScript dependency modules
    Sadly, can't be imported from an external file for the moment, this is not supported by Chrome
    -->
    <script src="https://unpkg.com/es-module-shims@1.6.3/dist/es-module-shims.js"></script>
    <script type="importmap">
        {
            "imports": {
                "three": "https://cdn.jsdelivr.net/npm/three@0.170.0/build/three.module.js",
                "three/examples/jsm/": "https://cdn.jsdelivr.net/npm/three@0.170.0/examples/jsm/",
                "mujoco": "../../viewer3d/jsm/mujoco_wasm.js",
                "katex": "https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.mjs",
                "mathjs": "https://cdn.jsdelivr.net/npm/mathjs@14.1.0/+esm"
            }
        }
    </script>


    <!-- Import the viewer3d.js library -->
    <script type="module">
        import { downloadScene, downloadPandaRobot, initPyScript } from '../../viewer3d/viewer3d.js';

        // Download the assets
        await downloadPandaRobot();
        await downloadScene('../scenes/panda.xml');

        // Now PyScript can be initialised
        initPyScript();
    </script>


    <py-script>
        from viewer3d import Viewer3D, Shapes, configs
        from js import document
        from pyodide.ffi import create_proxy

        document.getElementById('loader-container').style.display = 'none';

        # Create the Viewer3D
        viewer3D = Viewer3D(document.getElementById('viewer3d'))

        # Load the scene and retrieve the robot
        viewer3D.loadScene('/scenes/panda.xml')
        robot = viewer3D.createRobot('panda', configs.Panda.new())

        # Start the physics simulation
        viewer3D.physicsSimulatorPaused = False

        # Add some targets
        viewer3D.addTarget('target1', [0.0, -0.4, 0.5], [-0.707, 0.707, 0.0, 0.0])
        viewer3D.addTarget('target2', [0.6, 0.0, 0.5], [0.0, 1.0, 0.0, 0.0], '#aaaa00', Shapes.Cone)
        viewer3D.addTarget(
            'target3', [0.0, 0.4, 0.5], [1.0, 0.0, 0.0, 0.0], '#ff0000', Shapes.Mesh,
            parameters={
                'url': '../../viewer3d/models/unitree_g1/assets/right_rubber_hand.STL',
                'offset': [-0.07, -0.02, 0],
                'orientation': [0.707, 0.0, 0.0, 0.707],
            }
        )

        # Enable/disable the manipulation of the targets according to the state of the checkbox
        def onCheckboxClicked(event):
            viewer3D.controlsEnabled = event.target.checked

        document.getElementById('manipulations').addEventListener('change', create_proxy(onCheckboxClicked))
    </py-script>
</body>
</html>
