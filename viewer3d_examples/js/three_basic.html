<!--
SPDX-FileCopyrightText: 2023 Idiap Research Institute <contact@idiap.ch>

SPDX-FileContributor: Philip Abbet <philip.abbet@idiap.ch>

SPDX-License-Identifier: MIT
-->

<!DOCTYPE html>
<html lang="en">
<head>
    <title>three.js example (JavaScript version)</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">

    <script id="mesh" type="data">
        [
            -0.017094, 0.089108, 0.378759,
            -0.020513, 0.048082, 0.053971,
            -0.020513, 0.024150, 0.060809,
            -0.020513, 0.102783, 0.368502,
            -0.027351, 0.051501, 0.047133,
            -0.027351, 0.075433, 0.648846,
            -0.034188, 0.075433, 0.238587,
            -0.034188, 0.099364, 0.324058,
            -0.034188, 0.034407, 0.539443,
            -0.037607, 0.072014, 0.306964,
            -0.041026, 0.058339, 0.074484,
            -0.041026, 0.027569, 0.077903,
            -0.041026, 0.037826, 0.105253,
            -0.041026, 0.065176, 0.108672,
            -0.041026, 0.089108, 0.313801,
            -0.041026, 0.102783, 0.365084,
            -0.044445, 0.072014, 0.368502,
            -0.044445, 0.116459, 0.621495,
            -0.047863, 0.068595, 0.118929,
            -0.047863, 0.109621, 0.334314,
            -0.047863, 0.089108, 0.375340,
            -0.047863, 0.013894, 0.635170,
            -0.051282, 0.058339, 0.067646,
            -0.051282, 0.068595, 0.132604,
            -0.054701, 0.075433, 0.334314,
            -0.054701, 0.102783, 0.389015,
            -0.054701, 0.082270, 0.566794,
            -0.058120, 0.095946, 0.334314,
            -0.058120, 0.078852, 0.525768,
            -0.061539, 0.072014, 0.539443,
            -0.068376, 0.030988, 0.457392,
            -0.068376, 0.030988, 0.624914,
            -0.068376, 0.078852, 0.747992,
            -0.071795, 0.024150, 0.026620,
            -0.071795, 0.058339, 0.327477,
            -0.071795, 0.075433, 0.494999,
            -0.071795, 0.085689, 0.614658,
            -0.075214, 0.089108, 0.529187,
            -0.078633,-0.010038, 0.009526,
            -0.078633, 0.058339, 0.296707,
            -0.078633, 0.089108, 0.563375,
            -0.082052, 0.085689, 0.501836,
            -0.085471, 0.075433, 0.532606,
            -0.085471, 0.078852, 0.563375,
            -0.085471, 0.017313, 0.724060,
            -0.088889,-0.006619, 0.351408,
            -0.088889,-0.033970, 0.358246,
            -0.088889, 0.072014, 0.474486,
            -0.088889, 0.075433, 0.508674,
            -0.088889, 0.072014, 0.604401,
            -0.088889, 0.119877, 0.703547,
            -0.092308, 0.058339, 0.238587,
            -0.092308,-0.047645, 0.334314,
            -0.092308, 0.089108, 0.597563,
            -0.095727,-0.064739, 0.310382,
            -0.099146, 0.089108, 0.481324,
            -0.099146, 0.106202, 0.539443,
            -0.102565, 0.024150, 0.033458,
            -0.102565,-0.074995, 0.279613,
            -0.102565,-0.010038, 0.324058,
            -0.102565, 0.078852, 0.590726,
            -0.105983, 0.078852, 0.488161,
            -0.105983, 0.095946, 0.539443,
            -0.109402, 0.048082, 0.125766,
            -0.109402,-0.081833, 0.214656,
            -0.109402, 0.078852, 0.638589,
            -0.112821,-0.010038, 0.296707,
            -0.116240, 0.037826, 0.074484,
            -0.116240, 0.106202, 0.501836,
            -0.116240, 0.106202, 0.580469,
            -0.119659, 0.095946, 0.505255,
            -0.119659, 0.095946, 0.577051,
            -0.119659, 0.085689, 0.618076,
            -0.123078, 0.082270, 0.607820,
            -0.126496,-0.085252, 0.122347,
            -0.136753,-0.003200, 0.242006,
            -0.136753, 0.113040, 0.713803,
            -0.140172, 0.068595, 0.765086,
            -0.143590,-0.023713, 0.019783,
            -0.143590,-0.078414, 0.033458,
            -0.143590, 0.072014, 0.642008,
            -0.147009, 0.075433, 0.611239,
            -0.147009, 0.078852, 0.621495,
            -0.147009, 0.007056, 0.734316,
            -0.153847,-0.003200, 0.129185,
            -0.153847, 0.017313, 0.423204,
            -0.153847, 0.061757, 0.447135,
            -0.153847, 0.099364, 0.484742,
            -0.153847, 0.089108, 0.491580,
            -0.153847, 0.109621, 0.539443,
            -0.153847, 0.089108, 0.590726,
            -0.153847, 0.099364, 0.597563,
            -0.153847, 0.061757, 0.631752,
            -0.153847, 0.017313, 0.659102,
            -0.160685,-0.020294, 0.043714,
            -0.164103, 0.054920, 0.440298,
            -0.164103, 0.072014, 0.460811,
            -0.164103, 0.065176, 0.471067,
            -0.174360, 0.041245, 0.412947,
            -0.181198, 0.075433, 0.604401,
            -0.184616, 0.085689, 0.607820,
            -0.188035, 0.061757, 0.624914,
            -0.191454,-0.020294, 0.371921,
            -0.191454,-0.047645, 0.392434,
            -0.191454, 0.082270, 0.505255,
            -0.191454, 0.082270, 0.577051,
            -0.191454, 0.095946, 0.672778,
            -0.194873, 0.089108, 0.501836,
            -0.194873, 0.089108, 0.580469,
            -0.201710, 0.054920, 0.484742,
            -0.201710,-0.064739, 0.662521,
            -0.205129, 0.078852, 0.539443,
            -0.208548, 0.061757, 0.477905,
            -0.208548, 0.085689, 0.539443,
            -0.211967,-0.010038, 0.676196,
            -0.215386, 0.041245, 0.460811,
            -0.215386, 0.048082, 0.696709,
            -0.218805, 0.048082, 0.474486,
            -0.218805, 0.048082, 0.604401,
            -0.232480, 0.044663, 0.580469,
            -0.239317, 0.000219, 0.457392,
            -0.239317, 0.041245, 0.525768,
            -0.239317, 0.000219, 0.624914,
            -0.242736, 0.041245, 0.556538,
            -0.246155, 0.041245, 0.539443,
            -0.246155, 0.051501, 0.587307,
            -0.252993, 0.044663, 0.518931,
            -0.256412, 0.048082, 0.559956,
            -0.263249,-0.071577, 0.433460,
            -0.263249, 0.037826, 0.597563,
            -0.270087, 0.020732, 0.457392,
            -0.273506, 0.030988, 0.515512,
            -0.273506,-0.006619, 0.539443,
            -0.276924,-0.016875, 0.416366,
            -0.276924,-0.129697, 0.631752,
            -0.280343, 0.030988, 0.563375,
            -0.297437,-0.037388, 0.631752,
            -0.300856, 0.065176, 0.614658,
            -0.311113, 0.020732, 0.645427,
            -0.317950, 0.010475, 0.522349,
            -0.317950,-0.105765, 0.611239,
            -0.324788, 0.034407, 0.597563,
            -0.338463,-0.088671, 0.505255,
            -0.348720,-0.051064, 0.611239,
            -0.362395,-0.057901, 0.498418,
            -0.376070, 0.007056, 0.621495,
            0.000000, 0.000219, 0.002689,
            0.000000, 0.027569, 0.019783,
            0.000000, 0.048082, 0.043714,
            0.000000, 0.048082, 0.050552,
            0.000000, 0.024150, 0.057390,
            0.000000, 0.034407, 0.091578,
            0.000000, 0.061757, 0.094997,
            0.000000, 0.068595, 0.098416,
            0.000000, 0.068595, 0.136023,
            0.000000, 0.075433, 0.238587,
            0.000000, 0.072014, 0.289870,
            0.000000, 0.089108, 0.293288,
            0.000000, 0.099364, 0.306964,
            0.000000, 0.109621, 0.344571,
            0.000000, 0.075433, 0.347990,
            0.000000, 0.095946, 0.351408,
            0.000000, 0.072014, 0.371921,
            0.000000, 0.065176, 0.453973,
            0.000000, 0.082270, 0.525768,
            0.000000, 0.106202, 0.587307,
            0.000000, 0.010475, 0.611239,
            0.000000, 0.072014, 0.621495,
            0.000000,-0.003200, 0.683034,
            0.017094, 0.089108, 0.378759,
            0.020513, 0.048082, 0.053971,
            0.020513, 0.024150, 0.060809,
            0.020513, 0.102783, 0.368502,
            0.027351, 0.051501, 0.047133,
            0.027351, 0.075433, 0.648846,
            0.034188, 0.075433, 0.238587,
            0.034188, 0.099364, 0.324058,
            0.034188, 0.034407, 0.539443,
            0.037607, 0.072014, 0.306964,
            0.041026, 0.058339, 0.074484,
            0.041026, 0.027569, 0.077903,
            0.041026, 0.037826, 0.105253,
            0.041026, 0.065176, 0.108672,
            0.041026, 0.089108, 0.313801,
            0.041026, 0.102783, 0.365084,
            0.044445, 0.072014, 0.368502,
            0.044445, 0.116459, 0.621495,
            0.047863, 0.068595, 0.118929,
            0.047863, 0.109621, 0.334314,
            0.047863, 0.089108, 0.375340,
            0.047863, 0.013894, 0.635170,
            0.051282, 0.058339, 0.067646,
            0.051282, 0.068595, 0.132604,
            0.054701, 0.075433, 0.334314,
            0.054701, 0.102783, 0.389015,
            0.054701, 0.082270, 0.566794,
            0.058120, 0.095946, 0.334314,
            0.058120, 0.078852, 0.525768,
            0.061539, 0.072014, 0.539443,
            0.068376, 0.030988, 0.457392,
            0.068376, 0.030988, 0.624914,
            0.068376, 0.078852, 0.747992,
            0.071795, 0.024150, 0.026620,
            0.071795, 0.058339, 0.327477,
            0.071795, 0.075433, 0.494999,
            0.071795, 0.085689, 0.614658,
            0.075214, 0.089108, 0.529187,
            0.078633,-0.010038, 0.009526,
            0.078633, 0.058339, 0.296707,
            0.078633, 0.089108, 0.563375,
            0.082052, 0.085689, 0.501836,
            0.085471, 0.075433, 0.532606,
            0.085471, 0.078852, 0.563375,
            0.085471, 0.017313, 0.724060,
            0.088889,-0.006619, 0.351408,
            0.088889,-0.033970, 0.358246,
            0.088889, 0.072014, 0.474486,
            0.088889, 0.075433, 0.508674,
            0.088889, 0.072014, 0.604401,
            0.088889, 0.119877, 0.703547,
            0.092308, 0.058339, 0.238587,
            0.092308,-0.047645, 0.334314,
            0.092308, 0.089108, 0.597563,
            0.095727,-0.064739, 0.310382,
            0.099146, 0.089108, 0.481324,
            0.099146, 0.106202, 0.539443,
            0.102565, 0.024150, 0.033458,
            0.102565,-0.074995, 0.279613,
            0.102565,-0.010038, 0.324058,
            0.102565, 0.078852, 0.590726,
            0.105983, 0.078852, 0.488161,
            0.105983, 0.095946, 0.539443,
            0.109402, 0.048082, 0.125766,
            0.109402,-0.081833, 0.214656,
            0.109402, 0.078852, 0.638589,
            0.112821,-0.010038, 0.296707,
            0.116240, 0.037826, 0.074484,
            0.116240, 0.106202, 0.501836,
            0.116240, 0.106202, 0.580469,
            0.119659, 0.095946, 0.505255,
            0.119659, 0.095946, 0.577051,
            0.119659, 0.085689, 0.618076,
            0.123078, 0.082270, 0.607820,
            0.126496,-0.085252, 0.122347,
            0.136753,-0.003200, 0.242006,
            0.136753, 0.113040, 0.713803,
            0.140172, 0.068595, 0.765086,
            0.143590,-0.023713, 0.019783,
            0.143590,-0.078414, 0.033458,
            0.143590, 0.072014, 0.642008,
            0.147009, 0.075433, 0.611239,
            0.147009, 0.078852, 0.621495,
            0.147009, 0.007056, 0.734316,
            0.153847,-0.003200, 0.129185,
            0.153847, 0.017313, 0.423204,
            0.153847, 0.061757, 0.447135,
            0.153847, 0.099364, 0.484742,
            0.153847, 0.089108, 0.491580,
            0.153847, 0.109621, 0.539443,
            0.153847, 0.089108, 0.590726,
            0.153847, 0.099364, 0.597563,
            0.153847, 0.061757, 0.631752,
            0.153847, 0.017313, 0.659102,
            0.160685,-0.020294, 0.043714,
            0.164103, 0.054920, 0.440298,
            0.164103, 0.072014, 0.460811,
            0.164103, 0.065176, 0.471067,
            0.174360, 0.041245, 0.412947,
            0.181198, 0.075433, 0.604401,
            0.184616, 0.085689, 0.607820,
            0.188035, 0.061757, 0.624914,
            0.191454,-0.020294, 0.371921,
            0.191454,-0.047645, 0.392434,
            0.191454, 0.082270, 0.505255,
            0.191454, 0.082270, 0.577051,
            0.191454, 0.095946, 0.672778,
            0.194873, 0.089108, 0.501836,
            0.194873, 0.089108, 0.580469,
            0.201710, 0.054920, 0.484742,
            0.201710,-0.064739, 0.662521,
            0.205129, 0.078852, 0.539443,
            0.208548, 0.061757, 0.477905,
            0.208548, 0.085689, 0.539443,
            0.211967,-0.010038, 0.676196,
            0.215386, 0.041245, 0.460811,
            0.215386, 0.048082, 0.696709,
            0.218805, 0.048082, 0.474486,
            0.218805, 0.048082, 0.604401,
            0.232480, 0.044663, 0.580469,
            0.239317, 0.000219, 0.457392,
            0.239317, 0.041245, 0.525768,
            0.239317, 0.000219, 0.624914,
            0.242736, 0.041245, 0.556538,
            0.246155, 0.041245, 0.539443,
            0.246155, 0.051501, 0.587307,
            0.252993, 0.044663, 0.518931,
            0.256412, 0.048082, 0.559956,
            0.263249,-0.071577, 0.433460,
            0.263249, 0.037826, 0.597563,
            0.270087, 0.020732, 0.457392,
            0.273506, 0.030988, 0.515512,
            0.273506,-0.006619, 0.539443,
            0.276924,-0.016875, 0.416366,
            0.276924,-0.129697, 0.631752,
            0.280343, 0.030988, 0.563375,
            0.297437,-0.037388, 0.631752,
            0.300856, 0.065176, 0.614658,
            0.311113, 0.020732, 0.645427,
            0.317950, 0.010475, 0.522349,
            0.317950,-0.105765, 0.611239,
            0.324788, 0.034407, 0.597563,
            0.338463,-0.088671, 0.505255,
            0.348720,-0.051064, 0.611239,
            0.362395,-0.057901, 0.498418,
            0.376070, 0.007056, 0.621495
        ]
    </script>

    <script id="line" type="data">
        [
            -0.136753, 0.113040, 0.713803,
            -0.088889, 0.119877, 0.703547,
            -0.044445, 0.116459, 0.621495,
            0.000000, 0.106202, 0.587307,
            0.000000, 0.082270, 0.525768,
            0.000000, 0.065176, 0.453973,
            0.054701, 0.102783, 0.389015,
            0.071795, 0.058339, 0.327477,
            0.078633, 0.058339, 0.296707,
            0.092308, 0.058339, 0.238587,
            0.109402, 0.048082, 0.125766,
            0.116240, 0.037826, 0.074484,
            0.102565, 0.024150, 0.033458
        ]
    </script>
</head>


<body style="font-family: MONOSPACE;">
    <h2>three.js example (JavaScript version)</h2>

    <p>This example shows how to directly interact with the three.js scene at the core of a 3D viewer. It is a simpler version
        of <a href="three.html">three.html</a>.  Another version using colored points is at
        <a href="three_basic_with_colors.html">three_basic_with_colors.html</a>.</p>

    <p>The point cloud and the trajectory data are hard-coded in the HTML file.</p>

    <div id="viewer3d" style="height: 700px"></div>


    <!-- Import all the necessary JavaScript dependency modules
    Sadly, can't be imported from an external file for the moment, this is not supported by Chrome
    -->
    <script src="https://unpkg.com/es-module-shims@1.6.3/dist/es-module-shims.js"></script>
    <script type="importmap">
        {
            "imports": {
                "three": "https://cdn.jsdelivr.net/npm/three@0.170.0/build/three.module.js",
                "three/examples/jsm/": "https://cdn.jsdelivr.net/npm/three@0.170.0/examples/jsm/",
                "mujoco": "../../viewer3d/jsm/mujoco_wasm.js",
                "katex": "https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.mjs",
                "mathjs": "https://cdn.jsdelivr.net/npm/mathjs@14.1.0/+esm"
            }
        }
    </script>


    <!-- Create the Viewer3D from JavaScript -->
    <script type="module">
        import * as THREE from 'three';
        import { Viewer3D } from '../../viewer3d/viewer3d.js';

        // Create the Viewer3D
        const viewer3D = new Viewer3D(document.getElementById('viewer3d'));

        // Set the background color
        viewer3D.backgroundColor = new THREE.Color(0.9, 0.9, 0.9);

        // Create the point mesh
        const vertices = JSON.parse(document.querySelector("#mesh").text);

        let geometry = new THREE.BufferGeometry();
        geometry.setAttribute('position', new THREE.Float32BufferAttribute(vertices, 3));

        let material = new THREE.PointsMaterial({ color: 0x0000CC, size: 0.01 });
        const mesh = new THREE.Points(geometry, material);

        viewer3D.scene.add(mesh);

        // Create the line
        const points = JSON.parse(document.querySelector("#line").text);

        geometry = new THREE.BufferGeometry();
        geometry.setAttribute('position', new THREE.Float32BufferAttribute(points, 3));

        material = new THREE.LineBasicMaterial({ color: 0x000000 });

        const line = new THREE.Line(geometry, material);
        viewer3D.scene.add(line);

        // Manually position the camera
        viewer3D.camera.position.set(0.4, 1.0, 0.7);
        viewer3D.cameraControl.target.set(0.0, 0.0, 0.4);
        viewer3D.cameraControl.update();
    </script>
</body>
</html>
