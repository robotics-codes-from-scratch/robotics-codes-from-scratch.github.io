<!--
SPDX-FileCopyrightText: 2023 Idiap Research Institute <contact@idiap.ch>

SPDX-FileContributor: Philip Abbet <philip.abbet@idiap.ch>

SPDX-License-Identifier: MIT
-->

<!DOCTYPE html>
<html lang="en">
<head>
    <title>DH parameters example (JavaScript version)</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
</head>


<body style="font-family: MONOSPACE;">
    <h2>DH parameters example (JavaScript version)</h2>

    <p>This example shows how to define a robot using
        <a href="https://en.wikipedia.org/wiki/Denavit%E2%80%93Hartenberg_parameters#Modified_DH_parameters">modified DH parameters</a>.</p>

    <p>The user can click on the sphere at the end of the robot to activate some controls to manipulate it using Inverse Kinematics
        (ie. change its position and orientation).</p>

    <p>Likewise, clicking and dragging on any link of the robot allows to use IK to manipulate it.</p>

    <p>It is also possible to change the position of the joints by hovering on the links of the robot and using the mouse
    wheel.</p>

    <div id="viewer3d" style="height: 700px"></div>


    <!-- Import all the necessary JavaScript dependency modules
    Sadly, can't be imported from an external file for the moment, this is not supported by Chrome
    -->
    <script src="https://unpkg.com/es-module-shims@1.6.3/dist/es-module-shims.js"></script>
    <script type="importmap">
        {
            "imports": {
                "three": "https://cdn.jsdelivr.net/npm/three@0.170.0/build/three.module.js",
                "three/examples/jsm/": "https://cdn.jsdelivr.net/npm/three@0.170.0/examples/jsm/",
                "mujoco": "../../viewer3d/jsm/mujoco_wasm.js",
                "katex": "https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.mjs",
                "mathjs": "https://cdn.jsdelivr.net/npm/mathjs@14.1.0/+esm"
            }
        }
    </script>


    <!-- Create the Viewer3D from JavaScript -->
    <script type="module">
        import { Viewer3D, downloadScene, RobotBuilder } from '../../viewer3d/viewer3d.js';

        // Download the assets
        await downloadScene('../scenes/empty.xml');

        // Create the Viewer3D
        const viewer3D = new Viewer3D(document.getElementById('viewer3d'), {'show_axes': true});

        // Define the robot using DH parameters
        const builder = new RobotBuilder("robot");

        builder.q = [0, 0, 0, 0, 0, 0, 0, 0]; // Angle about previous z
        builder.q_offset = [0, 0, 0, 0, 0, 0, 0, 0, 0]; // Offset on articulatory joints
        builder.alpha = [0, -Math.PI/2, Math.PI/2, Math.PI/2, -Math.PI/2, Math.PI/2, Math.PI/2, 0]; // Angle about common normal
        builder.d = [0.333, 0, 0.316, 0, 0.384, 0, 0, 0.107]; // Offset along previous z to the common normal
        builder.r = [0, 0, 0, 0.0825, -0.0825, 0, 0.088, 0]; // Length of the common normal

        builder.defaultPose = [0, 0, 0, -Math.PI/2, 0, Math.PI/2, 0];

        builder.colors = [  // As many as you want, links will alternate between those colors
            "0.9 0.9 0.9 1",
            "0.85 0.85 0.85 1",
        ];

        // Load the scene and retrieve the robot
        viewer3D.loadScene('/scenes/empty.xml', [builder]);
        const robot = viewer3D.createRobot('robot', builder.getConfiguration());

        // Start the physics simulation
        viewer3D.physicsSimulator.paused = false;
    </script>
</body>
</html>
